(()=>{"use strict";var e={};(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);const t=require("electron"),i=require("fs"),n=require("path"),s="SnowRunner XML Editor";var a;!function(e){e.dev="dev",e.prod="prod"}(a||(a={}));const r=a;var o,c;!function(e){e.trucks="trucks",e.trailers="trailers"}(o||(o={})),function(e){e.sync="sync",e.async="async"}(c||(c={}));const l=c;var d;!function(e){e.file="file",e.dir="dir"}(d||(d={}));const p=d;var u;!function(e){e.open="open",e.save="save"}(u||(u={}));const h=u;var g,m,E,S,_;!function(e){e.engines="engines",e.gearboxes="gearboxes",e.suspensions="suspensions",e.wheels="wheels",e.winches="winches",e.truck="truck"}(g||(g={})),function(e){e.main="main",e.dlc="dlc",e.mods="mods",e.favorites="favorites"}(m||(m={})),function(e){e.text="text",e.number="number",e.select="select",e.coordinates="coordinates",e.file="file"}(E||(E={})),(_=S||(S={})).changeConfig="change-config",_.windowReady="window-ready-",_.windowResize="window-resize",_.handleWindowSize="handle-window-size",_.updateInitial="update-initial";const f=S;var R;!function(e){e.RU="RU",e.EN="EN",e.DE="DE",e.CH="CH"}(R||(R={}));const I=R;var w,N,O,A,y;!function(e){e.integer="int",e.float="float"}(w||(w={})),function(e){e.editor="editor",e.lists="lists"}(N||(N={})),function(e){e.input="input",e.group="group"}(O||(O={})),function(e){e.common="common",e.lists="lists",e.editor="editor",e.main="main"}(A||(A={})),function(e){e.Main="MainWindow",e.Settings="SettingsWindow",e.Update="UpdateWindow",e.WhatsNew="WhatsNewWindow",e.Loading="LoadingWindow",e.Setup="SetupWindow"}(y||(y={}));const T=y;var v,C;!function(e){e.mods="mods",e.dlc="dlc",e.main="main",e.favorites="favorites"}(v||(v={})),function(e){e.multiply="multiply",e.single="single"}(C||(C={}));class L{constructor(e,t,i){this.texts=e,this.getLang=t,this.get=()=>this.localized,this.onChangeLang=()=>{Object.assign(this.localized,this.texts[this.getLang()])},this.localized={...e[t()]},i&&i(this.onChangeLang)}}const D={RU:{SUCCESS_EXPORT_MESSAGE:"Конфигурация успешно экпортирована",LOADING:"Загрузка",OPEN_BUTTON:"Открыть",SAVE_BUTTON:"Сохранить",RESET_MENU_ITEM_LABEL:"Сбросить",EXPORT:"Экспорт",ERROR:"Ошибка",LANGUAGE_LABEL:"Язык программы",OK:"Ок",CANCEL:"Отменить"},EN:{SUCCESS_EXPORT_MESSAGE:"Configuration exported successfully",LOADING:"Loading",OPEN_BUTTON:"Open",SAVE_BUTTON:"Save",RESET_MENU_ITEM_LABEL:"Reset",EXPORT:"Export",ERROR:"Error",LANGUAGE_LABEL:"Program language",OK:"Ok",CANCEL:"Cancel"},DE:{SUCCESS_EXPORT_MESSAGE:"Konfiguration erfolgreich exportiert",LOADING:"Herunterladen",OPEN_BUTTON:"Öffnen",SAVE_BUTTON:"Datei",RESET_MENU_ITEM_LABEL:"Zurücksetzen",EXPORT:"Export",ERROR:"Fehler",LANGUAGE_LABEL:"Programmsprache",OK:"Ok",CANCEL:"Stornieren"},CH:{SUCCESS_EXPORT_MESSAGE:"配置已成功导出",LOADING:"加载",OPEN_BUTTON:"打开",SAVE_BUTTON:"保存",RESET_MENU_ITEM_LABEL:"重置",EXPORT:"导出",ERROR:"误差",LANGUAGE_LABEL:"方案语言",OK:"确认",CANCEL:"取消"}};function U(e,t,i,n,s,a){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=n.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?n.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,n.name):{}),u=!1,h=i.length-1;h>=0;h--){var g={};for(var m in n)g[m]="access"===m?{}:n[m];for(var m in n.access)g.access[m]=n.access[m];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");a.push(r(e||null))};var E=(0,i[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===E)continue;if(null===E||"object"!=typeof E)throw new TypeError("Object expected");(o=r(E.get))&&(p.get=o),(o=r(E.set))&&(p.set=o),(o=r(E.init))&&s.unshift(o)}else(o=r(E))&&("field"===c?s.unshift(o):p[l]=o)}d&&Object.defineProperty(d,n.name,p),u=!0}function k(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e);return n?i:void 0}var P,F,b,M;Object.create,Object.create,function(e){e.get="get",e.set="set"}(P||(P={})),(M=F||(F={})).renderer="renderer",M.preload="preload",function(e){e.getPublicInfo="GET_PUBLIC_INFO",e.functionCall="FUNCTION_CALL_",e.mainEventOn="MAIN_EVENT_ON_",e.mainEventOnce="MAIN_EVENT_ONCE_",e.mainEventEmit="MAIN_EVENT_EMIT_",e.propertyGet="PROPERTY_GET_",e.propertySet="PROPERTY_SET_",e.promisePostfix="_PROMISE",e.rendererEventEmit="RENDERER_EMIT_"}(b||(b={}));const x={properties:new Set,functions:new Set,mainEvents:new Set,rendererEvents:new Set,accesses:new Map,scopes:new Map};function W(e,i,n=[F.renderer,F.preload]){const{properties:s}=x,a=b.propertyGet+e,r=b.propertySet+e,{get:o,set:c}=i;if(s.add(e),x.scopes.has(e)||x.scopes.set(e,new Set(n)),x.accesses.has(e)){const t=x.accesses.get(e);o&&t.add(P.get),c&&t.add(P.set)}else{const t=[];o&&t.push(P.get),c&&t.push(P.set),x.accesses.set(e,new Set(t))}o&&(t.ipcMain.removeAllListeners(a),t.ipcMain.on(a,(e=>{try{const t=o();e.returnValue={value:t}}catch(t){e.returnValue={error:t}}}))),c&&(t.ipcMain.removeAllListeners(r),t.ipcMain.on(r,((e,...t)=>{try{c(t[0]),e.returnValue={value:null}}catch(t){e.returnValue={error:t}}})))}function j(e,t){x.scopes.set(e,new Set([t]))}function G(e){return(i,n)=>{let s=String(n.name);e&&("string"==typeof e?s=e:(s=e.name??s,e.scope&&j(s,e.scope))),n.addInitializer((function(){!function(e,i,n=[F.preload,F.renderer]){const{functions:s}=x,a=b.functionCall+e;s.add(e),x.scopes.has(e)||x.scopes.set(e,new Set(n)),t.ipcMain.removeAllListeners(a),t.ipcMain.on(a,((e,...t)=>{try{const n=i(...t);if(n instanceof Promise){const t=a+b.promisePostfix;n.then((i=>e.sender.send(t,{value:i}))).catch((i=>e.sender.send(t,{error:String(i)}))),e.returnValue={promiseChannel:t}}else e.returnValue={value:n}}catch(t){e.returnValue={error:String(t)}}}))}(s,i.bind(this))}))}}function B(e){return(t,i)=>{const n=String(i.name);let s=n;e&&("string"==typeof e?s=e:(s=e.name??s,e.scope&&j(s,e.scope),e.access&&function(e,t){x.accesses.set(e,new Set([t]))}(s,e.access))),i.addInitializer((function(){W(s,{get:()=>this[n],set:e=>{this[n]=e}})}))}}function V(e){return(t,i)=>{let n=String(i.name);e&&("string"==typeof e?n=e:(n=e.name??n,e.scope&&j(n,e.scope))),i.addInitializer((function(){W(n,{set:t.bind(this)})}))}}t.ipcMain.on(b.getPublicInfo,(e=>e.returnValue=x));class z{}z.saveConfig=!0;const K=z;let q=(()=>{var e;let t,i=[],s=[];return e=class{static resolve(...e){return(0,n.resolve)(__dirname,...e)}},t=[B({name:"paths",access:P.get})],U(null,null,t,{kind:"field",name:"obj",static:!0,private:!1,access:{has:e=>"obj"in e,get:e=>e.obj,set:(e,t)=>{e.obj=t}}},s,i),k(e,i),e.UPDATER_URL="https://verzsut.github.io/sxmle_updater",e.REPOS_URL="https://verzsut.github.io/SnowRunner-XML-Editor-Desktop",e.obj=k(e,s,{publicInfo:`${e.UPDATER_URL}/public.json`,downloadPage:`${e.REPOS_URL}/download.html`,updateFiles:`${e.UPDATER_URL}/files`,updateLegacyFiles:`${e.UPDATER_URL}/files_legacy`,updateMap:`${e.UPDATER_URL}/updateMap.json`,updateMapLegacy:`${e.UPDATER_URL}/updateMap_legacy.json`,root:e.resolve("../../"),updateRoot:e.resolve("../../../updateRoot"),updateBackupFolder:e.resolve("../../../updateRoot/.webpack/main/backups"),config:e.resolve("config.json"),texts:e.resolve("game_texts.json"),backupFolder:e.resolve("backups"),icon:e.resolve("favicon.ico"),backupInitial:e.resolve("backups/initial.pak"),backupInitialData:e.resolve("backups/previous_initial"),winrar:e.resolve("winrar"),mainTemp:e.resolve("mainTemp"),modsTemp:e.resolve("modsTemp"),strings:e.resolve("mainTemp/[strings]"),uninstall:e.resolve("../../../../unins000.exe"),classes:e.resolve("mainTemp/[media]/classes"),dlc:e.resolve("mainTemp/[media]/_dlc")}),(()=>{for(const t in e.obj)Object.defineProperty(e,t,{get:()=>e.obj[t],enumerable:!0,configurable:!1})})(),e})();const H=q,X=(()=>{var e;let t,s=[];return e=class{static findInDir(e,t,s=".xml",a){let r=[];return(0,i.existsSync)(e)?((0,i.readdirSync)(e).forEach((o=>{const c=(0,n.join)(e,o),l=(0,i.lstatSync)(c);if(t){if(!l.isDirectory())return;r.push({name:o,path:c})}l.isDirectory()&&a?r=[...r,...this.findInDir(c,!1,s,!0)]:o.indexOf(s)>=0&&r.push({name:o.replace(s,""),path:c})})),r):[]}static clearTemp(){(0,i.rmSync)(H.backupInitial,{force:!0}),(0,i.rmSync)(H.mainTemp,{recursive:!0,force:!0}),(0,i.rmSync)(H.modsTemp,{recursive:!0,force:!0}),(0,i.mkdirSync)(H.mainTemp),(0,i.mkdirSync)(H.modsTemp)}},t=[G()],U(e,null,t,{kind:"method",name:"findInDir",static:!0,private:!1,access:{has:e=>"findInDir"in e,get:e=>e.findInDir}},null,s),k(e,s),e})();function $(e){return Boolean(e?.length)}let J=(()=>{var e;let s,a,r,o=[];return e=class{static get config(){return this.obj}static set config(e){this.set(e),this.changeHandlers.forEach((e=>e()))}static emitUpdate(){this.changeHandlers.forEach((e=>e()))}static save(){try{(0,i.writeFileSync)(H.config,JSON.stringify(this.obj,null,"\t"))}catch{throw new Error("Saving configuration error")}}static set(e){for(const t in e)this.obj[t]=e[t]}static reset(e){const{version:i,buildType:n}=this.obj;this.set({version:i,buildType:n,favorites:[],initial:"",dlc:[],mods:{length:0,items:{}},settings:{updates:!0,DLC:!0,mods:!0,showWhatsNew:!0,advancedMode:!1},sizes:{initial:0,mods:{}},lang:I.EN,edited:[]}),X.clearTemp(),e?this.save():(t.app.relaunch(),t.app.quit())}static export(){return(0,i.existsSync)(H.updateBackupFolder)||(0,i.mkdirSync)(H.updateBackupFolder,{recursive:!0}),(0,i.writeFileSync)(`${H.updateBackupFolder}\\config.json`,JSON.stringify(this.obj)),!0}static import(){if(!(0,i.existsSync)((0,n.join)(H.backupFolder,"config.json")))return!1;const e=JSON.parse((0,i.readFileSync)(`${H.backupFolder}\\config.json`).toString());return!(e.version<"0.6.6d"||(K.saveConfig=!1,e.settings.showWhatsNew=!0,this.to067(e),this.to068(e),this.to074(e),e.version=this.obj.version,(0,i.writeFileSync)(H.config,JSON.stringify(e)),(0,i.rmSync)(`${H.backupFolder}\\config.json`,{force:!0}),0))}static addChangeHandler(e){this.changeHandlers.add(e)}static removeChangeHandler(e){this.changeHandlers.delete(e)}static to074(e){e.version<"0.7.4"&&(e.edited=[])}static to068(e){if(e.version<"0.6.8"){const t=e;t.settings.advancedMode=!1,delete t.settings.limits}}static to067(e){if(e.version<"0.6.7"){const t=e,i=e,n={};let s=0;if(i.initial=t.paths.initial,i.dlc=[...t.dlcList],$(t.modsList))for(const e in t.modsList)"length"!==e&&(n[e]={...t.modsList[e]},++s);i.mods={length:s,items:n},i.favorites=[],delete i.paths,delete i.dlcList,delete i.modsList,delete i.ADV,delete i.ETR,delete i.settings.resetButton,delete i.settings.devMode}}static getConfig(){const e=JSON.parse((0,i.readFileSync)(H.config).toString());if(null==e.lang){const t=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[1];e.lang=Object.keys(I).includes(t)?t:I.EN}return e}},s=[(e,t)=>{let i=String(t.name);t.addInitializer((function(){W(i,{get:e.bind(this)})}))}],a=[V()],r=[G("resetConfig")],U(e,null,s,{kind:"getter",name:"config",static:!0,private:!1,access:{has:e=>"config"in e,get:e=>e.config}},null,o),U(e,null,a,{kind:"setter",name:"config",static:!0,private:!1,access:{has:e=>"config"in e,set:(e,t)=>{e.config=t}}},null,o),U(e,null,r,{kind:"method",name:"reset",static:!0,private:!1,access:{has:e=>"reset"in e,get:e=>e.reset}},null,o),k(e,o),e.changeHandlers=new Set,e.obj=e.getConfig(),(()=>{for(const t in e.obj)Object.defineProperty(e,t,{get:()=>e.obj[t],set:i=>{e.obj[t]=i,e.emitUpdate()},enumerable:!0,configurable:!0})})(),e})();const Y=J;function Q(e){return new L(e,(()=>Y.lang),(e=>Y.addChangeHandler(e))).get()}const Z=Q(D),ee=(te=D,ie=Q,(e,t)=>{const i={...te};for(const t in e)Object.assign(i[t],e[t]);if(t)for(const e in i)Object.assign(i[e],t);return ie(i)});var te,ie;const ne=require("crypto");class se{static calc(e){return(0,i.existsSync)(e)?(0,ne.createHash)(this.ALGORITHM).update((0,i.readFileSync)(e)).digest(this.ENCODING):""}static getSize(e){return(0,i.lstatSync)(e).size}}se.ALGORITHM="sha1",se.ENCODING="hex";const ae=se;class re{static get loading(){if(this._loading&&!this._loading.isDestroyed())return this._loading}static set loading(e){this._loading=e}static openModal(e){return this.create({...e,modal:!0,parent:t.BrowserWindow.getFocusedWindow()??void 0})}static create(e){const{parent:i,preload:n,type:s,width:a=800,height:o=600,minWidth:c=0,minHeight:l=0,resizable:d=!0,show:p=!1,modal:u=!1,frame:h=!0}=e,g=new t.BrowserWindow({width:a,minWidth:c,height:o,minHeight:l,resizable:d,show:p,parent:i,modal:u,frame:h,icon:H.icon,paintWhenInitiallyHidden:!1,webPreferences:{preload:n,devTools:Y.buildType===r.dev,contextIsolation:!1,webviewTag:!1,sandbox:!1}});g.setMenuBarVisibility(!1),g.removeMenu();let m=!0;return this.onWindowReady(s,(()=>{m=!1,this.showWindow(g)})),g.loadURL(e.path).then((()=>{Y.buildType===r.dev&&setTimeout((()=>m&&this.showWindow(g)),3e3)})).catch(console.error),g}static onWindowReady(e,i){t.ipcMain.once(f.windowReady+e,i)}static showWindow(e){e&&!e.isDestroyed()&&(e.show(),e.focus())}}const oe=require("child_process");var ce,le,de;const pe=(le=ce=class{static update(e,t){return this.run([this.UPDATE,...this.IGNORE_ERRORS,t,this.inner(e),this.RECURSIVE,this.EXCLUDE_BASE_FOLDER])}static unpack(e,t,i){const n=i?this.MODS_UNPACK_LIST:this.MAIN_UNPACK_LIST;return this.run([this.UNPACK,...this.IGNORE_ERRORS,e,n,this.inner(t)])}static add(e,t){return this.run([this.ADD,...this.IGNORE_ERRORS,t,e,this.EXCLUDE_ALL_PATHS])}static run(e){return new Promise((t=>{(0,oe.execFile)(this.WINRAR_EXE,e,{cwd:H.winrar}).once("close",t).once("error",(e=>!1))}))}static inner(e){return`${e}\\`}},"symbol"==typeof(de="WinRAR")&&(de=de.description?"[".concat(de.description,"]"):""),Object.defineProperty(le,"name",{configurable:!0,value:de}),ce.MAIN_UNPACK_LIST="@unpack-list.lst",ce.MODS_UNPACK_LIST="@unpack-mod-list.lst",ce.EXCLUDE_BASE_FOLDER="-ep1",ce.EXCLUDE_ALL_PATHS="-ep",ce.RECURSIVE="-r",ce.UPDATE="f",ce.UNPACK="x",ce.ADD="a",ce.WINRAR_EXE="WinRAR.exe",ce.NO_ERRORS="-inul",ce.IN_BACKGROUND="-ibck",ce.IGNORE_ERRORS=[ce.IN_BACKGROUND,ce.NO_ERRORS],ce),ue=ee({RU:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Не удалось удалить старый бэкап initial.pak.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Не удалось удалить текущий бэкап initial.pak",SAVE_INITIAL_BACKUP_ERROR:"Не удалось сделать бэкап initial.pak.",SUCCESS_INITIAL_RESTORE:"initial.pak был успешно восстановлен.",SUCCESS_BACKUP_SAVE:"Бэкап initial.pak успешно сохранён.",SUCCESS:"Успех",ERROR:"Ошибка",ADMIN_REQUIRED_MESSAGE:"Ошибка запуска. Программа должна быть запущена от имени администратора.",ALLOW_NEW_VERSION:"Доступна новая версия программы.",NOTIFICATION:"Уведомление",INITIAL_NOT_FOUND:"initial.pak не найден.",CLASSES_NOT_FOUND:"Папка classes не найдена.",DLC_FOLDER_NOT_FOUND:"Папка с дополнениями не найдена",UNPACKING:"Распаковка",SEE_EXPORTED_MESSAGE:"В данном файле находятся параметры следующих файлов:",SUCCESS_JOIN:"Следующие файлы были объединены в один:",ONLY_MANUAL_UNINS:"Удаление возможно только вручную: удалением папки с программой.",IMPORT_CONFIG_ERROR:"Не удалось импортировать конфигурацию. Возможно вы выбрали неверный файл",SAVE_MOD_ERROR:"Не удалось сохранить файлы модификации. Нет доступа к записи файла.",SAVE_ORIGINAL_ERROR:"Не удалось обновить файлы в initial.pak. Нет доступа к записи"},EN:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Failed to delete the old initial backup.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Failed to delete the current initial backup.",SAVE_INITIAL_BACKUP_ERROR:"Failed to save initial backup.",SUCCESS_INITIAL_RESTORE:"initial.pak was successfully restored.",SUCCESS_BACKUP_SAVE:"The initial.pak backup was saved successfully.",SUCCESS:"Success",ERROR:"Error",ADMIN_REQUIRED_MESSAGE:"Startup error. The program must be run as an administrator.",ALLOW_NEW_VERSION:"A new version of the program is available.",NOTIFICATION:"Notification",INITIAL_NOT_FOUND:"initial.pak not found",CLASSES_NOT_FOUND:"Folder classes not found",DLC_FOLDER_NOT_FOUND:"DLC folder not found",UNPACKING:"Unpacking",SEE_EXPORTED_MESSAGE:"This file contains the parameters of the following files:",SUCCESS_JOIN:"The following files have been merged into one:",ONLY_MANUAL_UNINS:"Deletion is only possible manually: by deleting the program folder.",IMPORT_CONFIG_ERROR:"Failed to import configuration. You may have selected the wrong file",SAVE_MOD_ERROR:"The modification files could not be saved. There is no write access to the file.",SAVE_ORIGINAL_ERROR:"Failed to update files in initial. pak. There is no access to the record"},DE:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Die alte Erstsicherung konnte nicht gelöscht werden.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Die aktuelle Erstsicherung konnte nicht gelöscht werden.",SAVE_INITIAL_BACKUP_ERROR:"Erste Sicherung konnte nicht gespeichert werden.",SUCCESS_INITIAL_RESTORE:"initial.pak wurde erfolgreich restauriert.",SUCCESS_BACKUP_SAVE:"Die Initiale.pak backup wurde erfolgreich gespeichert.",SUCCESS:"Erfolg",ERROR:"Fehler",ADMIN_REQUIRED_MESSAGE:"Startfehler. Das Programm muss als administrator ausgeführt.",ALLOW_NEW_VERSION:"Eine neue Version des Programms ist verfügbar.",NOTIFICATION:"Norifizierung",INITIAL_NOT_FOUND:"initial.pak nicht gefunden",CLASSES_NOT_FOUND:"Klassen nicht gefunden",DLC_FOLDER_NOT_FOUND:"DLC-Ordner nicht gefunden",UNPACKING:"Auspacken",SEE_EXPORTED_MESSAGE:"Diese Datei enthält die Einstellungen der folgenden Dateien:",SUCCESS_JOIN:"Die folgenden Dateien wurden zu einem zusammengefasst:",ONLY_MANUAL_UNINS:"Das Löschen ist nur manuell möglich: Durch Löschen des Programmordners.",IMPORT_CONFIG_ERROR:"Konfiguration konnte nicht importiert werden. Möglicherweise haben Sie die falsche Datei ausgewählt",SAVE_MOD_ERROR:"Die Änderungsdateien konnten nicht gespeichert werden. Sie haben keinen Zugriff auf das Schreiben der Datei.",SAVE_ORIGINAL_ERROR:"Die Dateien in initial konnten nicht aktualisiert werden.pak. Kein Zugriff auf den Datensatz"},CH:{DELETE_OLD_INITIAL_BACKUP_ERROR:"删除旧的initial.pak备份失败。",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"删除当前initial.pak备份失败",SAVE_INITIAL_BACKUP_ERROR:"备份initial.pak失败。",SUCCESS_INITIAL_RESTORE:"initial.pak已被成功恢复。",SUCCESS_BACKUP_SAVE:"initial.pak备份已成功保存。",SUCCESS:"成功",ERROR:"误差",ADMIN_REQUIRED_MESSAGE:"启动错误。该程序必须以管理员身份启动。",ALLOW_NEW_VERSION:"新版本的软件已经问世。",NOTIFICATION:"通知书",INITIAL_NOT_FOUND:"没有找到initial.pak。",CLASSES_NOT_FOUND:"没有找到classes文件夹。",DLC_FOLDER_NOT_FOUND:"未找到增编文件夹",UNPACKING:"打开包装",SEE_EXPORTED_MESSAGE:"该文件包含以下文件的参数",SUCCESS_JOIN:"以下文件已合并为一个",ONLY_MANUAL_UNINS:"删除只能是手动的：通过卸载程序文件夹。",IMPORT_CONFIG_ERROR:"配置不能被导入。你可能选择了错误的文件",SAVE_MOD_ERROR:"修改文件无法保存。没有写入文件的权限。",SAVE_ORIGINAL_ERROR:"更新initial.pak中的文件失败。没有写入权限"}}),he=(()=>{var e;let t,s,a=[];return e=class{static get canRestoreChanges(){return(0,i.existsSync)(H.backupInitialData)&&!(0,i.existsSync)((0,n.join)(H.mainTemp,"edited"))}static async update(e,t,s){const a=(0,n.join)(e,"edited");await this.archiver.update(e,t),(0,i.existsSync)(a)||((0,i.writeFileSync)(a,""),await this.archiver.add(a,t)),this.saveSize(t,s)}static async unpack(e,t,i){this.rmDir(t),await this.archiver.unpack(e,t,i)}static publicUnpack(e,t,i){return this.unpack(e,t,i)}static async unpackMain(e=!0){await(re.loading?.showAndWait()),re.loading?.setText(ue.UNPACKING),this.clearDir(H.mainTemp),this.rmFile(H.texts),await this.unpack(Y.initial,H.mainTemp,!1),this.saveSize(Y.initial),e&&re.loading?.hide()}static async unpackMod(e){const t=this.cutDotPak(e),i=(0,n.join)(H.modsTemp,t);this.mkDir(H.modsTemp),this.clearDir(i),this.saveSize(e,!0),await this.unpack(e,i,!0)}static saveSize(e,t){const i=this.cutDotPak(e);t?Y.sizes.mods[i]=ae.getSize(e):Y.sizes.initial=ae.getSize(e),Y.emitUpdate()}static rmDir(e){(0,i.rmSync)(e,{recursive:!0,force:!0})}static rmFile(e){(0,i.rmSync)(e,{force:!0})}static mkDir(e){(0,i.existsSync)(e)||(0,i.mkdirSync)(e)}static clearDir(e){this.rmDir(e),this.mkDir(e)}static cutDotPak(e){return(0,n.basename)(e,".pak")}},t=[G("unpack")],s=[G()],U(e,null,t,{kind:"method",name:"publicUnpack",static:!0,private:!1,access:{has:e=>"publicUnpack"in e,get:e=>e.publicUnpack}},null,a),U(e,null,s,{kind:"method",name:"unpackMain",static:!0,private:!1,access:{has:e=>"unpackMain"in e,get:e=>e.unpackMain}},null,a),k(e,a),e.archiver=pe,e})(),ge=(()=>{var e;let i,n,s,a,r,o,c,d=[];return e=class{static error(e){this.alert({type:"warning",title:ue.ERROR,message:e})}static alert(e){const{dialogType:i=l.sync,buttons:n=[ue.OK],noLink:s=!1,type:a="info",title:r,message:o}=e,c={icon:t.nativeImage.createFromPath(H.icon),title:r,message:o,buttons:n,noLink:s,type:a};return i===l.sync?t.dialog.showMessageBoxSync(c):t.dialog.showMessageBox(c)}static getEPF(){return this.openDialog({extention:"epf"})}static saveEPF(e){return this.openDialog({type:h.save,defaultPath:e,extention:"epf"})}static getInitial(){return this.openDialog({extention:"pak"})}static getDir(){return this.openDialog({source:p.dir})}static getDirs(){return this.openDialog({properties:["multiSelections","openDirectory"]})}static getPaks(){return this.openDialog({properties:["multiSelections","openFile"],extention:".pak"})}static getMultiEPF(){return this.openDialog({properties:["openFile","multiSelections"],extention:"epf"})}static getXML(){return this.openDialog({extention:"xml"})}static openDialog(e){const{type:i=h.open,source:n=p.file,properties:s=(n===p.file?["openFile"]:["openDirectory"]),defaultPath:a,extention:r}=e,o={properties:s};if(r&&(o.filters=[{name:this.extNames[r],extensions:[r]}]),i===h.open){const e=t.dialog.showOpenDialogSync(o);return Array.isArray(e)?o.properties?.includes("multiSelections")?e:e[0]:void 0}return t.dialog.showSaveDialogSync({defaultPath:a,filters:o.filters})||void 0}},i=[G()],n=[G()],s=[G()],a=[G()],r=[G()],o=[G()],c=[G()],U(e,null,i,{kind:"method",name:"getEPF",static:!0,private:!1,access:{has:e=>"getEPF"in e,get:e=>e.getEPF}},null,d),U(e,null,n,{kind:"method",name:"saveEPF",static:!0,private:!1,access:{has:e=>"saveEPF"in e,get:e=>e.saveEPF}},null,d),U(e,null,s,{kind:"method",name:"getInitial",static:!0,private:!1,access:{has:e=>"getInitial"in e,get:e=>e.getInitial}},null,d),U(e,null,a,{kind:"method",name:"getDir",static:!0,private:!1,access:{has:e=>"getDir"in e,get:e=>e.getDir}},null,d),U(e,null,r,{kind:"method",name:"getDirs",static:!0,private:!1,access:{has:e=>"getDirs"in e,get:e=>e.getDirs}},null,d),U(e,null,o,{kind:"method",name:"getPaks",static:!0,private:!1,access:{has:e=>"getPaks"in e,get:e=>e.getPaks}},null,d),U(e,null,c,{kind:"method",name:"getXML",static:!0,private:!1,access:{has:e=>"getXML"in e,get:e=>e.getXML}},null,d),k(e,d),e.extNames={epf:"Editor params file",ecf:"Editor configuration file",pak:"Package file",xml:"XML file"},e})(),me=(()=>{var e;let t,i=[];return e=class{static get mainWindow(){if(this._mainWindow&&!this._mainWindow.isDestroyed())return this._mainWindow}static get setupWindow(){if(this._setupWindow&&!this._setupWindow.isDestroyed())return this._setupWindow}static register(e,t){this.windows[e]=t}static async open(e,...t){const i=await this.getCreator(e)(...t);e===T.Main&&(this._mainWindow=i),e===T.Setup&&(this._setupWindow=i),await new Promise((e=>{i.once("show",e)}))}static getCreator(e){const t=this.windows[e];if(!t)throw new Error(`Window creator for '${e}' is not defined`);return t}},t=[G("openWindow")],U(e,null,t,{kind:"method",name:"open",static:!0,private:!1,access:{has:e=>"open"in e,get:e=>e.open}},null,i),k(e,i),e.windows={},e})(),Ee=class{constructor(){this.onConfigChange=()=>{this.wind?.webContents.send(f.changeConfig)}}register(){me.register(this.type,((...e)=>this.create(...e)))}async create(...e){return this.wind=await this.creator(...e),Y.addChangeHandler(this.onConfigChange),this.wind.once("close",(()=>this.removeChangeHandler())),this.wind.once("close",(()=>this.onClose(...e))),this.wind.once("focus",(()=>this.onFocus(...e))),this.wind.once("show",(()=>this.onShow(...e))),await this.onCreate(...e),this.wind}async creator(...e){return re.create({...this.args,type:this.type})}onCreate(...e){}onFocus(...e){}onClose(...e){}onShow(...e){}removeChangeHandler(){Y.removeChangeHandler(this.onConfigChange)}},Se=class extends Ee{async creator(...e){return re.openModal({...this.args,type:this.type})}};class _e{}_e.general={setup:`file://${require("path").resolve(__dirname,"..","renderer","setup","index.html")}`,loading:`file://${require("path").resolve(__dirname,"..","renderer","loading","index.html")}`,settings:`file://${require("path").resolve(__dirname,"..","renderer","settings","index.html")}`,update:`file://${require("path").resolve(__dirname,"..","renderer","update","index.html")}`,whatsNew:`file://${require("path").resolve(__dirname,"..","renderer","whatsnew","index.html")}`,main:`file://${require("path").resolve(__dirname,"..","renderer","main","index.html")}`},_e.preload={setup:require("path").resolve(__dirname,"../renderer","setup","preload.js"),settings:require("path").resolve(__dirname,"../renderer","settings","preload.js"),main:require("path").resolve(__dirname,"../renderer","main","preload.js"),loading:require("path").resolve(__dirname,"../renderer","loading","preload.js"),whatsNew:require("path").resolve(__dirname,"../renderer","whatsnew","preload.js"),update:require("path").resolve(__dirname,"../renderer","update","preload.js")};const fe=_e;(new class extends Se{constructor(){super(...arguments),this.type=T.Loading,this.args={path:fe.general.loading,preload:fe.preload.loading,width:280,minWidth:280,height:130,minHeight:150,frame:!1}}async creator(...e){return this.initMethods(await super.creator(...e))}onCreate(){re.loading=this.wind}initMethods(e){const t=e;function i(e,i){t.webContents.postMessage(e,i)}return t.setText=e=>i("fileName",e),t.setCount=e=>i("count",e),t.setPercent=e=>i("percent",e),t.success=()=>i("success",!0),t.download=()=>i("download",!0),t.showAndWait=()=>new Promise((e=>{t.show(),setTimeout(e,100)})),t}}).register(),(new class extends Ee{constructor(){super(...arguments),this.sendingResize=!1,this.type=T.Main,this.args={path:fe.general.main,preload:fe.preload.main,width:840,minWidth:800,height:700,minHeight:630},this.onWindowResize=()=>{this.wind?.on("resize",(()=>{this.sendingResize||(this.sendingResize=!0,setTimeout((()=>{this.sendingResize=!1,this.wind?.webContents.send(f.windowResize)}),500))}))}}onCreate(){t.ipcMain.once(f.handleWindowSize,this.onWindowResize)}onShow(){he.canRestoreChanges&&me.mainWindow?.webContents.send(f.updateInitial)}onClose(){t.app.quit()}onFocus(){re.loading?.hide()}}).register(),(new class extends Se{constructor(){super(...arguments),this.type=T.Settings,this.args={path:fe.general.settings,preload:fe.preload.settings,width:400,minWidth:400,height:330,minHeight:350}}}).register(),(new class extends Ee{constructor(){super(...arguments),this.type=T.Setup,this.args={path:fe.general.setup,preload:fe.preload.setup,width:620,minWidth:620,height:290,minHeight:310}}onClose(){t.app.quit()}onFocus(){re.loading?.hide()}}).register(),(new class extends Se{constructor(){super(...arguments),this.type=T.Update,this.args={path:fe.general.update,preload:fe.preload.update,width:400,minWidth:400,height:160,minHeight:180,frame:!1}}onShow(...e){this.wind?.webContents.postMessage("content",e[0])}}).register(),(new class extends Se{constructor(){super(...arguments),this.type=T.WhatsNew,this.args={path:fe.general.whatsNew,preload:fe.preload.whatsNew,width:600,minWidth:600,height:500,minHeight:520}}onClose(){Y.settings.showWhatsNew=!1,Y.emitUpdate()}}).register();class Re{static async show(e,i){let n;if(me.mainWindow&&(n=me.mainWindow.webContents),me.setupWindow&&(n=me.setupWindow.webContents),n)return void n.send("notification",{type:i,text:e});if(!t.Notification.isSupported())return;const s=new t.Notification({title:ue.NOTIFICATION,icon:H.icon,body:e});s.show(),await new Promise((e=>s.once("click",e)))}}const Ie=(()=>{var e;let t,n,s=[];return e=class{static async save(){if((0,i.existsSync)(H.backupFolder)||(0,i.mkdirSync)(H.backupFolder),(0,i.existsSync)(H.backupInitial))try{(0,i.rmSync)(H.backupInitial)}catch{Re.show(ue.DELETE_OLD_INITIAL_BACKUP_ERROR,"error")}if(Y.buildType!==r.dev)try{(0,i.copyFileSync)(Y.initial,H.backupInitial),Re.show(ue.SUCCESS_BACKUP_SAVE,"info")}catch{Re.show(ue.SAVE_INITIAL_BACKUP_ERROR,"error")}}static async recoverFromIt(){if((0,i.existsSync)(H.backupInitial)){if((0,i.existsSync)(Y.initial))try{(0,i.rmSync)(Y.initial)}catch{ge.error(ue.DELETE_OLD_INITIAL_BACKUP_ERROR)}try{(0,i.copyFileSync)(H.backupInitial,Y.initial),await he.unpackMain(),Re.show(ue.SUCCESS_INITIAL_RESTORE,"info")}catch{ge.error(ue.DELETE_CURRENT_INITIAL_BACKUP_ERROR)}}}},t=[G("saveBackup")],n=[G("recoverFromBackup")],U(e,null,t,{kind:"method",name:"save",static:!0,private:!1,access:{has:e=>"save"in e,get:e=>e.save}},null,s),U(e,null,n,{kind:"method",name:"recoverFromIt",static:!0,private:!1,access:{has:e=>"recoverFromIt"in e,get:e=>e.recoverFromIt}},null,s),k(e,s),e})(),we=require("dns"),Ne=require("https"),Oe=(()=>{var e;let s,a=[];return e=class{static hasAdminPrivileges(){try{return(0,i.writeFileSync)(H.config,JSON.stringify(Y.config,null,"\t")),!0}catch{return re.loading?.setPercent(0),ge.alert({message:ue.ADMIN_REQUIRED_MESSAGE,type:"warning",buttons:["Exit"],title:"Error"}),setTimeout(t.app.quit,2e3),!1}}static async checkInitialChanges(){const e=!(0,i.existsSync)(Y.initial),t=(0,i.existsSync)((0,n.join)(H.mainTemp,this.MEDIA_FOLDER)),s=ae.getSize(Y.initial)===Y.sizes.initial;e||t&&s||((0,i.existsSync)(H.backupInitial)||await Ie.save(),(0,i.existsSync)(H.mainTemp)&&((0,i.existsSync)(H.backupInitialData)&&(0,i.rmSync)(H.backupInitialData,{recursive:!0,force:!0}),(0,i.renameSync)(H.mainTemp,H.backupInitialData)),await he.unpackMain(!1))}static checkUpdate(e){(Y.settings.updates||e)&&(0,we.resolve)(this.DNS_TO_RESOLVE,(e=>{e||(0,Ne.get)(H.publicInfo,(e=>{let t="";e.setEncoding("utf-8"),e.on("data",(e=>t+=e)),e.on("end",(()=>{const e=JSON.parse(t),i=Y.version,n=i<e.latestVersion,s=i.includes("-beta")&&i.split("-beta")[0]===e.latestVersion;(n||s)&&(i>=e.minVersion?me.open(T.Update,e.latestVersion):Re.show(ue.ALLOW_NEW_VERSION,"info"))}))}))}))}static hasAllPaths(){return(0,i.existsSync)(Y.initial)?(0,i.existsSync)(H.classes)?(Y.settings.DLC&&!(0,i.existsSync)(H.dlc)&&(ge.error(ue.DLC_FOLDER_NOT_FOUND),Y.settings.DLC=!1,Y.emitUpdate()),!0):(ge.error(ue.CLASSES_NOT_FOUND),!1):(ge.error(ue.INITIAL_NOT_FOUND),!1)}static hasPermissions(e){try{return(0,i.accessSync)(e,i.constants.W_OK),!0}catch{return!1}}},s=[G()],U(e,null,s,{kind:"method",name:"checkUpdate",static:!0,private:!1,access:{has:e=>"checkUpdate"in e,get:e=>e.checkUpdate}},null,a),k(e,a),e.MEDIA_FOLDER="[media]",e.DNS_TO_RESOLVE="www.google.com",e})();(()=>{var e;let t,a,r=[];e=class{static join(){const e=ge.getMultiEPF();if(e&&e.length>1){const t=[],a=[];e.forEach((e=>{const n=JSON.parse((0,i.readFileSync)(e).toString());Array.isArray(n)?n.forEach((e=>{a.includes(e.fileName)||(t.push(e),a.push(e.fileName))})):a.includes(n.fileName)||(t.push(n),a.push(n.fileName))}));const r=ge.saveEPF(this.DEFAULT_NAME);r&&((0,i.writeFileSync)(r,JSON.stringify(t,null,"\t")),ge.alert({title:s,message:`${ue.SUCCESS_JOIN}\n- ${e.map((e=>(0,n.basename)(e))).join("\n- ")}`}))}}static see(){const e=ge.getEPF();if(!e)return;const t=JSON.parse((0,i.readFileSync)(e).toString()),n=[];Array.isArray(t)?t.forEach((e=>n.push(e.fileName))):n.push(t.fileName),ge.alert({title:s,message:`${ue.SEE_EXPORTED_MESSAGE}\n\n${n.join("\n")}`})}},t=[G("joinEPF")],a=[G("seeEPF")],U(e,null,t,{kind:"method",name:"join",static:!0,private:!1,access:{has:e=>"join"in e,get:e=>e.join}},null,r),U(e,null,a,{kind:"method",name:"see",static:!0,private:!1,access:{has:e=>"see"in e,get:e=>e.see}},null,r),k(e,r),e.DEFAULT_NAME="joined"})();Y.lang,(()=>{var e;let s,a=[];e=class{static download(e,t){const{array:s,isRoot:a,inMemory:r,loadingPage:o,path:c,url:l,fromJSON:d}=e;if(s){const{url:e,path:i}=s[0];return a&&o?.setCount(s.length),o?.setText((0,n.basename)(i)),void this.download({url:e,path:i,loadingPage:o},(()=>{t(),s.length>1&&this.download({array:s.slice(1),loadingPage:o},t)}))}(0,Ne.get)(l,(e=>{if(r){let i="";e.on("data",(e=>i+=e)),e.on("end",(()=>{t(d?JSON.parse(i):i)}))}else{const n=(0,i.createWriteStream)(c);if(o){const t=parseInt(e.headers["content-length"],10);let i=0;e.on("data",(e=>{i+=e.length,o.setPercent((i/t*100).toFixed(2))}))}e.pipe(n),e.on("end",(()=>{o?.success(),n.on("close",t),n.close()}))}}))}static update(){const e=re.loading;let s=!1;e?.download(),e?.show(),X.clearTemp(),this.download({url:this.isLegacy?H.updateMapLegacy:H.updateMap,fromJSON:!0,inMemory:!0},(a=>{const r=this.processMap(a),o=r[0];let c=r[1];(0,i.mkdirSync)(H.updateRoot),o.forEach((e=>{const t=(0,n.join)(H.root,e),s=(0,n.join)(H.updateRoot,e);(0,i.existsSync)((0,n.dirname)(s))||(0,i.mkdirSync)((0,n.dirname)(s),{recursive:!0}),(0,i.copyFileSync)(t,s)})),$(c)||(K.saveConfig=!1,Y.export(),t.app.relaunch(),t.app.quit());const l=[];c.forEach((e=>{const t=this.isLegacy?H.updateLegacyFiles:H.updateFiles,s=(0,n.join)(H.updateRoot,e),a=e.replaceAll("\\","/").replace(".webpack","webpack");(0,i.existsSync)((0,n.dirname)(s))||(0,i.mkdirSync)((0,n.dirname)(s),{recursive:!0}),l.push({url:`${t}/${a}`,path:s})})),this.download({array:l,loadingPage:e,isRoot:!0},(()=>{c=c.slice(1),$(c)||s||(K.saveConfig=!1,s=!0,Y.export(),t.app.relaunch(),t.app.quit())}))}))}static processMap(e){const t=[],s=[];for(const a in e){const r=(0,n.join)(H.root,a);if((0,i.existsSync)(r)){if((0,i.lstatSync)(r).isDirectory())continue;ae.calc(r)!==e[a]?t.push(a):s.push(a)}else t.push(a)}return[s,t]}},s=[G("updateApp")],U(e,null,s,{kind:"method",name:"update",static:!0,private:!1,access:{has:e=>"update"in e,get:e=>e.update}},null,a),k(e,a),e.isLegacy=Y.version.includes("-legacy")})(),(()=>{var e;let a,r,o,c,l,d,p,u,h,g=[];e=class{static openLink(e){return t.shell.openExternal(e)}static openPath(e){return t.shell.openPath(e)}static reload(){t.app.relaunch(),t.app.quit()}static quit(){t.app.quit()}static devTools(){t.BrowserWindow.getFocusedWindow()?.webContents.toggleDevTools()}static uninstall(){(0,i.existsSync)(H.uninstall)?((0,oe.execFile)(H.uninstall),t.app.quit()):ge.alert({message:ue.ONLY_MANUAL_UNINS,title:s})}static exportConfig(){return!!Y.export()&&(ge.alert({message:ue.SUCCESS_EXPORT_MESSAGE,title:s}),!0)}static importConfig(){return Y.import()?(t.app.relaunch(),t.app.quit(),!0):(ge.alert({message:ue.IMPORT_CONFIG_ERROR,title:s}),!1)}static async updateFiles(e){if(e)try{await he.update((0,n.join)(H.modsTemp,e),Y.mods.items[e].path,!0)}catch{try{(0,i.chmodSync)(Y.mods.items[e].path,511),await he.update((0,n.join)(H.modsTemp,e),Y.mods.items[e].path,!0)}catch{ge.error(ue.SAVE_MOD_ERROR)}}else try{await he.update(H.mainTemp,Y.initial)}catch{try{(0,i.chmodSync)(Y.initial,511),await he.update(H.mainTemp,Y.initial)}catch{ge.error(ue.SAVE_ORIGINAL_ERROR)}}}},a=[G()],r=[G()],o=[G("relaunchApp")],c=[G("quitApp")],l=[G()],d=[G("runUninstall")],p=[G()],u=[G()],h=[G()],U(e,null,a,{kind:"method",name:"openLink",static:!0,private:!1,access:{has:e=>"openLink"in e,get:e=>e.openLink}},null,g),U(e,null,r,{kind:"method",name:"openPath",static:!0,private:!1,access:{has:e=>"openPath"in e,get:e=>e.openPath}},null,g),U(e,null,o,{kind:"method",name:"reload",static:!0,private:!1,access:{has:e=>"reload"in e,get:e=>e.reload}},null,g),U(e,null,c,{kind:"method",name:"quit",static:!0,private:!1,access:{has:e=>"quit"in e,get:e=>e.quit}},null,g),U(e,null,l,{kind:"method",name:"devTools",static:!0,private:!1,access:{has:e=>"devTools"in e,get:e=>e.devTools}},null,g),U(e,null,d,{kind:"method",name:"uninstall",static:!0,private:!1,access:{has:e=>"uninstall"in e,get:e=>e.uninstall}},null,g),U(e,null,p,{kind:"method",name:"exportConfig",static:!0,private:!1,access:{has:e=>"exportConfig"in e,get:e=>e.exportConfig}},null,g),U(e,null,u,{kind:"method",name:"importConfig",static:!0,private:!1,access:{has:e=>"importConfig"in e,get:e=>e.importConfig}},null,g),U(e,null,h,{kind:"method",name:"updateFiles",static:!0,private:!1,access:{has:e=>"updateFiles"in e,get:e=>e.updateFiles}},null,g),k(e,g)})();const Ae=(()=>{var e;let t,s=[],a=[];return e=class{static async getFromGame(){if((0,i.existsSync)(H.texts)&&(this.gameTexts.main=JSON.parse((0,i.readFileSync)(H.texts).toString())),(0,i.existsSync)(H.strings)){const e=(0,n.join)(H.strings,`strings_${this.locals[Y.lang]}.str`);(0,i.existsSync)(e)&&(this.gameTexts.main=this.parseFile((0,i.readFileSync)(e,{encoding:"utf16le"}).toString()),this.saveFromGame())}}static getFromMods(){const e={};for(const t in Y.mods.items)if((0,i.existsSync)((0,n.join)(H.modsTemp,t,"texts"))){const s=(0,n.join)(H.modsTemp,t,`texts/strings_${this.locals[Y.lang]}.str`);(0,i.existsSync)(s)&&(e[t]=this.parseFile((0,i.readFileSync)(s,{encoding:"utf16le"}).toString(),!0))}this.gameTexts.mods=e}static saveFromGame(){(0,i.writeFileSync)(H.texts,JSON.stringify(this.gameTexts.main,null,"\t"))}static parseFile(e,t){const i={},n=e.match(/[^\r\n]+/g);return n&&n.forEach((e=>{const n=e.split('"');if(n&&n.length>1){const n=e.split('"')[0].trimEnd().replaceAll('"',"").replaceAll("'","").replaceAll("\ufeff",""),s=e.split('"')[1].replaceAll("\\","");if(t||this.startsWith(n,["UI_VEHICLE","UI_ADDON","UI_ADDONS","UI_UPGRADE","UI_TUNING","UI_SCOUT","UI_FRAME","UI_STUFF","UI_SEMITRAILER","UI_TRAILER","UI_ROCKET","UI_TRAIN","UI_ENGINE","UI_GEARBOX","UI_SUSPENSION","UI_RIM","UI_TIRE","UI_WINCH","UI_DLC"])&&n.endsWith("NAME"))try{i[n]=s}catch{}}})),i}static startsWith(e,t){for(let i=0;i<t.length;++i)if(e.startsWith(t[i]))return!0;return!1}},t=[B({name:"texts",access:P.get})],U(null,null,t,{kind:"field",name:"gameTexts",static:!0,private:!1,access:{has:e=>"gameTexts"in e,get:e=>e.gameTexts,set:(e,t)=>{e.gameTexts=t}}},a,s),k(e,s),e.locals={RU:"russian",EN:"english",DE:"german",CH:"chinese_simplified"},e.gameTexts=k(e,a,{mods:{},main:{}}),function(t){let i=Y.lang;Y.addChangeHandler((function(){Y.lang!==i&&(i=Y.lang,e.gameTexts.main={},e.gameTexts.mods={},e.getFromGame(),e.getFromMods())}))}(),e})();var ye;ye=class{static start(){t.app.whenReady().then((()=>this.openProgram()))}static async openProgram(){await me.open(T.Loading);const e=re.loading;if(await(e?.showAndWait()),e?.setText(Z.LOADING),Oe.hasAdminPrivileges()){if(!Y.initial)return await me.open(T.Setup),void Oe.checkUpdate();await Oe.checkInitialChanges(),Oe.hasAllPaths()?(await Promise.all([Ae.getFromGame(),this.initDLC(),this.initMods()]),await me.open(T.Main),Oe.checkUpdate()):Y.reset()}}static checkMultipleInstances(){t.app.requestSingleInstanceLock()||(t.app.quit(),process.exit(102))}static optimize(){t.app.disableHardwareAcceleration()}static setName(){t.app.setAppUserModelId(s)}static handleQuit(){t.app.on("before-quit",(()=>{K.saveConfig&&Y.save(),(0,i.existsSync)(H.updateRoot)&&((0,i.rmSync)(H.root,{recursive:!0}),(0,i.renameSync)(H.updateRoot,H.root))}))}static handleAllClosed(){t.app.once("window-all-closed",(()=>t.app.exit()))}static async initDLC(){Y.settings.DLC&&(Y.dlc=X.findInDir(H.dlc,!0))}static async initMods(){if(!Y.settings.mods)return;if(!$(Y.mods))return;let e=Y.mods.length;function t(t){const i=t.replace(".pak","");delete Y.mods.items[i],--Y.mods.length,--e}for(const s in Y.mods.items){const a=Y.mods.items[s];if((0,i.existsSync)(a.path))if(Oe.hasPermissions(a.path)){if(ae.getSize(a.path)===Y.sizes.mods[s]&&(0,i.existsSync)(H.modsTemp[s]))--e;else if(await he.unpackMod(a.path),(0,i.existsSync)((0,n.join)(H.modsTemp,s,"classes"))?--e:t(Y.mods.items[s].name),0===e)return void Ae.getFromMods()}else t(Y.mods.items[s].name);else t(Y.mods.items[s].name)}e<=0&&Ae.getFromMods()}},ye.checkMultipleInstances(),ye.setName(),ye.optimize(),ye.handleQuit(),ye.handleAllClosed(),ye.start(),module.exports=e})();