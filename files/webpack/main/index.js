(()=>{"use strict";var e,n={1350:(e,n,t)=>{var i=t(2298);window.ipc={sendSync:(e,...n)=>i.ipcRenderer.sendSync(e,...n),send:(e,...n)=>i.ipcRenderer.send(e,...n),on:(e,n)=>i.ipcRenderer.on(e,n),removeAll:e=>i.ipcRenderer.removeAllListeners(e)};var o=t(7147),s=t(1017);window.service={readFileSync:e=>(0,o.readFileSync)(e).toString(),isDirectory:e=>(0,o.lstatSync)(e).isDirectory(),writeFileSync:o.writeFileSync,readdirSync:o.readdirSync,existsSync:o.existsSync,basename:s.basename,join:s.join}},9491:e=>{e.exports=require("assert")},4300:e=>{e.exports=require("buffer")},2298:e=>{e.exports=require("electron")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},5687:e=>{e.exports=require("https")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")}},t={};function i(e){var o=t[e];if(void 0!==o)return o.exports;var s=t[e]={exports:{}};return n[e].call(s.exports,s,s.exports,i),s.exports}i.m=n,i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((n,t)=>(i.f[t](e,n),n)),[])),i.u=e=>e+".index.js",i.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.ab=__dirname+"/native_modules/",e={179:1},i.f.require=(n,t)=>{e[n]||(n=>{var t=n.modules,o=n.ids,s=n.runtime;for(var r in t)i.o(t,r)&&(i.m[r]=t[r]);s&&s(i);for(var a=0;a<o.length;a++)e[o[a]]=1})(require("./"+i.u(n)))};var o={};(()=>{i.r(o);var e,n,t,s,r,a,c,l,u,d,p,E,S,f,_,h,m=i(2298),g=i(7147),R=i(1017);!function(e){e.dev="dev",e.prod="prod"}(e||(e={})),function(e){e.trucks="trucks",e.trailers="trailers"}(n||(n={})),function(e){e[e.sync=0]="sync",e[e.async=1]="async"}(t||(t={})),function(e){e[e.file=0]="file",e[e.dir=1]="dir"}(s||(s={})),function(e){e[e.open=0]="open",e[e.save=1]="save"}(r||(r={})),function(e){e.engines="engines",e.gearboxes="gearboxes",e.suspensions="suspensions",e.wheels="wheels",e.winches="winches",e.truck="truck"}(a||(a={})),function(e){e.main="main",e.dlc="dlc",e.mods="mods",e.favorites="favorites"}(c||(c={})),function(e){e.text="text",e.number="number",e.select="select",e.coordinates="coordinates",e.file="file"}(l||(l={})),function(e){e.RU="RU",e.EN="EN",e.DE="DE",e.CH="CH"}(u||(u={})),function(e){e.static="static",e.computed="computed",e.tagName="tagName"}(d||(d={})),function(e){e.integer="int",e.float="float"}(p||(p={})),function(e){e.editor="editor",e.lists="lists"}(E||(E={})),function(e){e.input="input",e.group="group"}(S||(S={})),function(e){e.mods="mods",e.dlc="dlc",e.main="main",e.favorites="favorites"}(f||(f={})),function(e){e.multiply="multiply",e.single="single"}(_||(_={})),function(e){e[e.Main=0]="Main",e[e.Settings=1]="Settings",e[e.Update=2]="Update",e[e.WhatsNew=3]="WhatsNew",e[e.Loading=4]="Loading",e[e.Setup=5]="Setup",e[e.Help=6]="Help"}(h||(h={}));const N=(...e)=>(0,R.resolve)(__dirname,...e),O="https://verzsut.github.io/sxmle_updater",I={publicInfo:`${O}/public.json`,downloadPage:"https://verzsut.github.io/SnowRunner-XML-Editor-Desktop/download.html",updateFiles:`${O}/files`,updateMap:`${O}/updateMap.json`,root:N("../../"),updateRoot:N("../../../updateRoot"),updateBackupFolder:N("../../../updateRoot/.webpack/main/backups"),config:N("config.json"),texts:N("game_texts.json"),backupFolder:N("backups"),icon:N("favicon.ico"),backupInitial:N("backups/initial.pak"),winrar:N("winrar"),mainTemp:N("mainTemp"),modsTemp:N("modsTemp"),strings:N("mainTemp/[strings]"),uninstall:N("../../../../unins000.exe"),classes:N("mainTemp/[media]/classes"),dlc:N("mainTemp/[media]/_dlc")},y=function(){const e=JSON.parse((0,g.readFileSync)(I.config).toString());if(null===e.lang){const n=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[1];e.lang=Object.keys(u).includes(n)?n:u.EN}return e}(),A=y.lang;function T(e){return e[A]}const w=T({RU:{SUCCESS_EXPORT_MESSAGE:"Конфигурация успешно экпортирована",LOADING:"Загрузка",OPEN_BUTTON:"Открыть",SAVE_BUTTON:"Сохранить",RESET_MENU_ITEM_LABEL:"Сбросить",EXPORT:"Экспорт",ERROR:"Ошибка",LANGUAGE_LABEL:"Язык программы"},EN:{SUCCESS_EXPORT_MESSAGE:"Configuration exported successfully",LOADING:"Loading",OPEN_BUTTON:"Open",SAVE_BUTTON:"Save",RESET_MENU_ITEM_LABEL:"Reset",EXPORT:"Export",ERROR:"Error",LANGUAGE_LABEL:"Program language"},DE:{SUCCESS_EXPORT_MESSAGE:"Konfiguration erfolgreich exportiert",LOADING:"Herunterladen",OPEN_BUTTON:"Öffnen",SAVE_BUTTON:"Datei",RESET_MENU_ITEM_LABEL:"Zurücksetzen",EXPORT:"Export",ERROR:"Fehler",LANGUAGE_LABEL:"Programmsprache"},CH:{SUCCESS_EXPORT_MESSAGE:"配置已成功导出",LOADING:"下载",OPEN_BUTTON:"打开",SAVE_BUTTON:"保存",RESET_MENU_ITEM_LABEL:"重置",EXPORT:"出口",ERROR:"误差",LANGUAGE_LABEL:"方案语言"}}),L=require("child_process"),U={properties:[],functions:[]},C=!!m.ipcMain;function D(e){e.forEach((e=>{Array.isArray(e)?v(...e):v(e)}))}function v(e,n){const{functions:t}=U,i=n??e.name;if(!C||t.includes(n))return;const o=`function_${i}_call`;t.includes(i)||t.push(i),m.ipcMain.on(o,((n,...t)=>{try{const i=e(...t);n.returnValue=i instanceof Promise?{value:void 0}:{value:i}}catch(e){n.returnValue={error:e}}}))}const x=require("crypto");function k(e){return(0,g.lstatSync)(e).size}const F={},P={RU:"russian",EN:"english",DE:"german",CH:"chinese_simplified"},b={mods:{},game:{}};async function M(){if((0,g.existsSync)(I.texts)&&(b.game=JSON.parse((0,g.readFileSync)(I.texts).toString())),(0,g.existsSync)(I.strings)){const e=(0,R.join)(I.strings,`strings_${P[y.lang]}.str`);(0,g.existsSync)(e)&&(b.game=V((0,g.readFileSync)(e,{encoding:"utf16le"}).toString()),(0,g.writeFileSync)(I.texts,JSON.stringify(b.game,null,"\t")))}}function G(){const e={};for(const n in y.mods.items)if((0,g.existsSync)((0,R.join)(I.modsTemp,n,"texts"))){const t=(0,R.join)(I.modsTemp,n,`texts/strings_${P[y.lang]}.str`);(0,g.existsSync)(t)&&(e[n]=V((0,g.readFileSync)(t,{encoding:"utf16le"}).toString(),!0))}b.mods=e}function V(e,n){const t={},i=e.match(/[^\r\n]+/g);return i&&i.forEach((e=>{const i=e.split('"');if(i&&i.length>1){const i=e.split('"')[0].trimEnd().replaceAll('"',"").replaceAll("'","").replaceAll("\ufeff",""),o=e.split('"')[1].replaceAll("\\","");if(n||function(e,n){for(let t=0;t<n.length;++t)if(e.startsWith(n[t]))return!0;return!1}(i,["UI_VEHICLE","UI_ADDON","UI_ADDONS","UI_UPGRADE","UI_TUNING","UI_SCOUT","UI_FRAME","UI_STUFF","UI_SEMITRAILER","UI_TRAILER","UI_ROCKET","UI_TRAIN","UI_ENGINE","UI_GEARBOX","UI_SUSPENSION","UI_RIM","UI_TIRE","UI_WINCH"])&&i.endsWith("NAME"))try{t[i]=o}catch{}}})),t}const B=T({RU:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Не удалось удалить старый бэкап initial.pak.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Не удалось удалить текущий бэкап initial.pak",SAVE_INITIAL_BACKUP_ERROR:"Не удалось сделать бэкап initial.pak.",SUCCESS_INITIAL_RESTORE:"initial.pak был успешно восстановлен.",SUCCESS_BACKUP_SAVE:"Бэкап initial.pak успешно сохранён.",SUCCESS:"Успех",ERROR:"Ошибка",ADMIN_REQUIRED_MESSAGE:"Ошибка запуска. Программа должна быть запущена от имени администратора.",ALLOW_NEW_VERSION:"Доступна новая версия программы. Нажмите чтобы перейти на страницу скачивания.",NOTIFICATION:"Уведомление",INITIAL_NOT_FOUND:"initial.pak не найден.",CLASSES_NOT_FOUND:"Папка classes не найдена.",DLC_FOLDER_NOT_FOUND:"Папка с дополнениями не найдена",UNPACKING:"Распаковка",SEE_EXPORTED_MESSAGE:"В данном файле находятся параметры следующих файлов:",SUCCESS_JOIN:"Следующие файлы были объединены в один:",ONLY_MANUAL_UNINS:"Удаление возможно только вручную: удалением папки с программой.",IMPORT_CONFIG_ERROR:"Не удалось импортировать конфигурацию. Возможно вы выбрали неверный файл",SAVE_MOD_ERROR:"Не удалось сохранить файлы модификации. Нет доступа к записи файла.",SAVE_ORIGINAL_ERROR:"Не удалось обновить файлы в initial.pak. Нет доступа к записи",SAVE_CONFIG_ERROR:"Не удалось сохранить конфиг."},EN:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Failed to delete the old initial backup.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Failed to delete the current initial backup.",SAVE_INITIAL_BACKUP_ERROR:"Failed to save initial backup.",SUCCESS_INITIAL_RESTORE:"initial.pak was successfully restored.",SUCCESS_BACKUP_SAVE:"The initial.pak backup was saved successfully.",SUCCESS:"Success",ERROR:"Error",ADMIN_REQUIRED_MESSAGE:"Startup error. The program must be run as an administrator.",ALLOW_NEW_VERSION:"A new version of the program is available. Click to go to the download page.",NOTIFICATION:"Notification",INITIAL_NOT_FOUND:"initial.pak not found",CLASSES_NOT_FOUND:"Folder classes not found",DLC_FOLDER_NOT_FOUND:"DLC folder not found",UNPACKING:"Unpacking",SEE_EXPORTED_MESSAGE:"This file contains the parameters of the following files:",SUCCESS_JOIN:"The following files have been merged into one:",ONLY_MANUAL_UNINS:"Deletion is only possible manually: by deleting the program folder.",IMPORT_CONFIG_ERROR:"Failed to import configuration. You may have selected the wrong file",SAVE_MOD_ERROR:"The modification files could not be saved. There is no write access to the file.",SAVE_ORIGINAL_ERROR:"Failed to update files in initial. pak. There is no access to the record",SAVE_CONFIG_ERROR:"Failed to save the config."},DE:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Die alte Erstsicherung konnte nicht gelöscht werden.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Die aktuelle Erstsicherung konnte nicht gelöscht werden.",SAVE_INITIAL_BACKUP_ERROR:"Erste Sicherung konnte nicht gespeichert werden.",SUCCESS_INITIAL_RESTORE:"initial.pak wurde erfolgreich restauriert.",SUCCESS_BACKUP_SAVE:"Die Initiale.pak backup wurde erfolgreich gespeichert.",SUCCESS:"Erfolg",ERROR:"Fehler",ADMIN_REQUIRED_MESSAGE:"Startfehler. Das Programm muss als administrator ausgeführt.",ALLOW_NEW_VERSION:"Eine neue Version des Programms ist verfügbar. Klicken Sie hier, um zur Download-Seite zu gelangen.",NOTIFICATION:"Norifizierung",INITIAL_NOT_FOUND:"initial.pak nicht gefunden",CLASSES_NOT_FOUND:"Klassen nicht gefunden",DLC_FOLDER_NOT_FOUND:"DLC-Ordner nicht gefunden",UNPACKING:"Auspacken",SEE_EXPORTED_MESSAGE:"Diese Datei enthält die Einstellungen der folgenden Dateien:",SUCCESS_JOIN:"Die folgenden Dateien wurden zu einem zusammengefasst:",ONLY_MANUAL_UNINS:"Das Löschen ist nur manuell möglich: Durch Löschen des Programmordners.",IMPORT_CONFIG_ERROR:"Konfiguration konnte nicht importiert werden. Möglicherweise haben Sie die falsche Datei ausgewählt",SAVE_MOD_ERROR:"Die Änderungsdateien konnten nicht gespeichert werden. Sie haben keinen Zugriff auf das Schreiben der Datei.",SAVE_ORIGINAL_ERROR:"Die Dateien in initial konnten nicht aktualisiert werden.pak. Kein Zugriff auf den Datensatz",SAVE_CONFIG_ERROR:"Die Konfiguration konnte nicht gespeichert werden."},CH:{DELETE_OLD_INITIAL_BACKUP_ERROR:"删除旧的initial.pak备份失败。",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"删除当前initial.pak备份失败",SAVE_INITIAL_BACKUP_ERROR:"备份initial.pak失败。",SUCCESS_INITIAL_RESTORE:"initial.pak已被成功恢复。",SUCCESS_BACKUP_SAVE:"initial.pak备份已成功保存。",SUCCESS:"成功",ERROR:"误差",ADMIN_REQUIRED_MESSAGE:"启动错误。该程序必须以管理员身份启动。",ALLOW_NEW_VERSION:"新版本的软件已经问世。点击进入下载页面。",NOTIFICATION:"通知书",INITIAL_NOT_FOUND:"没有找到initial.pak。",CLASSES_NOT_FOUND:"没有找到classes文件夹。",DLC_FOLDER_NOT_FOUND:"未找到增编文件夹",UNPACKING:"打开包装",SEE_EXPORTED_MESSAGE:"该文件包含以下文件的参数",SUCCESS_JOIN:"以下文件已合并为一个",ONLY_MANUAL_UNINS:"删除只能是手动的：通过卸载程序文件夹。",IMPORT_CONFIG_ERROR:"配置不能被导入。你可能选择了错误的文件",SAVE_MOD_ERROR:"修改文件无法保存。没有写入文件的权限。",SAVE_ORIGINAL_ERROR:"更新initial.pak中的文件失败。没有写入权限",SAVE_CONFIG_ERROR:"无法保存配置。"}}),W={loading:null};function j(e){return q({...e,modal:!0,parent:m.BrowserWindow.getFocusedWindow()})}function q(n){const{width:t=800,height:i=600,minWidth:o=0,minHeight:s=0,resizable:r=!0,show:a=!1,modal:c=!1,frame:l=!0,parent:u,preload:d,type:p}=n,{icon:E}=I,S=new m.BrowserWindow({width:t,minWidth:o,height:i,minHeight:s,resizable:r,show:a,parent:u,modal:c,frame:l,icon:E,paintWhenInitiallyHidden:!1,webPreferences:{preload:d,devTools:y.buildType===e.dev,contextIsolation:!1,webviewTag:!1,sandbox:!1}});return S.setMenuBarVisibility(!1),S.removeMenu(),m.ipcMain.once(`window-${p}-ready`,(()=>{S&&!S.isDestroyed()&&(S.show(),S.focus(),F.devTools&&S.webContents.toggleDevTools())})),S.loadURL(n.path).catch((e=>console.error(e))),S}const{UNPACKING:K}=B,$="WinRAR.exe",J=()=>F.debugWinRAR?[]:["-ibck","-inul"];function X(e,n,t){te(["f",...J(),n,oe(e),"-r","-ep1"]),Y(n,t)}async function z(e,n,t,i){const o=t?"@unpack-mod-list.lst":"@unpack-list.lst";Z(n),await te(["x",...J(),e,o,oe(n)],i)}async function H(e=!0){var n;await W.loading.showAndWait(),W.loading.setText(K),ne(I.mainTemp),n=I.texts,(0,g.rmSync)(n,{force:!0}),await z(y.initial,I.mainTemp,!1,!0),Y(y.initial),e&&W.loading.hide()}async function Q(e){const n=ie(e),t=(0,R.join)(I.modsTemp,n);ee(I.modsTemp),ne(t),Y(e,!0),await z(e,t,!0)}function Y(e,n){const t=ie(e);n?y.sizes.mods[t]=k(e):y.sizes.initial=k(e)}function Z(e){(0,g.rmSync)(e,{recursive:!0,force:!0})}function ee(e){(0,g.existsSync)(e)||(0,g.mkdirSync)(e)}function ne(e){Z(e),ee(e)}function te(e,n=!0){if(!n)return new Promise((n=>{(0,L.execFile)($,e,{cwd:I.winrar}).once("close",n).once("error",(e=>!1))}));try{(0,L.execFileSync)($,e,{cwd:I.winrar})}catch(e){}}function ie(e){return(0,R.basename)(e,".pak")}function oe(e){return`${e}\\`}D([[H,"unpackMain"],[function(e,n,t){z(e,n,t,!0)},"unpack"]]);const se=require("dns");var re=i(5687);function ae(e,n){ce[e]=n}const ce={},le={rootPreload:1350,setup:`file://${require("path").resolve(__dirname,"..","renderer","setup","index.html")}`,loading:`file://${require("path").resolve(__dirname,"..","renderer","loading","index.html")}`,settings:`file://${require("path").resolve(__dirname,"..","renderer","settings","index.html")}`,update:`file://${require("path").resolve(__dirname,"..","renderer","update","index.html")}`,whatsNew:`file://${require("path").resolve(__dirname,"..","renderer","whatsNew","index.html")}`,main:`file://${require("path").resolve(__dirname,"..","renderer","main","index.html")}`,setupPreload:require("path").resolve(__dirname,"../renderer","setup","preload.js"),settingsPreload:require("path").resolve(__dirname,"../renderer","settings","preload.js"),mainPreload:require("path").resolve(__dirname,"../renderer","main","preload.js"),loadingPreload:require("path").resolve(__dirname,"../renderer","loading","preload.js"),whatsNewPreload:require("path").resolve(__dirname,"../renderer","whatsNew","preload.js"),updatePreload:require("path").resolve(__dirname,"../renderer","update","preload.js")},ue={path:le.loading,preload:le.loadingPreload,width:280,minWidth:280,height:130,minHeight:150,frame:!1,type:h.Loading};ae(h.Loading,(async()=>{const e=q(ue);function n(e,n){W.loading.webContents.postMessage(e,n)}return e.setText=e=>n("fileName",e),e.setCount=e=>n("count",e),e.setPercent=e=>n("percent",e),e.success=()=>n("success",!0),e.download=()=>n("download",!0),e.showAndWait=()=>new Promise((n=>{e.show(),setTimeout(n,100)})),W.loading=e}));const de={path:le.main,preload:le.mainPreload,width:840,minWidth:800,height:700,minHeight:630,type:h.Main};ae(h.Main,(async()=>{const e=q(de);return m.ipcMain.once("enable-list-resize",(()=>{e.on("resize",(()=>{e.webContents.send("window-resize")}))})),e.once("close",(()=>{m.app.quit()})),e.once("focus",(()=>{W.loading.hide()})),e}));const pe={path:le.settings,preload:le.settingsPreload,width:400,minWidth:400,height:330,minHeight:350,type:h.Settings};ae(h.Settings,(async()=>j(pe)));const Ee={path:le.setup,preload:le.setupPreload,width:620,minWidth:620,height:290,minHeight:310,type:h.Setup};ae(h.Setup,(async()=>{const e=q(Ee);return e.once("focus",(()=>{W.loading.hide()})),e.once("close",m.app.quit),e}));const Se={path:le.update,preload:le.updatePreload,width:400,minWidth:400,height:160,minHeight:180,frame:!1,type:h.Update};ae(h.Update,(async(...e)=>{const n=j(Se);return n.once("show",(()=>n.webContents.postMessage("content",e[0]))),n}));const fe={path:le.whatsNew,preload:le.whatsNewPreload,width:600,minWidth:600,height:500,minHeight:520,type:h.WhatsNew};async function _e(e,...n){const t=await ce[e](...n);await new Promise((e=>{t.once("show",e)}))}ae(h.WhatsNew,(async()=>{const e=j(fe);return e.once("close",(()=>y.settings.showWhatsNew=!1)),e})),D([[_e,"openWindow"]]);const{ERROR:he}=B,me={epf:"Editor params file",ecf:"Editor configuration file",pak:"Package file",xml:"XML file"};function ge(e){Re({type:"warning",title:he,message:e})}function Re(e){const{dialogType:n=t.sync,buttons:i=["OK"],noLink:o=!1,type:s="info",title:r,message:a}=e,c={icon:m.nativeImage.createFromPath(I.icon),title:r,message:a,buttons:i,noLink:o,type:s};return n===t.sync?m.dialog.showMessageBoxSync(c):m.dialog.showMessageBox(c)}function Ne(){return Ie({extention:"epf"})}function Oe(e){return Ie({type:r.save,defaultPath:e,extention:"epf"})}function Ie(e){const{type:n=r.open,source:t=s.file,properties:i=(t===s.file?["openFile"]:["openDirectory"]),defaultPath:o,extention:a}=e,c={properties:i};if(a&&(c.filters=[{name:me[a],extensions:[a]}]),n===r.open){const e=m.dialog.showOpenDialogSync(c);if(e instanceof Array)return c.properties.includes("multiSelections")?e:e[0]}else{const e={defaultPath:o,filters:c.filters},n=m.dialog.showSaveDialogSync(e);if(n)return n}}async function ye(e,n){if(m.Notification.isSupported()){const t=new m.Notification({title:e,icon:I.icon,body:n});t.show(),await new Promise((e=>t.once("click",e)))}}D([[function(){return Ie({extention:"xml"})},"getXML"],[Ne,"getEPF"],[Oe,"saveEPF"],[function(){return Ie({extention:"pak"})},"getInitial"],[function(){return Ie({source:s.dir})},"getDir"]]);const{DELETE_OLD_INITIAL_BACKUP_ERROR:Ae,DELETE_CURRENT_INITIAL_BACKUP_ERROR:Te,SAVE_INITIAL_BACKUP_ERROR:we,SUCCESS_INITIAL_RESTORE:Le,SUCCESS_BACKUP_SAVE:Ue,SUCCESS:Ce}=B;async function De(n,t){if(await H(t),(0,g.existsSync)(I.backupFolder)||(0,g.mkdirSync)(I.backupFolder),(0,g.existsSync)(I.backupInitial))try{(0,g.rmSync)(I.backupInitial)}catch{throw new Error(Ae)}y.buildType===e.prod&&ve(),n&&(F.isQuit=!0,m.app.relaunch(),m.app.quit())}function ve(){try{(0,g.copyFileSync)(y.initial,I.backupInitial),ye(Ce,Ue)}catch{throw new Error(we)}}D([[De,"saveBackup"],[ve,"copyBackup"],[async function(){if((0,g.existsSync)(I.backupInitial)){if((0,g.existsSync)(y.initial))try{(0,g.rmSync)(y.initial)}catch{ge(Ae)}try{(0,g.copyFileSync)(I.backupInitial,y.initial),await H(),await ye(Ce,Le)}catch{ge(Te)}}},"recoverFromBackup"]]);const{ADMIN_REQUIRED_MESSAGE:xe,ALLOW_NEW_VERSION:ke,NOTIFICATION:Fe,INITIAL_NOT_FOUND:Pe,CLASSES_NOT_FOUND:be,DLC_FOLDER_NOT_FOUND:Me}=B;function Ge(e){(y.settings.updates||e)&&(0,se.resolve)("www.google.com",(e=>{e||(0,re.get)(I.publicInfo,(e=>{let n="";e.setEncoding("utf-8"),e.on("data",(e=>n+=e)),e.on("end",(()=>{const e=JSON.parse(n);(y.version<e.latestVersion||y.version.includes("-beta")&&y.version.split("-beta")[0]===e.latestVersion)&&(y.version>=e.minVersion?_e(h.Update,e.latestVersion):ye(Fe,ke).then((()=>{m.shell.openExternal(I.downloadPage)})))}))}))}))}function Ve(e){try{return(0,g.accessSync)(e,g.constants.W_OK),!0}catch{return!1}}function Be(e,n,t=".xml",i){let o=[];return(0,g.existsSync)(e)?((0,g.readdirSync)(e).forEach((s=>{const r=(0,R.join)(e,s),a=(0,g.lstatSync)(r);if(n){if(!a.isDirectory())return;o.push({name:s,path:r})}a.isDirectory()&&i?o=[...o,...Be(r,!1,t,!0)]:s.indexOf(t)>=0&&o.push({name:s.replace(t,""),path:r})})),o):[]}function We(){(0,g.rmSync)(I.backupInitial,{force:!0}),(0,g.rmSync)(I.mainTemp,{recursive:!0,force:!0}),(0,g.rmSync)(I.modsTemp,{recursive:!0,force:!0}),(0,g.mkdirSync)(I.mainTemp),(0,g.mkdirSync)(I.modsTemp)}D([[Ge,"checkUpdate"]]);const{SAVE_CONFIG_ERROR:je}=B;function qe(){try{(0,g.writeFileSync)(I.config,JSON.stringify(y,null,"\t"))}catch{throw new Error(je)}}function Ke(e){const{version:n,buildType:t}=y;!function(e){for(const n in e)y[n]=e[n]}({version:n,buildType:t,favorites:[],initial:null,dlc:[],mods:{length:0,items:{}},settings:{updates:!0,DLC:!0,mods:!0,showWhatsNew:!0,advancedMode:!1},sizes:{initial:null,mods:{}},lang:null}),We(),e?qe():(m.app.relaunch(),m.app.quit())}function $e(e=!0){if(e)return(0,g.existsSync)(I.updateBackupFolder)||(0,g.mkdirSync)(I.updateBackupFolder,{recursive:!0}),(0,g.writeFileSync)(`${I.updateBackupFolder}\\config.json`,JSON.stringify(y)),!0;const n=Ie({extention:"ecf",type:r.save,defaultPath:"config.ecf"});if(!n)return!1;const t={...y,type:"SXMLE_CONFIGURATION"};return(0,g.writeFileSync)(n,JSON.stringify(t,null,"\t")),!0}D([[Ke,"resetConfig"]]);const{SEE_EXPORTED_MESSAGE:Je,SUCCESS_JOIN:Xe}=B;function ze(e,n){const{array:t,isRoot:i,inMemory:o,loadingPage:s,path:r,url:a,fromJSON:c}=e;if(t){const{url:e,path:o}=t[0];return i&&s.setCount(t.length),s.setText((0,R.basename)(o)),void ze({url:e,path:o,loadingPage:s},(()=>{n(),t.length>1&&ze({array:t.slice(1),loadingPage:s},n)}))}(0,re.get)(a,(e=>{if(o){let t="";e.on("data",(e=>t+=e)),e.on("end",(()=>{n(c?JSON.parse(t):t)}))}else{const t=(0,g.createWriteStream)(r);if(s){const n=parseInt(e.headers["content-length"],10);let t=0;e.on("data",(e=>{t+=e.length,s.setPercent((t/n*100).toFixed(2))}))}e.pipe(t),e.on("end",(()=>{s.success(),t.on("close",n),t.close()}))}}))}D([[function(){const e=Ne();if(!e)return;const n=JSON.parse((0,g.readFileSync)(e).toString()),t=[];n instanceof Array?n.forEach((e=>t.push(e.fileName))):t.push(n.fileName),Re({title:F.appId,message:`${Je}\n\n${t.join("\n")}`})},"seeEPF"],[function(){const e=Ie({properties:["openFile","multiSelections"],extention:"epf"});if(e&&e.length>1){const n=[],t=[];e.forEach((e=>{const i=JSON.parse((0,g.readFileSync)(e).toString());i instanceof Array?i.forEach((e=>{t.includes(e.fileName)||(n.push(e),t.push(e.fileName))})):t.includes(i.fileName)||(n.push(i),t.push(i.fileName))}));const i=Oe("joined");i&&((0,g.writeFileSync)(i,JSON.stringify(n,null,"\t")),Re({title:F.appId,message:`${Xe}\n- ${e.map((e=>(0,R.basename)(e))).join("\n- ")}`}))}},"joinEPF"]]),D([[function(){const e=W.loading;let n=!1;e.download(),e.show(),We(),ze({url:I.updateMap,fromJSON:!0,inMemory:!0},(t=>{const i=function(e){const n=[],t=[];for(const o in e){const s=(0,R.join)(I.root,o);if((0,g.existsSync)(s)){if((0,g.lstatSync)(s).isDirectory())continue;i=s,((0,g.existsSync)(i)?(0,x.createHash)("sha1").update((0,g.readFileSync)(i)).digest("hex"):"")!==e[o]?n.push(o):t.push(o)}else n.push(o)}var i;return[t,n]}(t),o=i[0];let s=i[1];(0,g.mkdirSync)(I.updateRoot),o.forEach((e=>{const n=(0,R.join)(I.root,e),t=(0,R.join)(I.updateRoot,e);(0,g.existsSync)((0,R.dirname)(t))||(0,g.mkdirSync)((0,R.dirname)(t),{recursive:!0}),(0,g.copyFileSync)(n,t)})),0===s.length&&(F.saveWhenReload=!1,$e(),F.isQuit=!0,m.app.relaunch(),m.app.quit());const r=[];s.forEach((e=>{const n=(0,R.join)(I.updateRoot,e),t=e.replaceAll("\\","/").replace(".webpack","webpack"),i=`${I.updateFiles}/${t}`;(0,g.existsSync)((0,R.dirname)(n))||(0,g.mkdirSync)((0,R.dirname)(n),{recursive:!0}),r.push({url:i,path:n})})),ze({array:r,loadingPage:e,isRoot:!0},(()=>{s=s.slice(1),0===s.length&&!1===n&&(F.saveWhenReload=!1,F.isQuit=!0,n=!0,$e(),m.app.relaunch(),m.app.quit())}))}))},"updateApp"]]);const{ONLY_MANUAL_UNINS:He,IMPORT_CONFIG_ERROR:Qe,SAVE_MOD_ERROR:Ye,SAVE_ORIGINAL_ERROR:Ze}=B,{SUCCESS_EXPORT_MESSAGE:en}=w;var nn;m.ipcMain.on("getInfo",(e=>{e.returnValue=U})),nn={texts:()=>b,paths:()=>I,config:[()=>y,e=>y[e.key]=e.value]},Object.entries(nn).forEach((([e,n])=>function(e,n){const{properties:t}=U;if(!C||t.includes(e))return;const i=`property_${e}_get`,o=`property_${e}_set`;if(t.includes(e)||t.push(e),Array.isArray(n)&&n.length>0){const e=n[0],t=n[1];"function"==typeof e&&m.ipcMain.on(i,(n=>{try{const t=e();n.returnValue={value:t}}catch(e){n.returnValue={error:e}}})),"function"==typeof t&&m.ipcMain.on(o,((e,...n)=>{try{t(n[0]),e.returnValue={value:null}}catch(n){e.returnValue={error:n}}}))}else"function"==typeof n&&m.ipcMain.on(i,(e=>{try{const t=n();e.returnValue={value:t}}catch(n){e.returnValue={error:n}}}))}(e,n))),D([[function(e=null){if(null===e){const e=m.BrowserWindow.getFocusedWindow();e&&e.webContents.toggleDevTools()}else F.devTools=e},"devTools"],[Be,"findInDir"],[function(e){if(e)try{X((0,R.join)(I.modsTemp,e),y.mods.items[e].path,!0)}catch{try{(0,g.chmodSync)(y.mods.items[e].path,511),X((0,R.join)(I.modsTemp,e),y.mods.items[e].path,!0)}catch{ge(Ye)}}else try{X(I.mainTemp,y.initial)}catch{try{(0,g.chmodSync)(y.initial,511),X(I.mainTemp,y.initial)}catch{ge(Ze)}}},"updateFiles"],[function(e=!0){return!!$e(e)&&(Re({message:en,title:F.appId}),!0)},"exportConfig"],[function(e=!0){return function(e=!0){let n;if(e){if(!(0,g.existsSync)((0,R.join)(I.backupFolder,"config.json")))return!1;n=JSON.parse((0,g.readFileSync)(`${I.backupFolder}\\config.json`).toString())}else{const e=Ie({extention:"ecf"});if(!e||!(0,g.existsSync)(e))return!1;if(n=JSON.parse((0,g.readFileSync)(e).toString()),"SXMLE_CONFIGURATION"!==n.type)return!1;delete n.type}return F.saveWhenReload=!1,n.settings.showWhatsNew=!0,function(e){e.version<"0.6.6d"&&(delete e.sums,e.sizes={initial:null,mods:{}})}(n),function(e){if(e.version<"0.6.7"){const n={};let t=0;if(e.initial=e.paths.initial,e.dlc=[...e.dlcList],0!==e.modsList.length)for(const i in e.modsList)"length"!==i&&(n[i]={...e.modsList[i]},++t);e.mods={length:t,items:n},e.favorites=[],delete e.paths,delete e.dlcList,delete e.modsList,delete e.ADV,delete e.ETR,delete e.settings.resetButton,delete e.settings.devMode}}(n),function(e){e.version<"0.6.8"&&(e.settings.advancedMode=!1)}(n),n.version=y.version,(0,g.writeFileSync)(I.config,JSON.stringify(n)),e&&(0,g.rmSync)(`${I.backupFolder}\\config.json`,{force:!0}),!0}(e)?(F.isQuit=!0,m.app.relaunch(),m.app.quit(),!0):(Re({message:Qe,title:F.appId}),!1)},"importConfig"],[m.shell.openExternal,"openLink"],[m.shell.openPath,"openPath"],[function(){(0,g.existsSync)(I.uninstall)?((0,L.execFile)(I.uninstall),F.isQuit=!0,m.app.quit()):Re({message:He,title:F.appId})},"runUninstall"],[function(){F.isQuit=!0,m.app.relaunch(),m.app.quit()},"relaunchApp"],[function(){F.isQuit=!0,m.app.quit()},"quitApp"]]);const{LOADING:tn}=w;var on;async function sn(){await _e(h.Loading);const e=W.loading;if(await e.showAndWait(),e.setText(tn),function(){try{return(0,g.writeFileSync)(I.config,JSON.stringify(y,null,"\t")),!0}catch{return W.loading.setPercent(0),Re({message:xe,type:"warning",buttons:["Exit"],title:"Error"}),setTimeout(m.app.quit,2e3),!1}}()){if(!y.initial)return await _e(h.Setup),void Ge();await async function(){(0,g.existsSync)((0,R.join)(I.mainTemp,"[media]"))&&k(y.initial)===y.sizes.initial||(0,g.existsSync)(y.initial)&&((0,g.existsSync)(I.backupInitial)?await H(!1):await De())}(),((0,g.existsSync)(y.initial)?(0,g.existsSync)(I.classes)?(y.settings.DLC&&!(0,g.existsSync)(I.dlc)&&(ge(Me),y.settings.DLC=!1),1):(ge(be),0):(ge(Pe),0))?(await Promise.all([M(),rn(),an()]),await _e(h.Main),Ge()):Ke()}}async function rn(){y.settings.DLC&&(y.dlc=Be(I.dlc,!0))}async function an(){if(!y.settings.mods)return;if(0===y.mods.length)return;let e=y.mods.length;function n(n){const t=n.replace(".pak","");delete y.mods.items[t],--y.mods.length,--e}for(const t in y.mods.items){const i=y.mods.items[t];if((0,g.existsSync)(i.path))if(Ve(i.path)){if(k(i.path)===y.sizes.mods[t]&&(0,g.existsSync)(I.modsTemp[t]))--e;else if(await Q(i.path),(0,g.existsSync)((0,R.join)(I.modsTemp,t,"classes"))?--e:n(y.mods.items[t].name),0===e)return void G()}else n(y.mods.items[t].name);else n(y.mods.items[t].name)}e<=0&&G()}on={appId:"SnowRunner XML editor",saveWhenReload:!0,devTools:!1,debugWinRAR:!1},Object.assign(F,on),m.app.requestSingleInstanceLock()||(m.app.quit(),process.exit(102)),y.buildType===e.dev?m.app.whenReady().then((()=>i.e(572).then(i.bind(i,4572)))).then((({default:e,REDUX_DEVTOOLS:n,REACT_DEVELOPER_TOOLS:t})=>{e([n,t],{loadExtensionOptions:{allowFileAccess:!0}}).then(sn)})).catch((e=>console.error("Failed install extension:",e))):m.app.whenReady().then(sn),m.app.disableHardwareAcceleration(),m.app.setAppUserModelId(F.appId),m.app.on("before-quit",(()=>{F.isQuit=!0,F.saveWhenReload&&qe(),(0,g.existsSync)(I.updateRoot)&&((0,g.rmSync)(I.root,{recursive:!0}),(0,g.renameSync)(I.updateRoot,I.root))})),m.app.once("window-all-closed",(()=>m.app.exit()))})(),module.exports=o})();