(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}};void 0!==e&&(e.ab=__dirname+"/native_modules/");var t={};e.r(t);const n=require("electron"),i=require("fs"),s=require("path"),r="SnowRunner XML Editor";var a;!function(e){e.dev="dev",e.prod="prod"}(a||(a={}));const o=a;var c,l;!function(e){e.trucks="trucks",e.trailers="trailers"}(c||(c={})),function(e){e.sync="sync",e.async="async"}(l||(l={}));const d=l;var p;!function(e){e.file="file",e.dir="dir"}(p||(p={}));const u=p;var h;!function(e){e.open="open",e.save="save"}(h||(h={}));const g=h;var f,m,E,S,w;!function(e){e.engines="engines",e.gearboxes="gearboxes",e.suspensions="suspensions",e.wheels="wheels",e.winches="winches",e.truck="truck"}(f||(f={})),function(e){e.main="main",e.dlc="dlc",e.mods="mods",e.favorites="favorites"}(m||(m={})),function(e){e.text="text",e.number="number",e.select="select",e.coordinates="coordinates",e.file="file"}(E||(E={})),(w=S||(S={})).changeConfig="change-config",w.windowReady="window-ready-",w.windowResize="window-resize",w.handleWindowSize="handle-window-size";const _=S;var v;!function(e){e.RU="RU",e.EN="EN",e.DE="DE",e.CH="CH"}(v||(v={}));const y=v;var O,R,I,T,N;!function(e){e.integer="int",e.float="float"}(O||(O={})),function(e){e.editor="editor",e.lists="lists"}(R||(R={})),function(e){e.input="input",e.group="group"}(I||(I={})),function(e){e.common="common",e.lists="lists",e.editor="editor"}(T||(T={})),function(e){e.Main="MainWindow",e.Settings="SettingsWindow",e.Update="UpdateWindow",e.WhatsNew="WhatsNewWindow",e.Loading="LoadingWindow",e.Setup="SetupWindow"}(N||(N={}));const A=N;var C,D;!function(e){e.mods="mods",e.dlc="dlc",e.main="main",e.favorites="favorites"}(C||(C={})),function(e){e.multiply="multiply",e.single="single"}(D||(D={}));const L={RU:{SUCCESS_EXPORT_MESSAGE:"Конфигурация успешно экпортирована",LOADING:"Загрузка",OPEN_BUTTON:"Открыть",SAVE_BUTTON:"Сохранить",RESET_MENU_ITEM_LABEL:"Сбросить",EXPORT:"Экспорт",ERROR:"Ошибка",LANGUAGE_LABEL:"Язык программы"},EN:{SUCCESS_EXPORT_MESSAGE:"Configuration exported successfully",LOADING:"Loading",OPEN_BUTTON:"Open",SAVE_BUTTON:"Save",RESET_MENU_ITEM_LABEL:"Reset",EXPORT:"Export",ERROR:"Error",LANGUAGE_LABEL:"Program language"},DE:{SUCCESS_EXPORT_MESSAGE:"Konfiguration erfolgreich exportiert",LOADING:"Herunterladen",OPEN_BUTTON:"Öffnen",SAVE_BUTTON:"Datei",RESET_MENU_ITEM_LABEL:"Zurücksetzen",EXPORT:"Export",ERROR:"Fehler",LANGUAGE_LABEL:"Programmsprache"},CH:{SUCCESS_EXPORT_MESSAGE:"配置已成功导出",LOADING:"加载",OPEN_BUTTON:"打开",SAVE_BUTTON:"保存",RESET_MENU_ITEM_LABEL:"重置",EXPORT:"出口",ERROR:"误差",LANGUAGE_LABEL:"方案语言"}};var k,U,b,P;!function(e){e.get="get",e.set="set"}(k||(k={})),(P=U||(U={})).renderer="renderer",P.preload="preload",function(e){e.getPublicInfo="GET_PUBLIC_INFO",e.functionCall="FUNCTION_CALL_",e.mainEventOn="MAIN_EVENT_ON_",e.mainEventOnce="MAIN_EVENT_ONCE_",e.mainEventEmit="MAIN_EVENT_EMIT_",e.propertyGet="PROPERTY_GET_",e.propertySet="PROPERTY_SET_",e.promisePostfix="_PROMISE",e.rendererEventEmit="RENDERER_EMIT_"}(b||(b={}));const x={properties:new Set,functions:new Set,mainEvents:new Set,rendererEvents:new Set,accesses:new Map,scopes:new Map};function F(e,t,i=[U.renderer,U.preload]){const{properties:s}=x,r=b.propertyGet+e,a=b.propertySet+e,{get:o,set:c}=t;if(s.add(e),x.scopes.has(e)||x.scopes.set(e,new Set(i)),x.accesses.has(e)){const t=x.accesses.get(e);o&&t.add(k.get),c&&t.add(k.set)}else{const t=[];o&&t.push(k.get),c&&t.push(k.set),x.accesses.set(e,new Set(t))}o&&(n.ipcMain.removeAllListeners(r),n.ipcMain.on(r,(e=>{try{const t=o();e.returnValue={value:t}}catch(t){e.returnValue={error:t}}}))),c&&(n.ipcMain.removeAllListeners(a),n.ipcMain.on(a,((e,...t)=>{try{c(t[0]),e.returnValue={value:null}}catch(t){e.returnValue={error:t}}})))}function M(e,t){x.scopes.set(e,new Set([t]))}function j(e){return(t,i)=>{let s=String(i.name);e&&("string"==typeof e?s=e:(s=e.name??s,e.scope&&M(s,e.scope))),i.addInitializer((function(){!function(e,t,i=[U.preload,U.renderer]){const{functions:s}=x,r=b.functionCall+e;s.add(e),x.scopes.has(e)||x.scopes.set(e,new Set(i)),n.ipcMain.removeAllListeners(r),n.ipcMain.on(r,((e,...n)=>{try{const i=t(...n);if(i instanceof Promise){const t=r+b.promisePostfix;i.then((n=>e.sender.send(t,{value:n}))).catch((n=>e.sender.send(t,{error:String(n)}))),e.returnValue={promiseChannel:t}}else e.returnValue={value:i}}catch(t){e.returnValue={error:String(t)}}}))}(s,t.bind(this))}))}}function z(e){return(t,n)=>{const i=String(n.name);let s=i;e&&("string"==typeof e?s=e:(s=e.name??s,e.scope&&M(s,e.scope),e.access&&function(e,t){x.accesses.set(e,new Set([t]))}(s,e.access))),n.addInitializer((function(){F(s,{get:()=>this[i],set:e=>{this[i]=e}})}))}}function G(e){return(t,n)=>{let i=String(n.name);e&&("string"==typeof e?i=e:(i=e.name??i,e.scope&&M(i,e.scope))),n.addInitializer((function(){F(i,{set:t.bind(this)})}))}}n.ipcMain.on(b.getPublicInfo,(e=>e.returnValue=x));const W=new class{constructor(){this.quit=!1,this.saveConfig=!0}};var B=function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e);return i?n:void 0};const V=new((()=>{var e;let t,n=[],i=[];return e=class{constructor(){this.UPDATER_URL=(B(this,n),"https://verzsut.github.io/sxmle_updater"),this.REPOS_URL="https://verzsut.github.io/SnowRunner-XML-Editor-Desktop",this.obj=B(this,i,{publicInfo:`${this.UPDATER_URL}/public.json`,downloadPage:`${this.REPOS_URL}/download.html`,updateFiles:`${this.UPDATER_URL}/files`,updateMap:`${this.UPDATER_URL}/updateMap.json`,root:this.resolve("../../"),updateRoot:this.resolve("../../../updateRoot"),updateBackupFolder:this.resolve("../../../updateRoot/.webpack/main/backups"),config:this.resolve("config.json"),texts:this.resolve("game_texts.json"),backupFolder:this.resolve("backups"),icon:this.resolve("favicon.ico"),backupInitial:this.resolve("backups/initial.pak"),winrar:this.resolve("winrar"),mainTemp:this.resolve("mainTemp"),modsTemp:this.resolve("modsTemp"),strings:this.resolve("mainTemp/[strings]"),uninstall:this.resolve("../../../../unins000.exe"),classes:this.resolve("mainTemp/[media]/classes"),dlc:this.resolve("mainTemp/[media]/_dlc")});for(const e in this.obj)Object.defineProperty(this,e,{get:()=>this.obj[e],enumerable:!0,configurable:!1})}resolve(...e){return(0,s.resolve)(__dirname,...e)}},t=[z({name:"paths",access:k.get})],function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0}(null,null,t,{kind:"field",name:"obj",static:!1,private:!1,access:{has:e=>"obj"in e,get:e=>e.obj,set:(e,t)=>{e.obj=t}}},i,n),e})());const q=new((()=>{var e;let t,n=[];return e=class{findInDir(e,t,n=".xml",r){let a=[];return(0,i.existsSync)(e)?((0,i.readdirSync)(e).forEach((o=>{const c=(0,s.join)(e,o),l=(0,i.lstatSync)(c);if(t){if(!l.isDirectory())return;a.push({name:o,path:c})}l.isDirectory()&&r?a=[...a,...this.findInDir(c,!1,n,!0)]:o.indexOf(n)>=0&&a.push({name:o.replace(n,""),path:c})})),a):[]}clearTemp(){(0,i.rmSync)(V.backupInitial,{force:!0}),(0,i.rmSync)(V.mainTemp,{recursive:!0,force:!0}),(0,i.rmSync)(V.modsTemp,{recursive:!0,force:!0}),(0,i.mkdirSync)(V.mainTemp),(0,i.mkdirSync)(V.modsTemp)}constructor(){!function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,n)}},t=[j()],function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0}(e,null,t,{kind:"method",name:"findInDir",static:!1,private:!1,access:{has:e=>"findInDir"in e,get:e=>e.findInDir}},null,n),e})());function K(e){return Boolean(e?.length)}var H=function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0};const X=new((()=>{var e;let t,r,a,o=[];return e=class{constructor(){this.changeHandlers=(function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,o),new Set),this.obj=this.getConfig(),this.addChangeHandler=e=>{this.changeHandlers.add(e)};for(const e in this.obj)Object.defineProperty(this,e,{get:()=>this.obj[e],set:t=>this.obj[e]=t,enumerable:!0,configurable:!0})}get config(){return this.obj}set config(e){this.set(e),this.changeHandlers.forEach((e=>e()))}save(){try{(0,i.writeFileSync)(V.config,JSON.stringify(this.obj,null,"\t"))}catch{throw new Error("Saving configuration error")}}set(e){for(const t in e)this.obj[t]=e[t]}reset(e){const{version:t,buildType:i}=this.obj;this.set({version:t,buildType:i,favorites:[],initial:"",dlc:[],mods:{length:0,items:{}},settings:{updates:!0,DLC:!0,mods:!0,showWhatsNew:!0,advancedMode:!1},sizes:{initial:0,mods:{}},lang:y.EN}),q.clearTemp(),e?this.save():(n.app.relaunch(),n.app.quit())}export(){return(0,i.existsSync)(V.updateBackupFolder)||(0,i.mkdirSync)(V.updateBackupFolder,{recursive:!0}),(0,i.writeFileSync)(`${V.updateBackupFolder}\\config.json`,JSON.stringify(this.obj)),!0}import(){if(!(0,i.existsSync)((0,s.join)(V.backupFolder,"config.json")))return!1;const e=JSON.parse((0,i.readFileSync)(`${V.backupFolder}\\config.json`).toString());return W.saveConfig=!1,e.settings.showWhatsNew=!0,this.before066d(e),this.before067(e),this.before068(e),e.version=this.obj.version,(0,i.writeFileSync)(V.config,JSON.stringify(e)),(0,i.rmSync)(`${V.backupFolder}\\config.json`,{force:!0}),!0}removeChangeHandler(e){this.changeHandlers.delete(e)}before068(e){e.version<"0.6.8"&&(e.settings.advancedMode=!1)}before067(e){if(e.version<"0.6.7"){const t={};let n=0;if(e.initial=e.paths.initial,e.dlc=[...e.dlcList],K(e.modsList))for(const i in e.modsList)"length"!==i&&(t[i]={...e.modsList[i]},++n);e.mods={length:n,items:t},e.favorites=[],delete e.paths,delete e.dlcList,delete e.modsList,delete e.ADV,delete e.ETR,delete e.settings.resetButton,delete e.settings.devMode}}before066d(e){e.version<"0.6.6d"&&(delete e.sums,e.sizes={initial:null,mods:{}})}getConfig(){const e=JSON.parse((0,i.readFileSync)(V.config).toString());if(null==e.lang){const t=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[1];e.lang=Object.keys(y).includes(t)?t:y.EN}return e}},t=[(e,t)=>{let n=String(t.name);t.addInitializer((function(){F(n,{get:e.bind(this)})}))}],r=[G()],a=[j("resetConfig")],H(e,null,t,{kind:"getter",name:"config",static:!1,private:!1,access:{has:e=>"config"in e,get:e=>e.config}},null,o),H(e,null,r,{kind:"setter",name:"config",static:!1,private:!1,access:{has:e=>"config"in e,set:(e,t)=>{e.config=t}}},null,o),H(e,null,a,{kind:"method",name:"reset",static:!1,private:!1,access:{has:e=>"reset"in e,get:e=>e.reset}},null,o),e})()),$=J(L);function J(e){return new class{constructor(e,t,n){this.texts=e,this.getLang=t,this.get=()=>this.localized,this.onChangeLang=()=>{Object.assign(this.localized,this.texts[this.getLang()])},this.localized={...e[t()]},n&&n(this.onChangeLang)}}(e,(()=>X.lang),X.addChangeHandler).get()}const Y=(ee=L,te=J,(e,t)=>{const n={...ee};for(const t in e)Object.assign(n[t],e[t]);if(t)for(const e in n)Object.assign(n[e],t);return te(n)}),Q=$,Z=require("crypto");var ee,te;const ne=new class{constructor(){this.ALGORITHM="sha1",this.ENCODING="hex"}calc(e){return(0,i.existsSync)(e)?(0,Z.createHash)(this.ALGORITHM).update((0,i.readFileSync)(e)).digest(this.ENCODING):""}getSize(e){return(0,i.lstatSync)(e).size}},ie=new class{constructor(){this.loading=null}openModal(e){return this.create({...e,modal:!0,parent:n.BrowserWindow.getFocusedWindow()??void 0})}create(e){const{parent:t,preload:i,type:s,width:r=800,height:a=600,minWidth:c=0,minHeight:l=0,resizable:d=!0,show:p=!1,modal:u=!1,frame:h=!0}=e,g=new n.BrowserWindow({width:r,minWidth:c,height:a,minHeight:l,resizable:d,show:p,parent:t,modal:u,frame:h,icon:V.icon,paintWhenInitiallyHidden:!1,webPreferences:{preload:i,devTools:X.buildType===o.dev,contextIsolation:!1,webviewTag:!1,sandbox:!1}});g.setMenuBarVisibility(!1),g.removeMenu();let f=!0;return this.onWindowReady(s,(()=>{f=!1,this.showWindow(g)})),g.loadURL(e.path).then((()=>{X.buildType===o.dev&&setTimeout((()=>f&&this.showWindow(g)),3e3)})).catch(console.error),g}onWindowReady(e,t){n.ipcMain.once(_.windowReady+e,t)}showWindow(e){e&&!e.isDestroyed()&&(e.show(),e.focus())}},se=require("child_process"),re=new class{constructor(){this.MAIN_UNPACK_LIST="@unpack-list.lst",this.MODS_UNPACK_LIST="@unpack-mod-list.lst",this.EXCLUDE_BASE_FOLDER="-ep1",this.RECURSIVE="-r",this.UPDATE="f",this.UNPACK="x",this.WINRAR_EXE="WinRAR.exe",this.NO_ERRORS="-inul",this.IN_BACKGROUND="-ibck",this.IGNORE_ERRORS=[this.IN_BACKGROUND,this.NO_ERRORS]}update(e,t){this.run([this.UPDATE,...this.IGNORE_ERRORS,t,this.inner(e),this.RECURSIVE,this.EXCLUDE_BASE_FOLDER])}async unpack(e,t,n,i){const s=n?this.MODS_UNPACK_LIST:this.MAIN_UNPACK_LIST;await this.run([this.UNPACK,...this.IGNORE_ERRORS,e,s,this.inner(t)],i)}run(e,t=!0){if(!t)return new Promise((t=>{(0,se.execFile)(this.WINRAR_EXE,e,{cwd:V.winrar}).once("close",t).once("error",(e=>!1))}));try{(0,se.execFileSync)(this.WINRAR_EXE,e,{cwd:V.winrar})}catch(e){}}inner(e){return`${e}\\`}},ae=Y({RU:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Не удалось удалить старый бэкап initial.pak.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Не удалось удалить текущий бэкап initial.pak",SAVE_INITIAL_BACKUP_ERROR:"Не удалось сделать бэкап initial.pak.",SUCCESS_INITIAL_RESTORE:"initial.pak был успешно восстановлен.",SUCCESS_BACKUP_SAVE:"Бэкап initial.pak успешно сохранён.",SUCCESS:"Успех",ERROR:"Ошибка",ADMIN_REQUIRED_MESSAGE:"Ошибка запуска. Программа должна быть запущена от имени администратора.",ALLOW_NEW_VERSION:"Доступна новая версия программы. Нажмите чтобы перейти на страницу скачивания.",NOTIFICATION:"Уведомление",INITIAL_NOT_FOUND:"initial.pak не найден.",CLASSES_NOT_FOUND:"Папка classes не найдена.",DLC_FOLDER_NOT_FOUND:"Папка с дополнениями не найдена",UNPACKING:"Распаковка",SEE_EXPORTED_MESSAGE:"В данном файле находятся параметры следующих файлов:",SUCCESS_JOIN:"Следующие файлы были объединены в один:",ONLY_MANUAL_UNINS:"Удаление возможно только вручную: удалением папки с программой.",IMPORT_CONFIG_ERROR:"Не удалось импортировать конфигурацию. Возможно вы выбрали неверный файл",SAVE_MOD_ERROR:"Не удалось сохранить файлы модификации. Нет доступа к записи файла.",SAVE_ORIGINAL_ERROR:"Не удалось обновить файлы в initial.pak. Нет доступа к записи"},EN:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Failed to delete the old initial backup.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Failed to delete the current initial backup.",SAVE_INITIAL_BACKUP_ERROR:"Failed to save initial backup.",SUCCESS_INITIAL_RESTORE:"initial.pak was successfully restored.",SUCCESS_BACKUP_SAVE:"The initial.pak backup was saved successfully.",SUCCESS:"Success",ERROR:"Error",ADMIN_REQUIRED_MESSAGE:"Startup error. The program must be run as an administrator.",ALLOW_NEW_VERSION:"A new version of the program is available. Click to go to the download page.",NOTIFICATION:"Notification",INITIAL_NOT_FOUND:"initial.pak not found",CLASSES_NOT_FOUND:"Folder classes not found",DLC_FOLDER_NOT_FOUND:"DLC folder not found",UNPACKING:"Unpacking",SEE_EXPORTED_MESSAGE:"This file contains the parameters of the following files:",SUCCESS_JOIN:"The following files have been merged into one:",ONLY_MANUAL_UNINS:"Deletion is only possible manually: by deleting the program folder.",IMPORT_CONFIG_ERROR:"Failed to import configuration. You may have selected the wrong file",SAVE_MOD_ERROR:"The modification files could not be saved. There is no write access to the file.",SAVE_ORIGINAL_ERROR:"Failed to update files in initial. pak. There is no access to the record"},DE:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Die alte Erstsicherung konnte nicht gelöscht werden.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Die aktuelle Erstsicherung konnte nicht gelöscht werden.",SAVE_INITIAL_BACKUP_ERROR:"Erste Sicherung konnte nicht gespeichert werden.",SUCCESS_INITIAL_RESTORE:"initial.pak wurde erfolgreich restauriert.",SUCCESS_BACKUP_SAVE:"Die Initiale.pak backup wurde erfolgreich gespeichert.",SUCCESS:"Erfolg",ERROR:"Fehler",ADMIN_REQUIRED_MESSAGE:"Startfehler. Das Programm muss als administrator ausgeführt.",ALLOW_NEW_VERSION:"Eine neue Version des Programms ist verfügbar. Klicken Sie hier, um zur Download-Seite zu gelangen.",NOTIFICATION:"Norifizierung",INITIAL_NOT_FOUND:"initial.pak nicht gefunden",CLASSES_NOT_FOUND:"Klassen nicht gefunden",DLC_FOLDER_NOT_FOUND:"DLC-Ordner nicht gefunden",UNPACKING:"Auspacken",SEE_EXPORTED_MESSAGE:"Diese Datei enthält die Einstellungen der folgenden Dateien:",SUCCESS_JOIN:"Die folgenden Dateien wurden zu einem zusammengefasst:",ONLY_MANUAL_UNINS:"Das Löschen ist nur manuell möglich: Durch Löschen des Programmordners.",IMPORT_CONFIG_ERROR:"Konfiguration konnte nicht importiert werden. Möglicherweise haben Sie die falsche Datei ausgewählt",SAVE_MOD_ERROR:"Die Änderungsdateien konnten nicht gespeichert werden. Sie haben keinen Zugriff auf das Schreiben der Datei.",SAVE_ORIGINAL_ERROR:"Die Dateien in initial konnten nicht aktualisiert werden.pak. Kein Zugriff auf den Datensatz"},CH:{DELETE_OLD_INITIAL_BACKUP_ERROR:"删除旧的initial.pak备份失败。",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"删除当前initial.pak备份失败",SAVE_INITIAL_BACKUP_ERROR:"备份initial.pak失败。",SUCCESS_INITIAL_RESTORE:"initial.pak已被成功恢复。",SUCCESS_BACKUP_SAVE:"initial.pak备份已成功保存。",SUCCESS:"成功",ERROR:"误差",ADMIN_REQUIRED_MESSAGE:"启动错误。该程序必须以管理员身份启动。",ALLOW_NEW_VERSION:"新版本的软件已经问世。点击进入下载页面。",NOTIFICATION:"通知书",INITIAL_NOT_FOUND:"没有找到initial.pak。",CLASSES_NOT_FOUND:"没有找到classes文件夹。",DLC_FOLDER_NOT_FOUND:"未找到增编文件夹",UNPACKING:"打开包装",SEE_EXPORTED_MESSAGE:"该文件包含以下文件的参数",SUCCESS_JOIN:"以下文件已合并为一个",ONLY_MANUAL_UNINS:"删除只能是手动的：通过卸载程序文件夹。",IMPORT_CONFIG_ERROR:"配置不能被导入。你可能选择了错误的文件",SAVE_MOD_ERROR:"修改文件无法保存。没有写入文件的权限。",SAVE_ORIGINAL_ERROR:"更新initial.pak中的文件失败。没有写入权限"}});var oe=function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0};const ce=new((()=>{var e;let t,n,r=[];return e=class{constructor(){this.archiver=(function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,r),re)}update(e,t,n){this.archiver.update(e,t),this.saveSize(t,n)}async unpack(e,t,n,i){this.rmDir(t),this.archiver.unpack(e,t,n,i)}syncUnpack(e,t,n){this.unpack(e,t,n,!0)}async unpackMain(e=!0){ie.loading&&(await ie.loading.showAndWait(),ie.loading.setText(ae.UNPACKING)),this.clearDir(V.mainTemp),this.rmFile(V.texts),await this.unpack(X.initial,V.mainTemp,!1,!0),this.saveSize(X.initial),ie.loading&&e&&ie.loading.hide()}async unpackMod(e){const t=this.cutDotPak(e),n=(0,s.join)(V.modsTemp,t);this.mkDir(V.modsTemp),this.clearDir(n),this.saveSize(e,!0),await this.unpack(e,n,!0)}saveSize(e,t){const n=this.cutDotPak(e);t?X.sizes.mods[n]=ne.getSize(e):X.sizes.initial=ne.getSize(e)}rmDir(e){(0,i.rmSync)(e,{recursive:!0,force:!0})}rmFile(e){(0,i.rmSync)(e,{force:!0})}mkDir(e){(0,i.existsSync)(e)||(0,i.mkdirSync)(e)}clearDir(e){this.rmDir(e),this.mkDir(e)}cutDotPak(e){return(0,s.basename)(e,".pak")}},t=[j("unpack")],n=[j()],oe(e,null,t,{kind:"method",name:"syncUnpack",static:!1,private:!1,access:{has:e=>"syncUnpack"in e,get:e=>e.syncUnpack}},null,r),oe(e,null,n,{kind:"method",name:"unpackMain",static:!1,private:!1,access:{has:e=>"unpackMain"in e,get:e=>e.unpackMain}},null,r),e})());var le=function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0};const de=new((()=>{var e;let t,i,s,r,a,o=[];return e=class{constructor(){this.extNames=(function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,o),{epf:"Editor params file",ecf:"Editor configuration file",pak:"Package file",xml:"XML file"})}error(e){this.alert({type:"warning",title:ae.ERROR,message:e})}alert(e){const{dialogType:t=d.sync,buttons:i=["OK"],noLink:s=!1,type:r="info",title:a,message:o}=e,c={icon:n.nativeImage.createFromPath(V.icon),title:a,message:o,buttons:i,noLink:s,type:r};return t===d.sync?n.dialog.showMessageBoxSync(c):n.dialog.showMessageBox(c)}getEPF(){return this.openDialog({extention:"epf"})}saveEPF(e){return this.openDialog({type:g.save,defaultPath:e,extention:"epf"})}getInitial(){return this.openDialog({extention:"pak"})}getDir(){return this.openDialog({source:u.dir})}getMultiEPF(){return this.openDialog({properties:["openFile","multiSelections"],extention:"epf"})}getXML(){return this.openDialog({extention:"xml"})}openDialog(e){const{type:t=g.open,source:i=u.file,properties:s=(i===u.file?["openFile"]:["openDirectory"]),defaultPath:r,extention:a}=e,o={properties:s};if(a&&(o.filters=[{name:this.extNames[a],extensions:[a]}]),t===g.open){const e=n.dialog.showOpenDialogSync(o);return Array.isArray(e)?o.properties?.includes("multiSelections")?e:e[0]:void 0}return n.dialog.showSaveDialogSync({defaultPath:r,filters:o.filters})||[]}},t=[j()],i=[j()],s=[j()],r=[j()],a=[j()],le(e,null,t,{kind:"method",name:"getEPF",static:!1,private:!1,access:{has:e=>"getEPF"in e,get:e=>e.getEPF}},null,o),le(e,null,i,{kind:"method",name:"saveEPF",static:!1,private:!1,access:{has:e=>"saveEPF"in e,get:e=>e.saveEPF}},null,o),le(e,null,s,{kind:"method",name:"getInitial",static:!1,private:!1,access:{has:e=>"getInitial"in e,get:e=>e.getInitial}},null,o),le(e,null,r,{kind:"method",name:"getDir",static:!1,private:!1,access:{has:e=>"getDir"in e,get:e=>e.getDir}},null,o),le(e,null,a,{kind:"method",name:"getXML",static:!1,private:!1,access:{has:e=>"getXML"in e,get:e=>e.getXML}},null,o),e})()),pe=new class{async show(e,t){if(!n.Notification.isSupported())return;const i=new n.Notification({title:e,icon:V.icon,body:t});i.show(),await new Promise((e=>i.once("click",e)))}};var ue=function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0};const he=new((()=>{var e;let t,s,r,a=[];return e=class{async save(e,t){if(await ce.unpackMain(t),(0,i.existsSync)(V.backupFolder)||(0,i.mkdirSync)(V.backupFolder),(0,i.existsSync)(V.backupInitial))try{(0,i.rmSync)(V.backupInitial)}catch{throw new Error(ae.DELETE_OLD_INITIAL_BACKUP_ERROR)}X.buildType===o.prod&&this.copy(),e&&(W.quit=!0,n.app.relaunch(),n.app.quit())}copy(){try{(0,i.copyFileSync)(X.initial,V.backupInitial),pe.show(ae.SUCCESS,ae.SUCCESS_BACKUP_SAVE)}catch{throw new Error(ae.SAVE_INITIAL_BACKUP_ERROR)}}async recoverFromIt(){if((0,i.existsSync)(V.backupInitial)){if((0,i.existsSync)(X.initial))try{(0,i.rmSync)(X.initial)}catch{de.error(ae.DELETE_OLD_INITIAL_BACKUP_ERROR)}try{(0,i.copyFileSync)(V.backupInitial,X.initial),await ce.unpackMain(),await pe.show(ae.SUCCESS,ae.SUCCESS_INITIAL_RESTORE)}catch{de.error(ae.DELETE_CURRENT_INITIAL_BACKUP_ERROR)}}}constructor(){!function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,a)}},t=[j("saveBackup")],s=[j("copyBackup")],r=[j("recoverFromBackup")],ue(e,null,t,{kind:"method",name:"save",static:!1,private:!1,access:{has:e=>"save"in e,get:e=>e.save}},null,a),ue(e,null,s,{kind:"method",name:"copy",static:!1,private:!1,access:{has:e=>"copy"in e,get:e=>e.copy}},null,a),ue(e,null,r,{kind:"method",name:"recoverFromIt",static:!1,private:!1,access:{has:e=>"recoverFromIt"in e,get:e=>e.recoverFromIt}},null,a),e})()),ge=require("dns"),fe=require("https");const me=new((()=>{var e;let t,n=[];return e=class{constructor(){this.windows=(function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,n),{})}register(e,t){this.windows[e]=t}async open(e,...t){const n=await this.getCreator(e)(...t);await new Promise((e=>{n.once("show",e)}))}getCreator(e){const t=this.windows[e];if(!t)throw new Error(`Window creator for '${e}' is not defined`);return t}},t=[j("openWindow")],function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0}(e,null,t,{kind:"method",name:"open",static:!1,private:!1,access:{has:e=>"open"in e,get:e=>e.open}},null,n),e})()),Ee=class{constructor(){this.onConfigChange=()=>{this.wind?.webContents.send(_.changeConfig)}}register(){me.register(this.type,((...e)=>this.create(...e)))}async create(...e){return this.wind=await this.creator(...e),X.addChangeHandler(this.onConfigChange),this.wind.once("close",(()=>this.removeChangeHandler())),this.wind.once("close",(()=>this.onClose(...e))),this.wind.once("focus",(()=>this.onFocus(...e))),this.wind.once("show",(()=>this.onShow(...e))),await this.onCreate(...e),this.wind}async creator(...e){return ie.create({...this.args,type:this.type})}onCreate(...e){}onFocus(...e){}onClose(...e){}onShow(...e){}removeChangeHandler(){X.removeChangeHandler(this.onConfigChange)}},Se=class extends Ee{async creator(...e){return ie.openModal({...this.args,type:this.type})}},we=new class{constructor(){this.general={setup:`file://${require("path").resolve(__dirname,"..","renderer","setup","index.html")}`,loading:`file://${require("path").resolve(__dirname,"..","renderer","loading","index.html")}`,settings:`file://${require("path").resolve(__dirname,"..","renderer","settings","index.html")}`,update:`file://${require("path").resolve(__dirname,"..","renderer","update","index.html")}`,whatsNew:`file://${require("path").resolve(__dirname,"..","renderer","whatsnew","index.html")}`,main:`file://${require("path").resolve(__dirname,"..","renderer","main","index.html")}`},this.preload={setup:require("path").resolve(__dirname,"../renderer","setup","preload.js"),settings:require("path").resolve(__dirname,"../renderer","settings","preload.js"),main:require("path").resolve(__dirname,"../renderer","main","preload.js"),loading:require("path").resolve(__dirname,"../renderer","loading","preload.js"),whatsNew:require("path").resolve(__dirname,"../renderer","whatsnew","preload.js"),update:require("path").resolve(__dirname,"../renderer","update","preload.js")}}};(new class extends Se{constructor(){super(...arguments),this.type=A.Loading,this.args={path:we.general.loading,preload:we.preload.loading,width:280,minWidth:280,height:130,minHeight:150,frame:!1}}async creator(...e){return this.initMethods(await super.creator(...e))}onCreate(){ie.loading=this.wind}initMethods(e){const t=e;function n(e,n){t.webContents.postMessage(e,n)}return t.setText=e=>n("fileName",e),t.setCount=e=>n("count",e),t.setPercent=e=>n("percent",e),t.success=()=>n("success",!0),t.download=()=>n("download",!0),t.showAndWait=()=>new Promise((e=>{t.show(),setTimeout(e,100)})),t}}).register(),(new class extends Ee{constructor(){super(...arguments),this.type=A.Main,this.args={path:we.general.main,preload:we.preload.main,width:840,minWidth:800,height:700,minHeight:630},this.onWindowResize=()=>{this.wind?.on("resize",(()=>{this.wind?.webContents.send(_.windowResize)}))}}onCreate(){n.ipcMain.once(_.handleWindowSize,this.onWindowResize)}onClose(){n.app.quit()}onFocus(){ie.loading?.hide()}}).register(),(new class extends Se{constructor(){super(...arguments),this.type=A.Settings,this.args={path:we.general.settings,preload:we.preload.settings,width:400,minWidth:400,height:330,minHeight:350}}}).register(),(new class extends Ee{constructor(){super(...arguments),this.type=A.Setup,this.args={path:we.general.setup,preload:we.preload.setup,width:620,minWidth:620,height:290,minHeight:310}}onClose(){n.app.quit()}onFocus(){ie.loading?.hide()}}).register(),(new class extends Se{constructor(){super(...arguments),this.type=A.Update,this.args={path:we.general.update,preload:we.preload.update,width:400,minWidth:400,height:160,minHeight:180,frame:!1}}onShow(...e){this.wind?.webContents.postMessage("content",e[0])}}).register(),(new class extends Se{constructor(){super(...arguments),this.type=A.WhatsNew,this.args={path:we.general.whatsNew,preload:we.preload.whatsNew,width:600,minWidth:600,height:500,minHeight:520}}onClose(){X.settings.showWhatsNew=!1}}).register();const _e=new((()=>{var e;let t,r=[];return e=class{constructor(){this.MEDIA_FOLDER=(function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,r),"[media]"),this.DNS_TO_RESOLVE="www.google.com"}hasAdminPrivileges(){try{return(0,i.writeFileSync)(V.config,JSON.stringify(X.config,null,"\t")),!0}catch{return ie.loading?.setPercent(0),de.alert({message:ae.ADMIN_REQUIRED_MESSAGE,type:"warning",buttons:["Exit"],title:"Error"}),setTimeout(n.app.quit,2e3),!1}}async checkInitialChanges(){(0,i.existsSync)((0,s.join)(V.mainTemp,this.MEDIA_FOLDER))&&ne.getSize(X.initial)===X.sizes.initial||(0,i.existsSync)(X.initial)&&((0,i.existsSync)(V.backupInitial)?await ce.unpackMain(!1):await he.save())}checkUpdate(e){(X.settings.updates||e)&&(0,ge.resolve)(this.DNS_TO_RESOLVE,(e=>{e||(0,fe.get)(V.publicInfo,(e=>{let t="";e.setEncoding("utf-8"),e.on("data",(e=>t+=e)),e.on("end",(()=>{const e=JSON.parse(t),i=X.version;(i<e.latestVersion||i.includes("-beta")&&i.split("-beta")[0]===e.latestVersion)&&(i>=e.minVersion?me.open(A.Update,e.latestVersion):pe.show(ae.NOTIFICATION,ae.ALLOW_NEW_VERSION).then((()=>{n.shell.openExternal(V.downloadPage)})))}))}))}))}hasAllPaths(){return(0,i.existsSync)(X.initial)?(0,i.existsSync)(V.classes)?(X.settings.DLC&&!(0,i.existsSync)(V.dlc)&&(de.error(ae.DLC_FOLDER_NOT_FOUND),X.settings.DLC=!1),!0):(de.error(ae.CLASSES_NOT_FOUND),!1):(de.error(ae.INITIAL_NOT_FOUND),!1)}hasPermissions(e){try{return(0,i.accessSync)(e,i.constants.W_OK),!0}catch{return!1}}},t=[j()],function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0}(e,null,t,{kind:"method",name:"checkUpdate",static:!1,private:!1,access:{has:e=>"checkUpdate"in e,get:e=>e.checkUpdate}},null,r),e})());var ve=function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0};new((()=>{var e;let t,n,a=[];return e=class{constructor(){this.DEFAULT_NAME=(function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,a),"joined")}join(){const e=de.getMultiEPF();if(e&&e.length>1){const t=[],n=[];e.forEach((e=>{const s=JSON.parse((0,i.readFileSync)(e).toString());Array.isArray(s)?s.forEach((e=>{n.includes(e.fileName)||(t.push(e),n.push(e.fileName))})):n.includes(s.fileName)||(t.push(s),n.push(s.fileName))}));const a=de.saveEPF(this.DEFAULT_NAME);a&&((0,i.writeFileSync)(a,JSON.stringify(t,null,"\t")),de.alert({title:r,message:`${ae.SUCCESS_JOIN}\n- ${e.map((e=>(0,s.basename)(e))).join("\n- ")}`}))}}see(){const e=de.getEPF();if(!e)return;const t=JSON.parse((0,i.readFileSync)(e).toString()),n=[];Array.isArray(t)?t.forEach((e=>n.push(e.fileName))):n.push(t.fileName),de.alert({title:r,message:`${ae.SEE_EXPORTED_MESSAGE}\n\n${n.join("\n")}`})}},t=[j("joinEPF")],n=[j("seeEPF")],ve(e,null,t,{kind:"method",name:"join",static:!1,private:!1,access:{has:e=>"join"in e,get:e=>e.join}},null,a),ve(e,null,n,{kind:"method",name:"see",static:!1,private:!1,access:{has:e=>"see"in e,get:e=>e.see}},null,a),e})()),new class{constructor(){this.lang=X.lang,this.localize=e=>e[this.lang]}};new((()=>{var e;let t,r=[];return e=class{download(e,t){const{array:n,isRoot:r,inMemory:a,loadingPage:o,path:c,url:l,fromJSON:d}=e;if(n){const{url:e,path:i}=n[0];return r&&o?.setCount(n.length),o?.setText((0,s.basename)(i)),void this.download({url:e,path:i,loadingPage:o},(()=>{t(),n.length>1&&this.download({array:n.slice(1),loadingPage:o},t)}))}(0,fe.get)(l,(e=>{if(a){let n="";e.on("data",(e=>n+=e)),e.on("end",(()=>{t(d?JSON.parse(n):n)}))}else{const n=(0,i.createWriteStream)(c);if(o){const t=parseInt(e.headers["content-length"],10);let n=0;e.on("data",(e=>{n+=e.length,o.setPercent((n/t*100).toFixed(2))}))}e.pipe(n),e.on("end",(()=>{o?.success(),n.on("close",t),n.close()}))}}))}update(){const e=ie.loading;let t=!1;e?.download(),e?.show(),q.clearTemp(),this.download({url:V.updateMap,fromJSON:!0,inMemory:!0},(r=>{const a=this.processMap(r),o=a[0];let c=a[1];(0,i.mkdirSync)(V.updateRoot),o.forEach((e=>{const t=(0,s.join)(V.root,e),n=(0,s.join)(V.updateRoot,e);(0,i.existsSync)((0,s.dirname)(n))||(0,i.mkdirSync)((0,s.dirname)(n),{recursive:!0}),(0,i.copyFileSync)(t,n)})),K(c)||(W.saveConfig=!1,X.export(),W.quit=!0,n.app.relaunch(),n.app.quit());const l=[];c.forEach((e=>{const t=(0,s.join)(V.updateRoot,e),n=e.replaceAll("\\","/").replace(".webpack","webpack"),r=`${V.updateFiles}/${n}`;(0,i.existsSync)((0,s.dirname)(t))||(0,i.mkdirSync)((0,s.dirname)(t),{recursive:!0}),l.push({url:r,path:t})})),this.download({array:l,loadingPage:e,isRoot:!0},(()=>{c=c.slice(1),K(c)||t||(W.saveConfig=!1,W.quit=!0,t=!0,X.export(),n.app.relaunch(),n.app.quit())}))}))}processMap(e){const t=[],n=[];for(const r in e){const a=(0,s.join)(V.root,r);if((0,i.existsSync)(a)){if((0,i.lstatSync)(a).isDirectory())continue;ne.calc(a)!==e[r]?t.push(r):n.push(r)}else t.push(r)}return[n,t]}constructor(){!function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,r)}},t=[j("updateApp")],function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0}(e,null,t,{kind:"method",name:"update",static:!1,private:!1,access:{has:e=>"update"in e,get:e=>e.update}},null,r),e})());var ye=function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0};new((()=>{var e;let t,a,o,c,l,d,p,u,h,g=[];return e=class{openLink(e){return n.shell.openExternal(e)}openPath(e){return n.shell.openPath(e)}reload(){W.quit=!0,n.app.relaunch(),n.app.quit()}quit(){W.quit=!0,n.app.quit()}devTools(){n.BrowserWindow.getFocusedWindow()?.webContents.toggleDevTools()}uninstall(){(0,i.existsSync)(V.uninstall)?((0,se.execFile)(V.uninstall),W.quit=!0,n.app.quit()):de.alert({message:ae.ONLY_MANUAL_UNINS,title:r})}exportConfig(){return!!X.export()&&(de.alert({message:ae.SUCCESS_EXPORT_MESSAGE,title:r}),!0)}importConfig(){return X.import()?(W.quit=!0,n.app.relaunch(),n.app.quit(),!0):(de.alert({message:ae.IMPORT_CONFIG_ERROR,title:r}),!1)}updateFiles(e){if(e)try{ce.update((0,s.join)(V.modsTemp,e),X.mods.items[e].path,!0)}catch{try{(0,i.chmodSync)(X.mods.items[e].path,511),ce.update((0,s.join)(V.modsTemp,e),X.mods.items[e].path,!0)}catch{de.error(ae.SAVE_MOD_ERROR)}}else try{ce.update(V.mainTemp,X.initial)}catch{try{(0,i.chmodSync)(X.initial,511),ce.update(V.mainTemp,X.initial)}catch{de.error(ae.SAVE_ORIGINAL_ERROR)}}}constructor(){!function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e)}(this,g)}},t=[j()],a=[j()],o=[j("relaunchApp")],c=[j("quitApp")],l=[j()],d=[j("runUninstall")],p=[j()],u=[j()],h=[j()],ye(e,null,t,{kind:"method",name:"openLink",static:!1,private:!1,access:{has:e=>"openLink"in e,get:e=>e.openLink}},null,g),ye(e,null,a,{kind:"method",name:"openPath",static:!1,private:!1,access:{has:e=>"openPath"in e,get:e=>e.openPath}},null,g),ye(e,null,o,{kind:"method",name:"reload",static:!1,private:!1,access:{has:e=>"reload"in e,get:e=>e.reload}},null,g),ye(e,null,c,{kind:"method",name:"quit",static:!1,private:!1,access:{has:e=>"quit"in e,get:e=>e.quit}},null,g),ye(e,null,l,{kind:"method",name:"devTools",static:!1,private:!1,access:{has:e=>"devTools"in e,get:e=>e.devTools}},null,g),ye(e,null,d,{kind:"method",name:"uninstall",static:!1,private:!1,access:{has:e=>"uninstall"in e,get:e=>e.uninstall}},null,g),ye(e,null,p,{kind:"method",name:"exportConfig",static:!1,private:!1,access:{has:e=>"exportConfig"in e,get:e=>e.exportConfig}},null,g),ye(e,null,u,{kind:"method",name:"importConfig",static:!1,private:!1,access:{has:e=>"importConfig"in e,get:e=>e.importConfig}},null,g),ye(e,null,h,{kind:"method",name:"updateFiles",static:!1,private:!1,access:{has:e=>"updateFiles"in e,get:e=>e.updateFiles}},null,g),e})());var Oe=function(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e);return i?n:void 0};const Re=new((()=>{var e;let t,n=[],r=[];return e=class{constructor(){this.locals=(Oe(this,n),{RU:"russian",EN:"english",DE:"german",CH:"chinese_simplified"}),this.gameTexts=Oe(this,r,{mods:{},main:{}}),function(e){let t=X.lang;X.addChangeHandler((function(){X.lang!==t&&(t=X.lang,e())}))}((()=>{this.gameTexts.main={},this.gameTexts.mods={},this.getFromGame(),this.getFromMods()}))}async getFromGame(){if((0,i.existsSync)(V.texts)&&(this.gameTexts.main=JSON.parse((0,i.readFileSync)(V.texts).toString())),(0,i.existsSync)(V.strings)){const e=(0,s.join)(V.strings,`strings_${this.locals[X.lang]}.str`);(0,i.existsSync)(e)&&(this.gameTexts.main=this.parseFile((0,i.readFileSync)(e,{encoding:"utf16le"}).toString()),this.saveFromGame())}}getFromMods(){const e={};for(const t in X.mods.items)if((0,i.existsSync)((0,s.join)(V.modsTemp,t,"texts"))){const n=(0,s.join)(V.modsTemp,t,`texts/strings_${this.locals[X.lang]}.str`);(0,i.existsSync)(n)&&(e[t]=this.parseFile((0,i.readFileSync)(n,{encoding:"utf16le"}).toString(),!0))}this.gameTexts.mods=e}saveFromGame(){(0,i.writeFileSync)(V.texts,JSON.stringify(this.gameTexts.main,null,"\t"))}parseFile(e,t){const n={},i=e.match(/[^\r\n]+/g);return i&&i.forEach((e=>{const i=e.split('"');if(i&&i.length>1){const i=e.split('"')[0].trimEnd().replaceAll('"',"").replaceAll("'","").replaceAll("\ufeff",""),s=e.split('"')[1].replaceAll("\\","");if(t||this.startsWith(i,["UI_VEHICLE","UI_ADDON","UI_ADDONS","UI_UPGRADE","UI_TUNING","UI_SCOUT","UI_FRAME","UI_STUFF","UI_SEMITRAILER","UI_TRAILER","UI_ROCKET","UI_TRAIN","UI_ENGINE","UI_GEARBOX","UI_SUSPENSION","UI_RIM","UI_TIRE","UI_WINCH"])&&i.endsWith("NAME"))try{n[i]=s}catch{}}})),n}startsWith(e,t){for(let n=0;n<t.length;++n)if(e.startsWith(t[n]))return!0;return!1}},t=[z({name:"texts",access:k.get})],function(e,t,n,i,s,r){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?i.static?e:e.prototype:null,p=t||(d?Object.getOwnPropertyDescriptor(d,i.name):{}),u=!1,h=n.length-1;h>=0;h--){var g={};for(var f in i)g[f]="access"===f?{}:i[f];for(var f in i.access)g.access[f]=i.access[f];g.addInitializer=function(e){if(u)throw new TypeError("Cannot add initializers after decoration has completed");r.push(a(e||null))};var m=(0,n[h])("accessor"===c?{get:p.get,set:p.set}:p[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(o=a(m.get))&&(p.get=o),(o=a(m.set))&&(p.set=o),(o=a(m.init))&&s.push(o)}else(o=a(m))&&("field"===c?s.push(o):p[l]=o)}d&&Object.defineProperty(d,i.name,p),u=!0}(null,null,t,{kind:"field",name:"gameTexts",static:!1,private:!1,access:{has:e=>"gameTexts"in e,get:e=>e.gameTexts,set:(e,t)=>{e.gameTexts=t}}},r,n),e})());new class{constructor(){this.checkMultipleInstances(),this.setName(),this.optimize(),this.handleQuit(),this.handleAllClosed(),this.start()}start(){n.app.whenReady().then((()=>this.openProgram()))}async openProgram(){await me.open(A.Loading);const e=ie.loading;if(await(e?.showAndWait()),e?.setText(Q.LOADING),_e.hasAdminPrivileges()){if(!X.initial)return await me.open(A.Setup),void _e.checkUpdate();await _e.checkInitialChanges(),_e.hasAllPaths()?(await Promise.all([Re.getFromGame(),this.initDLC(),this.initMods()]),await me.open(A.Main),_e.checkUpdate()):X.reset()}}checkMultipleInstances(){n.app.requestSingleInstanceLock()||(n.app.quit(),process.exit(102))}optimize(){n.app.disableHardwareAcceleration()}setName(){n.app.setAppUserModelId(r)}handleQuit(){n.app.on("before-quit",(()=>{W.quit=!0,W.saveConfig&&X.save(),(0,i.existsSync)(V.updateRoot)&&((0,i.rmSync)(V.root,{recursive:!0}),(0,i.renameSync)(V.updateRoot,V.root))}))}handleAllClosed(){n.app.once("window-all-closed",(()=>n.app.exit()))}async initDLC(){X.settings.DLC&&(X.dlc=q.findInDir(V.dlc,!0))}async initMods(){if(!X.settings.mods)return;if(!K(X.mods))return;let e=X.mods.length;function t(t){const n=t.replace(".pak","");delete X.mods.items[n],--X.mods.length,--e}for(const n in X.mods.items){const r=X.mods.items[n];if((0,i.existsSync)(r.path))if(_e.hasPermissions(r.path)){if(ne.getSize(r.path)===X.sizes.mods[n]&&(0,i.existsSync)(V.modsTemp[n]))--e;else if(await ce.unpackMod(r.path),(0,i.existsSync)((0,s.join)(V.modsTemp,n,"classes"))?--e:t(X.mods.items[n].name),0===e)return void Re.getFromMods()}else t(X.mods.items[n].name);else t(X.mods.items[n].name)}e<=0&&Re.getFromMods()}},module.exports=t})();