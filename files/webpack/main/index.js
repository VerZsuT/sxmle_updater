(()=>{"use strict";var e={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}};void 0!==e&&(e.ab=__dirname+"/native_modules/");var t={};e.r(t);const i=require("electron"),n=require("fs"),s=require("path"),a="SnowRunner XML Editor";var r;!function(e){e.dev="dev",e.prod="prod"}(r||(r={}));const o=r;var c,l;!function(e){e.trucks="trucks",e.trailers="trailers"}(c||(c={})),function(e){e.sync="sync",e.async="async"}(l||(l={}));const d=l;var h;!function(e){e.file="file",e.dir="dir"}(h||(h={}));const p=h;var u;!function(e){e.open="open",e.save="save"}(u||(u={}));const g=u;var m,E,S,_,f;!function(e){e.engines="engines",e.gearboxes="gearboxes",e.suspensions="suspensions",e.wheels="wheels",e.winches="winches",e.truck="truck"}(m||(m={})),function(e){e.main="main",e.dlc="dlc",e.mods="mods",e.favorites="favorites"}(E||(E={})),function(e){e.text="text",e.number="number",e.select="select",e.coordinates="coordinates",e.file="file"}(S||(S={})),(f=_||(_={})).changeConfig="change-config",f.windowReady="window-ready-",f.windowResize="window-resize",f.handleWindowSize="handle-window-size";const R=_;var w;!function(e){e.RU="RU",e.EN="EN",e.DE="DE",e.CH="CH"}(w||(w={}));const N=w;var I,O,A,T,y;!function(e){e.integer="int",e.float="float"}(I||(I={})),function(e){e.editor="editor",e.lists="lists"}(O||(O={})),function(e){e.input="input",e.group="group"}(A||(A={})),function(e){e.common="common",e.lists="lists",e.editor="editor"}(T||(T={})),function(e){e.Main="MainWindow",e.Settings="SettingsWindow",e.Update="UpdateWindow",e.WhatsNew="WhatsNewWindow",e.Loading="LoadingWindow",e.Setup="SetupWindow"}(y||(y={}));const v=y;var C,L;!function(e){e.mods="mods",e.dlc="dlc",e.main="main",e.favorites="favorites"}(C||(C={})),function(e){e.multiply="multiply",e.single="single"}(L||(L={}));const U={RU:{SUCCESS_EXPORT_MESSAGE:"Конфигурация успешно экпортирована",LOADING:"Загрузка",OPEN_BUTTON:"Открыть",SAVE_BUTTON:"Сохранить",RESET_MENU_ITEM_LABEL:"Сбросить",EXPORT:"Экспорт",ERROR:"Ошибка",LANGUAGE_LABEL:"Язык программы",OK:"Ок",CANCEL:"Отменить"},EN:{SUCCESS_EXPORT_MESSAGE:"Configuration exported successfully",LOADING:"Loading",OPEN_BUTTON:"Open",SAVE_BUTTON:"Save",RESET_MENU_ITEM_LABEL:"Reset",EXPORT:"Export",ERROR:"Error",LANGUAGE_LABEL:"Program language",OK:"Ok",CANCEL:"Cancel"},DE:{SUCCESS_EXPORT_MESSAGE:"Konfiguration erfolgreich exportiert",LOADING:"Herunterladen",OPEN_BUTTON:"Öffnen",SAVE_BUTTON:"Datei",RESET_MENU_ITEM_LABEL:"Zurücksetzen",EXPORT:"Export",ERROR:"Fehler",LANGUAGE_LABEL:"Programmsprache",OK:"Ok",CANCEL:"Stornieren"},CH:{SUCCESS_EXPORT_MESSAGE:"配置已成功导出",LOADING:"加载",OPEN_BUTTON:"打开",SAVE_BUTTON:"保存",RESET_MENU_ITEM_LABEL:"重置",EXPORT:"导出",ERROR:"误差",LANGUAGE_LABEL:"方案语言",OK:"确认",CANCEL:"取消"}};function D(e,t,i,n,s,a){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var o,c=n.kind,l="getter"===c?"get":"setter"===c?"set":"value",d=!t&&e?n.static?e:e.prototype:null,h=t||(d?Object.getOwnPropertyDescriptor(d,n.name):{}),p=!1,u=i.length-1;u>=0;u--){var g={};for(var m in n)g[m]="access"===m?{}:n[m];for(var m in n.access)g.access[m]=n.access[m];g.addInitializer=function(e){if(p)throw new TypeError("Cannot add initializers after decoration has completed");a.push(r(e||null))};var E=(0,i[u])("accessor"===c?{get:h.get,set:h.set}:h[l],g);if("accessor"===c){if(void 0===E)continue;if(null===E||"object"!=typeof E)throw new TypeError("Object expected");(o=r(E.get))&&(h.get=o),(o=r(E.set))&&(h.set=o),(o=r(E.init))&&s.unshift(o)}else(o=r(E))&&("field"===c?s.unshift(o):h[l]=o)}d&&Object.defineProperty(d,n.name,h),p=!0}function k(e,t,i){for(var n=arguments.length>2,s=0;s<t.length;s++)i=n?t[s].call(e,i):t[s].call(e);return n?i:void 0}var P,F,M,b;Object.create,Object.create,function(e){e.get="get",e.set="set"}(P||(P={})),(b=F||(F={})).renderer="renderer",b.preload="preload",function(e){e.getPublicInfo="GET_PUBLIC_INFO",e.functionCall="FUNCTION_CALL_",e.mainEventOn="MAIN_EVENT_ON_",e.mainEventOnce="MAIN_EVENT_ONCE_",e.mainEventEmit="MAIN_EVENT_EMIT_",e.propertyGet="PROPERTY_GET_",e.propertySet="PROPERTY_SET_",e.promisePostfix="_PROMISE",e.rendererEventEmit="RENDERER_EMIT_"}(M||(M={}));const x={properties:new Set,functions:new Set,mainEvents:new Set,rendererEvents:new Set,accesses:new Map,scopes:new Map};function j(e,t,n=[F.renderer,F.preload]){const{properties:s}=x,a=M.propertyGet+e,r=M.propertySet+e,{get:o,set:c}=t;if(s.add(e),x.scopes.has(e)||x.scopes.set(e,new Set(n)),x.accesses.has(e)){const t=x.accesses.get(e);o&&t.add(P.get),c&&t.add(P.set)}else{const t=[];o&&t.push(P.get),c&&t.push(P.set),x.accesses.set(e,new Set(t))}o&&(i.ipcMain.removeAllListeners(a),i.ipcMain.on(a,(e=>{try{const t=o();e.returnValue={value:t}}catch(t){e.returnValue={error:t}}}))),c&&(i.ipcMain.removeAllListeners(r),i.ipcMain.on(r,((e,...t)=>{try{c(t[0]),e.returnValue={value:null}}catch(t){e.returnValue={error:t}}})))}function G(e,t){x.scopes.set(e,new Set([t]))}function W(e){return(t,n)=>{let s=String(n.name);e&&("string"==typeof e?s=e:(s=e.name??s,e.scope&&G(s,e.scope))),n.addInitializer((function(){!function(e,t,n=[F.preload,F.renderer]){const{functions:s}=x,a=M.functionCall+e;s.add(e),x.scopes.has(e)||x.scopes.set(e,new Set(n)),i.ipcMain.removeAllListeners(a),i.ipcMain.on(a,((e,...i)=>{try{const n=t(...i);if(n instanceof Promise){const t=a+M.promisePostfix;n.then((i=>e.sender.send(t,{value:i}))).catch((i=>e.sender.send(t,{error:String(i)}))),e.returnValue={promiseChannel:t}}else e.returnValue={value:n}}catch(t){e.returnValue={error:String(t)}}}))}(s,t.bind(this))}))}}function B(e){return(t,i)=>{const n=String(i.name);let s=n;e&&("string"==typeof e?s=e:(s=e.name??s,e.scope&&G(s,e.scope),e.access&&function(e,t){x.accesses.set(e,new Set([t]))}(s,e.access))),i.addInitializer((function(){j(s,{get:()=>this[n],set:e=>{this[n]=e}})}))}}function V(e){return(t,i)=>{let n=String(i.name);e&&("string"==typeof e?n=e:(n=e.name??n,e.scope&&G(n,e.scope))),i.addInitializer((function(){j(n,{set:t.bind(this)})}))}}i.ipcMain.on(M.getPublicInfo,(e=>e.returnValue=x));const z=new class{constructor(){this.quit=!1,this.saveConfig=!0}},q=new((()=>{var e;let t,i=[],n=[];return e=class{constructor(){this.UPDATER_URL=(k(this,i),"https://verzsut.github.io/sxmle_updater"),this.REPOS_URL="https://verzsut.github.io/SnowRunner-XML-Editor-Desktop",this.obj=k(this,n,{publicInfo:`${this.UPDATER_URL}/public.json`,downloadPage:`${this.REPOS_URL}/download.html`,updateFiles:`${this.UPDATER_URL}/files`,updateMap:`${this.UPDATER_URL}/updateMap.json`,root:this.resolve("../../"),updateRoot:this.resolve("../../../updateRoot"),updateBackupFolder:this.resolve("../../../updateRoot/.webpack/main/backups"),config:this.resolve("config.json"),texts:this.resolve("game_texts.json"),backupFolder:this.resolve("backups"),icon:this.resolve("favicon.ico"),backupInitial:this.resolve("backups/initial.pak"),winrar:this.resolve("winrar"),mainTemp:this.resolve("mainTemp"),modsTemp:this.resolve("modsTemp"),strings:this.resolve("mainTemp/[strings]"),uninstall:this.resolve("../../../../unins000.exe"),classes:this.resolve("mainTemp/[media]/classes"),dlc:this.resolve("mainTemp/[media]/_dlc")});for(const e in this.obj)Object.defineProperty(this,e,{get:()=>this.obj[e],enumerable:!0,configurable:!1})}resolve(...e){return(0,s.resolve)(__dirname,...e)}},t=[B({name:"paths",access:P.get})],D(null,null,t,{kind:"field",name:"obj",static:!1,private:!1,access:{has:e=>"obj"in e,get:e=>e.obj,set:(e,t)=>{e.obj=t}}},n,i),e})()),K=new((()=>{var e;let t,i=[];return e=class{findInDir(e,t,i=".xml",a){let r=[];return(0,n.existsSync)(e)?((0,n.readdirSync)(e).forEach((o=>{const c=(0,s.join)(e,o),l=(0,n.lstatSync)(c);if(t){if(!l.isDirectory())return;r.push({name:o,path:c})}l.isDirectory()&&a?r=[...r,...this.findInDir(c,!1,i,!0)]:o.indexOf(i)>=0&&r.push({name:o.replace(i,""),path:c})})),r):[]}clearTemp(){(0,n.rmSync)(q.backupInitial,{force:!0}),(0,n.rmSync)(q.mainTemp,{recursive:!0,force:!0}),(0,n.rmSync)(q.modsTemp,{recursive:!0,force:!0}),(0,n.mkdirSync)(q.mainTemp),(0,n.mkdirSync)(q.modsTemp)}constructor(){k(this,i)}},t=[W()],D(e,null,t,{kind:"method",name:"findInDir",static:!1,private:!1,access:{has:e=>"findInDir"in e,get:e=>e.findInDir}},null,i),e})());function H(e){return Boolean(e?.length)}const X=new((()=>{var e;let t,a,r,o=[];return e=class{constructor(){this.changeHandlers=(k(this,o),new Set),this.obj=this.getConfig(),this.addChangeHandler=e=>{this.changeHandlers.add(e)};for(const e in this.obj)Object.defineProperty(this,e,{get:()=>this.obj[e],set:t=>this.obj[e]=t,enumerable:!0,configurable:!0})}get config(){return this.obj}set config(e){this.set(e),this.changeHandlers.forEach((e=>e()))}save(){try{(0,n.writeFileSync)(q.config,JSON.stringify(this.obj,null,"\t"))}catch{throw new Error("Saving configuration error")}}set(e){for(const t in e)this.obj[t]=e[t]}reset(e){const{version:t,buildType:n}=this.obj;this.set({version:t,buildType:n,favorites:[],initial:"",dlc:[],mods:{length:0,items:{}},settings:{updates:!0,DLC:!0,mods:!0,showWhatsNew:!0,advancedMode:!1},sizes:{initial:0,mods:{}},lang:N.EN}),K.clearTemp(),e?this.save():(i.app.relaunch(),i.app.quit())}export(){return(0,n.existsSync)(q.updateBackupFolder)||(0,n.mkdirSync)(q.updateBackupFolder,{recursive:!0}),(0,n.writeFileSync)(`${q.updateBackupFolder}\\config.json`,JSON.stringify(this.obj)),!0}import(){if(!(0,n.existsSync)((0,s.join)(q.backupFolder,"config.json")))return!1;const e=JSON.parse((0,n.readFileSync)(`${q.backupFolder}\\config.json`).toString());return z.saveConfig=!1,e.settings.showWhatsNew=!0,this.before066d(e),this.before067(e),this.before068(e),e.version=this.obj.version,(0,n.writeFileSync)(q.config,JSON.stringify(e)),(0,n.rmSync)(`${q.backupFolder}\\config.json`,{force:!0}),!0}removeChangeHandler(e){this.changeHandlers.delete(e)}before068(e){e.version<"0.6.8"&&(e.settings.advancedMode=!1)}before067(e){if(e.version<"0.6.7"){const t={};let i=0;if(e.initial=e.paths.initial,e.dlc=[...e.dlcList],H(e.modsList))for(const n in e.modsList)"length"!==n&&(t[n]={...e.modsList[n]},++i);e.mods={length:i,items:t},e.favorites=[],delete e.paths,delete e.dlcList,delete e.modsList,delete e.ADV,delete e.ETR,delete e.settings.resetButton,delete e.settings.devMode}}before066d(e){e.version<"0.6.6d"&&(delete e.sums,e.sizes={initial:null,mods:{}})}getConfig(){const e=JSON.parse((0,n.readFileSync)(q.config).toString());if(null==e.lang){const t=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[1];e.lang=Object.keys(N).includes(t)?t:N.EN}return e}},t=[(e,t)=>{let i=String(t.name);t.addInitializer((function(){j(i,{get:e.bind(this)})}))}],a=[V()],r=[W("resetConfig")],D(e,null,t,{kind:"getter",name:"config",static:!1,private:!1,access:{has:e=>"config"in e,get:e=>e.config}},null,o),D(e,null,a,{kind:"setter",name:"config",static:!1,private:!1,access:{has:e=>"config"in e,set:(e,t)=>{e.config=t}}},null,o),D(e,null,r,{kind:"method",name:"reset",static:!1,private:!1,access:{has:e=>"reset"in e,get:e=>e.reset}},null,o),e})()),$=J(U);function J(e){return new class{constructor(e,t,i){this.texts=e,this.getLang=t,this.get=()=>this.localized,this.onChangeLang=()=>{Object.assign(this.localized,this.texts[this.getLang()])},this.localized={...e[t()]},i&&i(this.onChangeLang)}}(e,(()=>X.lang),X.addChangeHandler).get()}const Y=(ee=U,te=J,(e,t)=>{const i={...ee};for(const t in e)Object.assign(i[t],e[t]);if(t)for(const e in i)Object.assign(i[e],t);return te(i)}),Q=$,Z=require("crypto");var ee,te;const ie=new class{constructor(){this.ALGORITHM="sha1",this.ENCODING="hex"}calc(e){return(0,n.existsSync)(e)?(0,Z.createHash)(this.ALGORITHM).update((0,n.readFileSync)(e)).digest(this.ENCODING):""}getSize(e){return(0,n.lstatSync)(e).size}},ne=new class{constructor(){this.loading=null}openModal(e){return this.create({...e,modal:!0,parent:i.BrowserWindow.getFocusedWindow()??void 0})}create(e){const{parent:t,preload:n,type:s,width:a=800,height:r=600,minWidth:c=0,minHeight:l=0,resizable:d=!0,show:h=!1,modal:p=!1,frame:u=!0}=e,g=new i.BrowserWindow({width:a,minWidth:c,height:r,minHeight:l,resizable:d,show:h,parent:t,modal:p,frame:u,icon:q.icon,paintWhenInitiallyHidden:!1,webPreferences:{preload:n,devTools:X.buildType===o.dev,contextIsolation:!1,webviewTag:!1,sandbox:!1}});g.setMenuBarVisibility(!1),g.removeMenu();let m=!0;return this.onWindowReady(s,(()=>{m=!1,this.showWindow(g)})),g.loadURL(e.path).then((()=>{X.buildType===o.dev&&setTimeout((()=>m&&this.showWindow(g)),3e3)})).catch(console.error),g}onWindowReady(e,t){i.ipcMain.once(R.windowReady+e,t)}showWindow(e){e&&!e.isDestroyed()&&(e.show(),e.focus())}},se=require("child_process"),ae=new class{constructor(){this.MAIN_UNPACK_LIST="@unpack-list.lst",this.MODS_UNPACK_LIST="@unpack-mod-list.lst",this.EXCLUDE_BASE_FOLDER="-ep1",this.RECURSIVE="-r",this.UPDATE="f",this.UNPACK="x",this.WINRAR_EXE="WinRAR.exe",this.NO_ERRORS="-inul",this.IN_BACKGROUND="-ibck",this.IGNORE_ERRORS=[this.IN_BACKGROUND,this.NO_ERRORS]}update(e,t){this.run([this.UPDATE,...this.IGNORE_ERRORS,t,this.inner(e),this.RECURSIVE,this.EXCLUDE_BASE_FOLDER])}async unpack(e,t,i,n){const s=i?this.MODS_UNPACK_LIST:this.MAIN_UNPACK_LIST;await this.run([this.UNPACK,...this.IGNORE_ERRORS,e,s,this.inner(t)],n)}run(e,t=!0){if(!t)return new Promise((t=>{(0,se.execFile)(this.WINRAR_EXE,e,{cwd:q.winrar}).once("close",t).once("error",(e=>!1))}));try{(0,se.execFileSync)(this.WINRAR_EXE,e,{cwd:q.winrar})}catch(e){}}inner(e){return`${e}\\`}},re=Y({RU:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Не удалось удалить старый бэкап initial.pak.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Не удалось удалить текущий бэкап initial.pak",SAVE_INITIAL_BACKUP_ERROR:"Не удалось сделать бэкап initial.pak.",SUCCESS_INITIAL_RESTORE:"initial.pak был успешно восстановлен.",SUCCESS_BACKUP_SAVE:"Бэкап initial.pak успешно сохранён.",SUCCESS:"Успех",ERROR:"Ошибка",ADMIN_REQUIRED_MESSAGE:"Ошибка запуска. Программа должна быть запущена от имени администратора.",ALLOW_NEW_VERSION:"Доступна новая версия программы. Нажмите чтобы перейти на страницу скачивания.",NOTIFICATION:"Уведомление",INITIAL_NOT_FOUND:"initial.pak не найден.",CLASSES_NOT_FOUND:"Папка classes не найдена.",DLC_FOLDER_NOT_FOUND:"Папка с дополнениями не найдена",UNPACKING:"Распаковка",SEE_EXPORTED_MESSAGE:"В данном файле находятся параметры следующих файлов:",SUCCESS_JOIN:"Следующие файлы были объединены в один:",ONLY_MANUAL_UNINS:"Удаление возможно только вручную: удалением папки с программой.",IMPORT_CONFIG_ERROR:"Не удалось импортировать конфигурацию. Возможно вы выбрали неверный файл",SAVE_MOD_ERROR:"Не удалось сохранить файлы модификации. Нет доступа к записи файла.",SAVE_ORIGINAL_ERROR:"Не удалось обновить файлы в initial.pak. Нет доступа к записи"},EN:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Failed to delete the old initial backup.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Failed to delete the current initial backup.",SAVE_INITIAL_BACKUP_ERROR:"Failed to save initial backup.",SUCCESS_INITIAL_RESTORE:"initial.pak was successfully restored.",SUCCESS_BACKUP_SAVE:"The initial.pak backup was saved successfully.",SUCCESS:"Success",ERROR:"Error",ADMIN_REQUIRED_MESSAGE:"Startup error. The program must be run as an administrator.",ALLOW_NEW_VERSION:"A new version of the program is available. Click to go to the download page.",NOTIFICATION:"Notification",INITIAL_NOT_FOUND:"initial.pak not found",CLASSES_NOT_FOUND:"Folder classes not found",DLC_FOLDER_NOT_FOUND:"DLC folder not found",UNPACKING:"Unpacking",SEE_EXPORTED_MESSAGE:"This file contains the parameters of the following files:",SUCCESS_JOIN:"The following files have been merged into one:",ONLY_MANUAL_UNINS:"Deletion is only possible manually: by deleting the program folder.",IMPORT_CONFIG_ERROR:"Failed to import configuration. You may have selected the wrong file",SAVE_MOD_ERROR:"The modification files could not be saved. There is no write access to the file.",SAVE_ORIGINAL_ERROR:"Failed to update files in initial. pak. There is no access to the record"},DE:{DELETE_OLD_INITIAL_BACKUP_ERROR:"Die alte Erstsicherung konnte nicht gelöscht werden.",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"Die aktuelle Erstsicherung konnte nicht gelöscht werden.",SAVE_INITIAL_BACKUP_ERROR:"Erste Sicherung konnte nicht gespeichert werden.",SUCCESS_INITIAL_RESTORE:"initial.pak wurde erfolgreich restauriert.",SUCCESS_BACKUP_SAVE:"Die Initiale.pak backup wurde erfolgreich gespeichert.",SUCCESS:"Erfolg",ERROR:"Fehler",ADMIN_REQUIRED_MESSAGE:"Startfehler. Das Programm muss als administrator ausgeführt.",ALLOW_NEW_VERSION:"Eine neue Version des Programms ist verfügbar. Klicken Sie hier, um zur Download-Seite zu gelangen.",NOTIFICATION:"Norifizierung",INITIAL_NOT_FOUND:"initial.pak nicht gefunden",CLASSES_NOT_FOUND:"Klassen nicht gefunden",DLC_FOLDER_NOT_FOUND:"DLC-Ordner nicht gefunden",UNPACKING:"Auspacken",SEE_EXPORTED_MESSAGE:"Diese Datei enthält die Einstellungen der folgenden Dateien:",SUCCESS_JOIN:"Die folgenden Dateien wurden zu einem zusammengefasst:",ONLY_MANUAL_UNINS:"Das Löschen ist nur manuell möglich: Durch Löschen des Programmordners.",IMPORT_CONFIG_ERROR:"Konfiguration konnte nicht importiert werden. Möglicherweise haben Sie die falsche Datei ausgewählt",SAVE_MOD_ERROR:"Die Änderungsdateien konnten nicht gespeichert werden. Sie haben keinen Zugriff auf das Schreiben der Datei.",SAVE_ORIGINAL_ERROR:"Die Dateien in initial konnten nicht aktualisiert werden.pak. Kein Zugriff auf den Datensatz"},CH:{DELETE_OLD_INITIAL_BACKUP_ERROR:"删除旧的initial.pak备份失败。",DELETE_CURRENT_INITIAL_BACKUP_ERROR:"删除当前initial.pak备份失败",SAVE_INITIAL_BACKUP_ERROR:"备份initial.pak失败。",SUCCESS_INITIAL_RESTORE:"initial.pak已被成功恢复。",SUCCESS_BACKUP_SAVE:"initial.pak备份已成功保存。",SUCCESS:"成功",ERROR:"误差",ADMIN_REQUIRED_MESSAGE:"启动错误。该程序必须以管理员身份启动。",ALLOW_NEW_VERSION:"新版本的软件已经问世。点击进入下载页面。",NOTIFICATION:"通知书",INITIAL_NOT_FOUND:"没有找到initial.pak。",CLASSES_NOT_FOUND:"没有找到classes文件夹。",DLC_FOLDER_NOT_FOUND:"未找到增编文件夹",UNPACKING:"打开包装",SEE_EXPORTED_MESSAGE:"该文件包含以下文件的参数",SUCCESS_JOIN:"以下文件已合并为一个",ONLY_MANUAL_UNINS:"删除只能是手动的：通过卸载程序文件夹。",IMPORT_CONFIG_ERROR:"配置不能被导入。你可能选择了错误的文件",SAVE_MOD_ERROR:"修改文件无法保存。没有写入文件的权限。",SAVE_ORIGINAL_ERROR:"更新initial.pak中的文件失败。没有写入权限"}}),oe=new((()=>{var e;let t,i,a=[];return e=class{constructor(){this.archiver=(k(this,a),ae)}update(e,t,i){this.archiver.update(e,t),this.saveSize(t,i)}async unpack(e,t,i,n){this.rmDir(t),this.archiver.unpack(e,t,i,n)}syncUnpack(e,t,i){this.unpack(e,t,i,!0)}async unpackMain(e=!0){ne.loading&&(await ne.loading.showAndWait(),ne.loading.setText(re.UNPACKING)),this.clearDir(q.mainTemp),this.rmFile(q.texts),await this.unpack(X.initial,q.mainTemp,!1,!0),this.saveSize(X.initial),ne.loading&&e&&ne.loading.hide()}async unpackMod(e){const t=this.cutDotPak(e),i=(0,s.join)(q.modsTemp,t);this.mkDir(q.modsTemp),this.clearDir(i),this.saveSize(e,!0),await this.unpack(e,i,!0)}saveSize(e,t){const i=this.cutDotPak(e);t?X.sizes.mods[i]=ie.getSize(e):X.sizes.initial=ie.getSize(e)}rmDir(e){(0,n.rmSync)(e,{recursive:!0,force:!0})}rmFile(e){(0,n.rmSync)(e,{force:!0})}mkDir(e){(0,n.existsSync)(e)||(0,n.mkdirSync)(e)}clearDir(e){this.rmDir(e),this.mkDir(e)}cutDotPak(e){return(0,s.basename)(e,".pak")}},t=[W("unpack")],i=[W()],D(e,null,t,{kind:"method",name:"syncUnpack",static:!1,private:!1,access:{has:e=>"syncUnpack"in e,get:e=>e.syncUnpack}},null,a),D(e,null,i,{kind:"method",name:"unpackMain",static:!1,private:!1,access:{has:e=>"unpackMain"in e,get:e=>e.unpackMain}},null,a),e})()),ce=new((()=>{var e;let t,n,s,a,r,o=[];return e=class{constructor(){this.extNames=(k(this,o),{epf:"Editor params file",ecf:"Editor configuration file",pak:"Package file",xml:"XML file"})}error(e){this.alert({type:"warning",title:re.ERROR,message:e})}alert(e){const{dialogType:t=d.sync,buttons:n=[re.OK],noLink:s=!1,type:a="info",title:r,message:o}=e,c={icon:i.nativeImage.createFromPath(q.icon),title:r,message:o,buttons:n,noLink:s,type:a};return t===d.sync?i.dialog.showMessageBoxSync(c):i.dialog.showMessageBox(c)}getEPF(){return this.openDialog({extention:"epf"})}saveEPF(e){return this.openDialog({type:g.save,defaultPath:e,extention:"epf"})}getInitial(){return this.openDialog({extention:"pak"})}getDir(){return this.openDialog({source:p.dir})}getMultiEPF(){return this.openDialog({properties:["openFile","multiSelections"],extention:"epf"})}getXML(){return this.openDialog({extention:"xml"})}openDialog(e){const{type:t=g.open,source:n=p.file,properties:s=(n===p.file?["openFile"]:["openDirectory"]),defaultPath:a,extention:r}=e,o={properties:s};if(r&&(o.filters=[{name:this.extNames[r],extensions:[r]}]),t===g.open){const e=i.dialog.showOpenDialogSync(o);return Array.isArray(e)?o.properties?.includes("multiSelections")?e:e[0]:void 0}return i.dialog.showSaveDialogSync({defaultPath:a,filters:o.filters})||[]}},t=[W()],n=[W()],s=[W()],a=[W()],r=[W()],D(e,null,t,{kind:"method",name:"getEPF",static:!1,private:!1,access:{has:e=>"getEPF"in e,get:e=>e.getEPF}},null,o),D(e,null,n,{kind:"method",name:"saveEPF",static:!1,private:!1,access:{has:e=>"saveEPF"in e,get:e=>e.saveEPF}},null,o),D(e,null,s,{kind:"method",name:"getInitial",static:!1,private:!1,access:{has:e=>"getInitial"in e,get:e=>e.getInitial}},null,o),D(e,null,a,{kind:"method",name:"getDir",static:!1,private:!1,access:{has:e=>"getDir"in e,get:e=>e.getDir}},null,o),D(e,null,r,{kind:"method",name:"getXML",static:!1,private:!1,access:{has:e=>"getXML"in e,get:e=>e.getXML}},null,o),e})()),le=new class{async show(e,t){if(!i.Notification.isSupported())return;const n=new i.Notification({title:e,icon:q.icon,body:t});n.show(),await new Promise((e=>n.once("click",e)))}},de=new((()=>{var e;let t,s,a,r=[];return e=class{async save(e,t){if(await oe.unpackMain(t),(0,n.existsSync)(q.backupFolder)||(0,n.mkdirSync)(q.backupFolder),(0,n.existsSync)(q.backupInitial))try{(0,n.rmSync)(q.backupInitial)}catch{throw new Error(re.DELETE_OLD_INITIAL_BACKUP_ERROR)}X.buildType===o.prod&&this.copy(),e&&(z.quit=!0,i.app.relaunch(),i.app.quit())}copy(){try{(0,n.copyFileSync)(X.initial,q.backupInitial),le.show(re.SUCCESS,re.SUCCESS_BACKUP_SAVE)}catch{throw new Error(re.SAVE_INITIAL_BACKUP_ERROR)}}async recoverFromIt(){if((0,n.existsSync)(q.backupInitial)){if((0,n.existsSync)(X.initial))try{(0,n.rmSync)(X.initial)}catch{ce.error(re.DELETE_OLD_INITIAL_BACKUP_ERROR)}try{(0,n.copyFileSync)(q.backupInitial,X.initial),await oe.unpackMain(),await le.show(re.SUCCESS,re.SUCCESS_INITIAL_RESTORE)}catch{ce.error(re.DELETE_CURRENT_INITIAL_BACKUP_ERROR)}}}constructor(){k(this,r)}},t=[W("saveBackup")],s=[W("copyBackup")],a=[W("recoverFromBackup")],D(e,null,t,{kind:"method",name:"save",static:!1,private:!1,access:{has:e=>"save"in e,get:e=>e.save}},null,r),D(e,null,s,{kind:"method",name:"copy",static:!1,private:!1,access:{has:e=>"copy"in e,get:e=>e.copy}},null,r),D(e,null,a,{kind:"method",name:"recoverFromIt",static:!1,private:!1,access:{has:e=>"recoverFromIt"in e,get:e=>e.recoverFromIt}},null,r),e})()),he=require("dns"),pe=require("https"),ue=new((()=>{var e;let t,i=[];return e=class{constructor(){this.windows=(k(this,i),{})}register(e,t){this.windows[e]=t}async open(e,...t){const i=await this.getCreator(e)(...t);await new Promise((e=>{i.once("show",e)}))}getCreator(e){const t=this.windows[e];if(!t)throw new Error(`Window creator for '${e}' is not defined`);return t}},t=[W("openWindow")],D(e,null,t,{kind:"method",name:"open",static:!1,private:!1,access:{has:e=>"open"in e,get:e=>e.open}},null,i),e})()),ge=class{constructor(){this.onConfigChange=()=>{this.wind?.webContents.send(R.changeConfig)}}register(){ue.register(this.type,((...e)=>this.create(...e)))}async create(...e){return this.wind=await this.creator(...e),X.addChangeHandler(this.onConfigChange),this.wind.once("close",(()=>this.removeChangeHandler())),this.wind.once("close",(()=>this.onClose(...e))),this.wind.once("focus",(()=>this.onFocus(...e))),this.wind.once("show",(()=>this.onShow(...e))),await this.onCreate(...e),this.wind}async creator(...e){return ne.create({...this.args,type:this.type})}onCreate(...e){}onFocus(...e){}onClose(...e){}onShow(...e){}removeChangeHandler(){X.removeChangeHandler(this.onConfigChange)}},me=class extends ge{async creator(...e){return ne.openModal({...this.args,type:this.type})}},Ee=new class{constructor(){this.general={setup:`file://${require("path").resolve(__dirname,"..","renderer","setup","index.html")}`,loading:`file://${require("path").resolve(__dirname,"..","renderer","loading","index.html")}`,settings:`file://${require("path").resolve(__dirname,"..","renderer","settings","index.html")}`,update:`file://${require("path").resolve(__dirname,"..","renderer","update","index.html")}`,whatsNew:`file://${require("path").resolve(__dirname,"..","renderer","whatsnew","index.html")}`,main:`file://${require("path").resolve(__dirname,"..","renderer","main","index.html")}`},this.preload={setup:require("path").resolve(__dirname,"../renderer","setup","preload.js"),settings:require("path").resolve(__dirname,"../renderer","settings","preload.js"),main:require("path").resolve(__dirname,"../renderer","main","preload.js"),loading:require("path").resolve(__dirname,"../renderer","loading","preload.js"),whatsNew:require("path").resolve(__dirname,"../renderer","whatsnew","preload.js"),update:require("path").resolve(__dirname,"../renderer","update","preload.js")}}};(new class extends me{constructor(){super(...arguments),this.type=v.Loading,this.args={path:Ee.general.loading,preload:Ee.preload.loading,width:280,minWidth:280,height:130,minHeight:150,frame:!1}}async creator(...e){return this.initMethods(await super.creator(...e))}onCreate(){ne.loading=this.wind}initMethods(e){const t=e;function i(e,i){t.webContents.postMessage(e,i)}return t.setText=e=>i("fileName",e),t.setCount=e=>i("count",e),t.setPercent=e=>i("percent",e),t.success=()=>i("success",!0),t.download=()=>i("download",!0),t.showAndWait=()=>new Promise((e=>{t.show(),setTimeout(e,100)})),t}}).register(),(new class extends ge{constructor(){super(...arguments),this.type=v.Main,this.args={path:Ee.general.main,preload:Ee.preload.main,width:840,minWidth:800,height:700,minHeight:630},this.onWindowResize=()=>{this.wind?.on("resize",(()=>{this.wind?.webContents.send(R.windowResize)}))}}onCreate(){i.ipcMain.once(R.handleWindowSize,this.onWindowResize)}onClose(){i.app.quit()}onFocus(){ne.loading?.hide()}}).register(),(new class extends me{constructor(){super(...arguments),this.type=v.Settings,this.args={path:Ee.general.settings,preload:Ee.preload.settings,width:400,minWidth:400,height:330,minHeight:350}}}).register(),(new class extends ge{constructor(){super(...arguments),this.type=v.Setup,this.args={path:Ee.general.setup,preload:Ee.preload.setup,width:620,minWidth:620,height:290,minHeight:310}}onClose(){i.app.quit()}onFocus(){ne.loading?.hide()}}).register(),(new class extends me{constructor(){super(...arguments),this.type=v.Update,this.args={path:Ee.general.update,preload:Ee.preload.update,width:400,minWidth:400,height:160,minHeight:180,frame:!1}}onShow(...e){this.wind?.webContents.postMessage("content",e[0])}}).register(),(new class extends me{constructor(){super(...arguments),this.type=v.WhatsNew,this.args={path:Ee.general.whatsNew,preload:Ee.preload.whatsNew,width:600,minWidth:600,height:500,minHeight:520}}onClose(){X.settings.showWhatsNew=!1}}).register();const Se=new((()=>{var e;let t,a=[];return e=class{constructor(){this.MEDIA_FOLDER=(k(this,a),"[media]"),this.DNS_TO_RESOLVE="www.google.com"}hasAdminPrivileges(){try{return(0,n.writeFileSync)(q.config,JSON.stringify(X.config,null,"\t")),!0}catch{return ne.loading?.setPercent(0),ce.alert({message:re.ADMIN_REQUIRED_MESSAGE,type:"warning",buttons:["Exit"],title:"Error"}),setTimeout(i.app.quit,2e3),!1}}async checkInitialChanges(){(0,n.existsSync)((0,s.join)(q.mainTemp,this.MEDIA_FOLDER))&&ie.getSize(X.initial)===X.sizes.initial||(0,n.existsSync)(X.initial)&&((0,n.existsSync)(q.backupInitial)?await oe.unpackMain(!1):await de.save())}checkUpdate(e){(X.settings.updates||e)&&(0,he.resolve)(this.DNS_TO_RESOLVE,(e=>{e||(0,pe.get)(q.publicInfo,(e=>{let t="";e.setEncoding("utf-8"),e.on("data",(e=>t+=e)),e.on("end",(()=>{const e=JSON.parse(t),n=X.version;(n<e.latestVersion||n.includes("-beta")&&n.split("-beta")[0]===e.latestVersion)&&(n>=e.minVersion?ue.open(v.Update,e.latestVersion):le.show(re.NOTIFICATION,re.ALLOW_NEW_VERSION).then((()=>{i.shell.openExternal(q.downloadPage)})))}))}))}))}hasAllPaths(){return(0,n.existsSync)(X.initial)?(0,n.existsSync)(q.classes)?(X.settings.DLC&&!(0,n.existsSync)(q.dlc)&&(ce.error(re.DLC_FOLDER_NOT_FOUND),X.settings.DLC=!1),!0):(ce.error(re.CLASSES_NOT_FOUND),!1):(ce.error(re.INITIAL_NOT_FOUND),!1)}hasPermissions(e){try{return(0,n.accessSync)(e,n.constants.W_OK),!0}catch{return!1}}},t=[W()],D(e,null,t,{kind:"method",name:"checkUpdate",static:!1,private:!1,access:{has:e=>"checkUpdate"in e,get:e=>e.checkUpdate}},null,a),e})());new((()=>{var e;let t,i,r=[];return e=class{constructor(){this.DEFAULT_NAME=(k(this,r),"joined")}join(){const e=ce.getMultiEPF();if(e&&e.length>1){const t=[],i=[];e.forEach((e=>{const s=JSON.parse((0,n.readFileSync)(e).toString());Array.isArray(s)?s.forEach((e=>{i.includes(e.fileName)||(t.push(e),i.push(e.fileName))})):i.includes(s.fileName)||(t.push(s),i.push(s.fileName))}));const r=ce.saveEPF(this.DEFAULT_NAME);r&&((0,n.writeFileSync)(r,JSON.stringify(t,null,"\t")),ce.alert({title:a,message:`${re.SUCCESS_JOIN}\n- ${e.map((e=>(0,s.basename)(e))).join("\n- ")}`}))}}see(){const e=ce.getEPF();if(!e)return;const t=JSON.parse((0,n.readFileSync)(e).toString()),i=[];Array.isArray(t)?t.forEach((e=>i.push(e.fileName))):i.push(t.fileName),ce.alert({title:a,message:`${re.SEE_EXPORTED_MESSAGE}\n\n${i.join("\n")}`})}},t=[W("joinEPF")],i=[W("seeEPF")],D(e,null,t,{kind:"method",name:"join",static:!1,private:!1,access:{has:e=>"join"in e,get:e=>e.join}},null,r),D(e,null,i,{kind:"method",name:"see",static:!1,private:!1,access:{has:e=>"see"in e,get:e=>e.see}},null,r),e})()),new class{constructor(){this.lang=X.lang,this.localize=e=>e[this.lang]}},new((()=>{var e;let t,a=[];return e=class{download(e,t){const{array:i,isRoot:a,inMemory:r,loadingPage:o,path:c,url:l,fromJSON:d}=e;if(i){const{url:e,path:n}=i[0];return a&&o?.setCount(i.length),o?.setText((0,s.basename)(n)),void this.download({url:e,path:n,loadingPage:o},(()=>{t(),i.length>1&&this.download({array:i.slice(1),loadingPage:o},t)}))}(0,pe.get)(l,(e=>{if(r){let i="";e.on("data",(e=>i+=e)),e.on("end",(()=>{t(d?JSON.parse(i):i)}))}else{const i=(0,n.createWriteStream)(c);if(o){const t=parseInt(e.headers["content-length"],10);let i=0;e.on("data",(e=>{i+=e.length,o.setPercent((i/t*100).toFixed(2))}))}e.pipe(i),e.on("end",(()=>{o?.success(),i.on("close",t),i.close()}))}}))}update(){const e=ne.loading;let t=!1;e?.download(),e?.show(),K.clearTemp(),this.download({url:q.updateMap,fromJSON:!0,inMemory:!0},(a=>{const r=this.processMap(a),o=r[0];let c=r[1];(0,n.mkdirSync)(q.updateRoot),o.forEach((e=>{const t=(0,s.join)(q.root,e),i=(0,s.join)(q.updateRoot,e);(0,n.existsSync)((0,s.dirname)(i))||(0,n.mkdirSync)((0,s.dirname)(i),{recursive:!0}),(0,n.copyFileSync)(t,i)})),H(c)||(z.saveConfig=!1,X.export(),z.quit=!0,i.app.relaunch(),i.app.quit());const l=[];c.forEach((e=>{const t=(0,s.join)(q.updateRoot,e),i=e.replaceAll("\\","/").replace(".webpack","webpack"),a=`${q.updateFiles}/${i}`;(0,n.existsSync)((0,s.dirname)(t))||(0,n.mkdirSync)((0,s.dirname)(t),{recursive:!0}),l.push({url:a,path:t})})),this.download({array:l,loadingPage:e,isRoot:!0},(()=>{c=c.slice(1),H(c)||t||(z.saveConfig=!1,z.quit=!0,t=!0,X.export(),i.app.relaunch(),i.app.quit())}))}))}processMap(e){const t=[],i=[];for(const a in e){const r=(0,s.join)(q.root,a);if((0,n.existsSync)(r)){if((0,n.lstatSync)(r).isDirectory())continue;ie.calc(r)!==e[a]?t.push(a):i.push(a)}else t.push(a)}return[i,t]}constructor(){k(this,a)}},t=[W("updateApp")],D(e,null,t,{kind:"method",name:"update",static:!1,private:!1,access:{has:e=>"update"in e,get:e=>e.update}},null,a),e})()),new((()=>{var e;let t,r,o,c,l,d,h,p,u,g=[];return e=class{openLink(e){return i.shell.openExternal(e)}openPath(e){return i.shell.openPath(e)}reload(){z.quit=!0,i.app.relaunch(),i.app.quit()}quit(){z.quit=!0,i.app.quit()}devTools(){i.BrowserWindow.getFocusedWindow()?.webContents.toggleDevTools()}uninstall(){(0,n.existsSync)(q.uninstall)?((0,se.execFile)(q.uninstall),z.quit=!0,i.app.quit()):ce.alert({message:re.ONLY_MANUAL_UNINS,title:a})}exportConfig(){return!!X.export()&&(ce.alert({message:re.SUCCESS_EXPORT_MESSAGE,title:a}),!0)}importConfig(){return X.import()?(z.quit=!0,i.app.relaunch(),i.app.quit(),!0):(ce.alert({message:re.IMPORT_CONFIG_ERROR,title:a}),!1)}updateFiles(e){if(e)try{oe.update((0,s.join)(q.modsTemp,e),X.mods.items[e].path,!0)}catch{try{(0,n.chmodSync)(X.mods.items[e].path,511),oe.update((0,s.join)(q.modsTemp,e),X.mods.items[e].path,!0)}catch{ce.error(re.SAVE_MOD_ERROR)}}else try{oe.update(q.mainTemp,X.initial)}catch{try{(0,n.chmodSync)(X.initial,511),oe.update(q.mainTemp,X.initial)}catch{ce.error(re.SAVE_ORIGINAL_ERROR)}}}constructor(){k(this,g)}},t=[W()],r=[W()],o=[W("relaunchApp")],c=[W("quitApp")],l=[W()],d=[W("runUninstall")],h=[W()],p=[W()],u=[W()],D(e,null,t,{kind:"method",name:"openLink",static:!1,private:!1,access:{has:e=>"openLink"in e,get:e=>e.openLink}},null,g),D(e,null,r,{kind:"method",name:"openPath",static:!1,private:!1,access:{has:e=>"openPath"in e,get:e=>e.openPath}},null,g),D(e,null,o,{kind:"method",name:"reload",static:!1,private:!1,access:{has:e=>"reload"in e,get:e=>e.reload}},null,g),D(e,null,c,{kind:"method",name:"quit",static:!1,private:!1,access:{has:e=>"quit"in e,get:e=>e.quit}},null,g),D(e,null,l,{kind:"method",name:"devTools",static:!1,private:!1,access:{has:e=>"devTools"in e,get:e=>e.devTools}},null,g),D(e,null,d,{kind:"method",name:"uninstall",static:!1,private:!1,access:{has:e=>"uninstall"in e,get:e=>e.uninstall}},null,g),D(e,null,h,{kind:"method",name:"exportConfig",static:!1,private:!1,access:{has:e=>"exportConfig"in e,get:e=>e.exportConfig}},null,g),D(e,null,p,{kind:"method",name:"importConfig",static:!1,private:!1,access:{has:e=>"importConfig"in e,get:e=>e.importConfig}},null,g),D(e,null,u,{kind:"method",name:"updateFiles",static:!1,private:!1,access:{has:e=>"updateFiles"in e,get:e=>e.updateFiles}},null,g),e})());const _e=new((()=>{var e;let t,i=[],a=[];return e=class{constructor(){this.locals=(k(this,i),{RU:"russian",EN:"english",DE:"german",CH:"chinese_simplified"}),this.gameTexts=k(this,a,{mods:{},main:{}}),function(e){let t=X.lang;X.addChangeHandler((function(){X.lang!==t&&(t=X.lang,e())}))}((()=>{this.gameTexts.main={},this.gameTexts.mods={},this.getFromGame(),this.getFromMods()}))}async getFromGame(){if((0,n.existsSync)(q.texts)&&(this.gameTexts.main=JSON.parse((0,n.readFileSync)(q.texts).toString())),(0,n.existsSync)(q.strings)){const e=(0,s.join)(q.strings,`strings_${this.locals[X.lang]}.str`);(0,n.existsSync)(e)&&(this.gameTexts.main=this.parseFile((0,n.readFileSync)(e,{encoding:"utf16le"}).toString()),this.saveFromGame())}}getFromMods(){const e={};for(const t in X.mods.items)if((0,n.existsSync)((0,s.join)(q.modsTemp,t,"texts"))){const i=(0,s.join)(q.modsTemp,t,`texts/strings_${this.locals[X.lang]}.str`);(0,n.existsSync)(i)&&(e[t]=this.parseFile((0,n.readFileSync)(i,{encoding:"utf16le"}).toString(),!0))}this.gameTexts.mods=e}saveFromGame(){(0,n.writeFileSync)(q.texts,JSON.stringify(this.gameTexts.main,null,"\t"))}parseFile(e,t){const i={},n=e.match(/[^\r\n]+/g);return n&&n.forEach((e=>{const n=e.split('"');if(n&&n.length>1){const n=e.split('"')[0].trimEnd().replaceAll('"',"").replaceAll("'","").replaceAll("\ufeff",""),s=e.split('"')[1].replaceAll("\\","");if(t||this.startsWith(n,["UI_VEHICLE","UI_ADDON","UI_ADDONS","UI_UPGRADE","UI_TUNING","UI_SCOUT","UI_FRAME","UI_STUFF","UI_SEMITRAILER","UI_TRAILER","UI_ROCKET","UI_TRAIN","UI_ENGINE","UI_GEARBOX","UI_SUSPENSION","UI_RIM","UI_TIRE","UI_WINCH"])&&n.endsWith("NAME"))try{i[n]=s}catch{}}})),i}startsWith(e,t){for(let i=0;i<t.length;++i)if(e.startsWith(t[i]))return!0;return!1}},t=[B({name:"texts",access:P.get})],D(null,null,t,{kind:"field",name:"gameTexts",static:!1,private:!1,access:{has:e=>"gameTexts"in e,get:e=>e.gameTexts,set:(e,t)=>{e.gameTexts=t}}},a,i),e})());new class{constructor(){this.checkMultipleInstances(),this.setName(),this.optimize(),this.handleQuit(),this.handleAllClosed(),this.start()}start(){i.app.whenReady().then((()=>this.openProgram()))}async openProgram(){await ue.open(v.Loading);const e=ne.loading;if(await(e?.showAndWait()),e?.setText(Q.LOADING),Se.hasAdminPrivileges()){if(!X.initial)return await ue.open(v.Setup),void Se.checkUpdate();await Se.checkInitialChanges(),Se.hasAllPaths()?(await Promise.all([_e.getFromGame(),this.initDLC(),this.initMods()]),await ue.open(v.Main),Se.checkUpdate()):X.reset()}}checkMultipleInstances(){i.app.requestSingleInstanceLock()||(i.app.quit(),process.exit(102))}optimize(){i.app.disableHardwareAcceleration()}setName(){i.app.setAppUserModelId(a)}handleQuit(){i.app.on("before-quit",(()=>{z.quit=!0,z.saveConfig&&X.save(),(0,n.existsSync)(q.updateRoot)&&((0,n.rmSync)(q.root,{recursive:!0}),(0,n.renameSync)(q.updateRoot,q.root))}))}handleAllClosed(){i.app.once("window-all-closed",(()=>i.app.exit()))}async initDLC(){X.settings.DLC&&(X.dlc=K.findInDir(q.dlc,!0))}async initMods(){if(!X.settings.mods)return;if(!H(X.mods))return;let e=X.mods.length;function t(t){const i=t.replace(".pak","");delete X.mods.items[i],--X.mods.length,--e}for(const i in X.mods.items){const a=X.mods.items[i];if((0,n.existsSync)(a.path))if(Se.hasPermissions(a.path)){if(ie.getSize(a.path)===X.sizes.mods[i]&&(0,n.existsSync)(q.modsTemp[i]))--e;else if(await oe.unpackMod(a.path),(0,n.existsSync)((0,s.join)(q.modsTemp,i,"classes"))?--e:t(X.mods.items[i].name),0===e)return void _e.getFromMods()}else t(X.mods.items[i].name);else t(X.mods.items[i].name)}e<=0&&_e.getFromMods()}},module.exports=t})();