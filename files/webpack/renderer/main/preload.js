(()=>{"use strict";"undefined"!=typeof __webpack_require__&&(__webpack_require__.ab=__dirname+"/native_modules/");const e=require("electron"),r=require("fs"),n=require("path");var t,o,i;function s(e,r){console.error(`Error on ${r}.\n${e}`.replace("Error: ",""))}!function(e){e.get="get",e.set="set"}(t||(t={})),function(e){e.renderer="renderer",e.preload="preload"}(o||(o={})),function(e){e.getPublicInfo="GET_PUBLIC_INFO",e.functionCall="FUNCTION_CALL_",e.propertyGet="PROPERTY_GET_",e.propertySet="PROPERTY_SET_",e.promisePostfix="_PROMISE"}(i||(i={}));const c=e.ipcRenderer.sendSync(i.getPublicInfo);if(!c)throw new Error("Public methods from main is not provided");const a=function(e){const{info:r,scope:n,getVariable:i,setVariable:c,callFunction:a,waitPromise:d}=e,l={as:()=>p};r.functions.forEach((e=>{r.scopes[e].has(n)&&Object.defineProperty(l,e,{get:()=>(...r)=>{const n=a(e,...r);if(!n.error)return n.promiseChannel?d(n.promiseChannel):n.value;s(n.error,e)},set(){throw new Error(`Function '${e}' is readonly`)},enumerable:!0})})),r.properties.forEach((e=>{if(!r.scopes[e].has(n))return;let o=()=>{const r=i(e);if(!r.error)return r.value;s(r.error,e)},a=r=>{const n=c(e,r);n?.error&&s(n.error,e)};r.accesses[e].has(t.get)||(o=()=>{throw new Error(`No access to getting the '${e}' property`)}),r.accesses[e].has(t.set)||(a=()=>{throw new Error(`No access to setting the '${e}' property`)}),Object.defineProperty(l,e,{get:o,set:a,enumerable:!0})}));const p=new Proxy(l,{get(e,n){if(n in e)return e[n];const i=r.functions.has(n),s=r.properties.has(n);if(!i&&!s)throw new Error(`'${n}' is not provided from main`);if(!r.scopes[n].has(o.renderer))throw new Error(`'${n}' is not provided into renderer scope`);if(s&&!r.accesses[n].has(t.get))throw new Error(`No access to getting the '${n}' property`);throw new Error(`Unknown error on get '${n}'`)},set(e,n,i){if(n in e)return e[n]=i,!0;const s=r.functions.has(n),c=r.properties.has(n);if(s)throw new Error(`Function '${n}' is readonly`);if(!c)throw new Error(`Property '${n}' is not provided from main`);if(!r.scopes[n].has(o.renderer))throw new Error(`'${n}' is not provided into renderer scope`);if(!r.accesses[n].has(t.set))throw new Error(`No access to setting the '${n}' property`);throw new Error(`Unknown error on set '${n}'`)},ownKeys:e=>Object.keys(e),has:(e,r)=>r in e});return p}({info:c,scope:o.preload,callFunction:(r,...n)=>e.ipcRenderer.sendSync(i.functionCall+r,...n),getVariable:r=>e.ipcRenderer.sendSync(i.propertyGet+r),setVariable:(r,n)=>e.ipcRenderer.sendSync(i.propertySet+r,n),waitPromise:r=>new Promise(((n,t)=>{e.ipcRenderer.once(r,((e,r)=>{r.error?t(r.error):n(r.value)}))}))}),d=e.ipcRenderer.sendSync(i.getPublicInfo),l=new class{constructor(){this.init()}register(e){window.ipc=e,this.init()}init(){const e=window.ipc;for(const r in e)this[r]=e[r]}};var p,u;!function(e){e.dev="dev",e.prod="prod"}(p||(p={})),function(e){e.trucks="trucks",e.trailers="trailers"}(u||(u={}));const f=u;var w,m,h,y,g,S,v,E,b,_,P,R;!function(e){e.sync="sync",e.async="async"}(w||(w={})),function(e){e.file="file",e.dir="dir"}(m||(m={})),function(e){e.open="open",e.save="save"}(h||(h={})),function(e){e.engines="engines",e.gearboxes="gearboxes",e.suspensions="suspensions",e.wheels="wheels",e.winches="winches",e.truck="truck"}(y||(y={})),function(e){e.main="main",e.dlc="dlc",e.mods="mods",e.favorites="favorites"}(g||(g={})),function(e){e.text="text",e.number="number",e.select="select",e.coordinates="coordinates",e.file="file"}(S||(S={})),function(e){e.changeConfig="change-config",e.windowReady="window-ready-",e.windowResize="window-resize",e.handleWindowSize="handle-window-size"}(v||(v={})),function(e){e.RU="RU",e.EN="EN",e.DE="DE",e.CH="CH"}(E||(E={})),function(e){e.integer="int",e.float="float"}(b||(b={})),function(e){e.editor="editor",e.lists="lists"}(_||(_={})),function(e){e.input="input",e.group="group"}(P||(P={})),function(e){e.common="common",e.lists="lists",e.editor="editor"}(R||(R={}));const k=R;var j,F;!function(e){e.Main="MainWindow",e.Settings="SettingsWindow",e.Update="UpdateWindow",e.WhatsNew="WhatsNewWindow",e.Loading="LoadingWindow",e.Setup="SetupWindow"}(j||(j={})),function(e){e.mods="mods",e.dlc="dlc",e.main="main",e.favorites="favorites"}(F||(F={}));const I=F;var x;!function(e){e.multiply="multiply",e.single="single"}(x||(x={}));const $=new class{register(e,r=k.common){window.preloads||(window.preloads={}),window.preloads[r]&&console.warn(`Overwriting preload (type='${r}')`),window.preloads[r]=e}get(e=k.common){if(!window.preloads)throw new Error("Preloads not defined");const r=window.preloads[e];if(!r)throw new Error(`Preload not found (type='${e}')`);return r}};new class{pop(e){const r=this.get(e);return localStorage.removeItem(e),r}get(e){const r=localStorage.getItem(e);switch(r){case"null":return null;case"undefined":return;default:return r}}set(e,r){localStorage.setItem(e,r)}};const D=new class{constructor(){this.init()}register(e){window.service=e,this.init()}init(){const e=window.service;for(const r in e)this[r]=e[r]}};!function(r=!0){const n={getInfo:()=>d,waitPromise(r,n,t){e.ipcRenderer.once(r,((e,r)=>{r.error?t?.(r.error):n(r.value)}))},provided:{properties:{},functions:{}}};d.functions.forEach((r=>{Object.defineProperty(n.provided.functions,r,{value:(...n)=>e.ipcRenderer.sendSync(i.functionCall+r,...n),enumerable:!0})})),d.properties.forEach((r=>{Object.defineProperty(n.provided.properties,r,{get:()=>e.ipcRenderer.sendSync(i.propertyGet+r),set(n){e.ipcRenderer.sendSync(i.propertySet+r,n)},enumerable:!0})})),r?e.contextBridge.exposeInMainWorld("__provider__",n):window.__provider__=n}(!1),new class{constructor(){this.addIPC(),this.addSystem()}addIPC(){l.register({sendSync:(r,...n)=>e.ipcRenderer.sendSync(r,...n),send(r,...n){e.ipcRenderer.send(r,...n)},on(r,n){e.ipcRenderer.on(r,n)},once(r,n){e.ipcRenderer.once(r,n)},remove(r,n){e.ipcRenderer.removeListener(r,n)},removeAll(r){e.ipcRenderer.removeAllListeners(r)}})}addSystem(){D.register({readFileSync:e=>(0,r.readFileSync)(e).toString(),isDirectory:e=>(0,r.lstatSync)(e).isDirectory(),writeFileSync:r.writeFileSync,readdirSync:r.readdirSync,existsSync:r.existsSync,basename:n.basename,join:n.join})}};const C=a.as(),L=C.paths;new class{constructor(){this.findFromDLC=(e,t)=>{const o=(0,r.readdirSync)(L.dlc);for(let i=0;i<o.length;++i){const s=(0,n.join)(L.dlc,o[i],"classes",t,`${e}.xml`);if((0,r.existsSync)(s))return s}},this.watchFile=(e,n)=>{(0,r.watchFile)(e,{persistent:!1},n)},$.register({findFromDLC:this.findFromDLC,watchFile:this.watchFile},k.editor)}};const M=require("os"),{paths:N,config:O}=C,{dlc:T,mods:W}=O;new class{constructor(){this.removeDir=e=>{(0,r.rmSync)(e,{recursive:!0})},this.findMods=async()=>{const e=(0,M.userInfo)().homedir||(0,M.homedir)()||process.env.HOME||"",t=[];if(!(0,r.existsSync)(e))return[];const o=(0,n.join)(e,"Documents/My Games/SnowRunner/base/Mods/.modio/mods");if(!(0,r.existsSync)(o))return[];(0,r.readdirSync)(o,{withFileTypes:!0}).forEach((e=>{if(e.isFile())return;const i=(0,n.join)(o,e.name);(0,r.readdirSync)(i,{withFileTypes:!0}).forEach((e=>{if(e.isDirectory())return;const o=(0,n.join)(i,e.name),s=(0,n.join)(N.modsTemp,e.name);if(".pak"===(0,n.extname)(e.name)&&(C.unpack(o,s,!0),(0,r.existsSync)((0,n.join)(s,"classes")))){const s=(0,n.join)(i,"modio.json");let c=(0,n.basename)(e.name,".pak");(0,r.existsSync)(s)&&(c=JSON.parse((0,r.readFileSync)(s).toString()).name),t.push({name:c,path:o})}}))}));for(const e in W.items){const r=W.items[e].path;let n=!1;for(const e in t)t[e].path===r&&(n=!0);n||t.push(W.items[e])}return t},this.getModPak=()=>{const e=C.getInitial();if(!e)return;const t=(0,n.basename)(e),o=(0,n.basename)(e,".pak");return C.unpack(e,(0,n.join)(N.modsTemp,o),!0),(0,r.existsSync)((0,n.join)(N.modsTemp,o,"classes"))?{path:e,name:t}:void 0},this.getList=(e,r)=>{if(r===I.dlc){const r=[];return T.forEach((t=>{const o=`${t.path}/classes`;let i=[];e===f.trucks?i=C.findInDir((0,n.join)(o,"trucks")):e===f.trailers&&(i=C.findInDir((0,n.join)(o,"trucks/trailers"))),r.push({dlcName:t.name,items:i,path:"",name:""})})),r}if(r===I.mods){const r=[];for(const t in W.items){const o=W.items[t];let i=[];(e===f.trucks||e===f.trailers)&&(i=C.findInDir((0,n.join)(N.modsTemp,t,"classes/trucks"),!1,".xml",!0)),r.push({id:t,name:o.name,path:"",items:i})}return r}return e===f.trucks?C.findInDir((0,n.join)(N.classes,"trucks")):e===f.trailers?C.findInDir((0,n.join)(N.classes,"trucks/trailers")):[]},$.register({findMods:this.findMods,getList:this.getList,getModPak:this.getModPak,removeDir:this.removeDir},k.lists)}}})();