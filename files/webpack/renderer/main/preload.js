(()=>{"use strict";"undefined"!=typeof __webpack_require__&&(__webpack_require__.ab=__dirname+"/native_modules/");const e=require("electron"),n=require("fs"),r=require("path");var t,i,o;function s(e,n){console.error(`Error on ${n}.\n${e}`.replace("Error: ",""))}!function(e){e.get="get",e.set="set"}(t||(t={})),function(e){e.renderer="renderer",e.preload="preload"}(i||(i={})),function(e){e.getPublicInfo="GET_PUBLIC_INFO",e.functionCall="FUNCTION_CALL_",e.mainEventOn="MAIN_EVENT_ON_",e.mainEventOnce="MAIN_EVENT_ONCE_",e.mainEventEmit="MAIN_EVENT_EMIT_",e.propertyGet="PROPERTY_GET_",e.propertySet="PROPERTY_SET_",e.promisePostfix="_PROMISE",e.rendererEventEmit="RENDERER_EMIT_"}(o||(o={}));const c=e.ipcRenderer.sendSync(o.getPublicInfo);if(!c)throw new Error("Public methods from main is not provided");const a=function(e){const{info:n,scope:r,getVariable:i,setVariable:o,callFunction:c,handleMainEvent:a,waitPromise:d,emitRendererEvent:l}=e,p={as:()=>p};function u(e,t){let i;i=n.scopes.get(e).has(r)?t?.value?{get:()=>t.value,set:()=>{throw new Error(`'${e}' is readonly`)},enumerable:!0}:{get:t?.get||(()=>{throw new Error(`No access to getting '${e}'`)}),set:t?.set||(()=>{throw new Error(`'${e}' is readonly`)}),enumerable:!0}:{get(){throw new Error(`'${e}' is not provided into ${r} scope`)},set(){throw new Error(`'${e}' is not provided into ${r} scope`)}},Object.defineProperty(p,e,i)}return n.functions.forEach((e=>{u(e,{value(...n){const r=c(e,...n);if(!r.error)return r.promiseChannel?d(r.promiseChannel):r.value;s(r.error,e)}})})),n.rendererEvents.forEach((e=>{u(e,{value(n){l(e,n)}})})),n.mainEvents.forEach((e=>{const n=`on${e[0].toUpperCase()}${e.slice(1)}`,r=`once${e[0].toUpperCase()}${e.slice(1)}`;u(n,{value:n=>a(e,"on",(r=>{r.error?s(r.error,e):(r.promiseChannel&&d(r.promiseChannel).then(n),n(r.value))}))}),u(r,{value:n=>a(e,"once",(r=>{r.error?s(r.error,e):(r.promiseChannel&&d(r.promiseChannel).then(n),n(r.value))}))})})),n.properties.forEach((e=>{u(e,{get:n.accesses.get(e).has(t.get)?()=>{const n=i(e);if(!n.error)return n.value;s(n.error,e)}:()=>{throw new Error(`No access to getting the '${e}' property`)},set:n.accesses.get(e).has(t.set)?n=>{const r=o(e,n);r?.error&&s(r.error,e)}:()=>{throw new Error(`No access to setting the '${e}' property`)}})})),p}({info:c,scope:i.preload,callFunction:(n,...r)=>e.ipcRenderer.sendSync(o.functionCall+n,...r),handleMainEvent(n,r,t){const i=(e,n)=>t(n),s=o.mainEventEmit+n;return"on"===r?(e.ipcRenderer.send(o.mainEventOn+n),e.ipcRenderer.on(s,i)):(e.ipcRenderer.send(o.mainEventOnce+n),e.ipcRenderer.once(s,i)),()=>e.ipcRenderer.removeListener(s,i)},emitRendererEvent(n,r){const t=o.rendererEventEmit+n;if(r instanceof Promise){const n=t+o.promisePostfix;e.ipcRenderer.sendSync(t,{promiseChannel:n}),r.then((r=>e.ipcRenderer.send(n,{value:r}))).catch((r=>e.ipcRenderer.send(n,{error:String(r)})))}else e.ipcRenderer.send(t,{value:r})},getVariable:n=>e.ipcRenderer.sendSync(o.propertyGet+n),setVariable:(n,r)=>e.ipcRenderer.sendSync(o.propertySet+n,r),waitPromise:n=>new Promise(((r,t)=>{e.ipcRenderer.once(n,((e,n)=>{n.error?t(n.error):r(n.value)}))}))}),d=e.ipcRenderer.sendSync(o.getPublicInfo),l=new class{constructor(){this.init()}register(e){window.ipc=e,this.init()}init(){const e=window.ipc;for(const n in e)this[n]=e[n]}};var p,u;!function(e){e.dev="dev",e.prod="prod"}(p||(p={})),function(e){e.trucks="trucks",e.trailers="trailers"}(u||(u={}));const m=u;var f,h,w,v,E,g,y,S,R,_,I,P;!function(e){e.sync="sync",e.async="async"}(f||(f={})),function(e){e.file="file",e.dir="dir"}(h||(h={})),function(e){e.open="open",e.save="save"}(w||(w={})),function(e){e.engines="engines",e.gearboxes="gearboxes",e.suspensions="suspensions",e.wheels="wheels",e.winches="winches",e.truck="truck"}(v||(v={})),function(e){e.main="main",e.dlc="dlc",e.mods="mods",e.favorites="favorites"}(E||(E={})),function(e){e.text="text",e.number="number",e.select="select",e.coordinates="coordinates",e.file="file"}(g||(g={})),function(e){e.changeConfig="change-config",e.windowReady="window-ready-",e.windowResize="window-resize",e.handleWindowSize="handle-window-size"}(y||(y={})),function(e){e.RU="RU",e.EN="EN",e.DE="DE",e.CH="CH"}(S||(S={})),function(e){e.integer="int",e.float="float"}(R||(R={})),function(e){e.editor="editor",e.lists="lists"}(_||(_={})),function(e){e.input="input",e.group="group"}(I||(I={})),function(e){e.common="common",e.lists="lists",e.editor="editor"}(P||(P={}));const b=P;var C,k;!function(e){e.Main="MainWindow",e.Settings="SettingsWindow",e.Update="UpdateWindow",e.WhatsNew="WhatsNewWindow",e.Loading="LoadingWindow",e.Setup="SetupWindow"}(C||(C={})),function(e){e.mods="mods",e.dlc="dlc",e.main="main",e.favorites="favorites"}(k||(k={}));const N=k;var M;!function(e){e.multiply="multiply",e.single="single"}(M||(M={}));const x=new class{register(e,n=b.common){window.preloads||(window.preloads={}),window.preloads[n]&&console.warn(`Overwriting preload (type='${n}')`),window.preloads[n]=e}get(e=b.common){if(!window.preloads)throw new Error("Preloads not defined");const n=window.preloads[e];if(!n)throw new Error(`Preload not found (type='${e}')`);return n}};new class{pop(e){const n=this.get(e);return localStorage.removeItem(e),n}get(e){const n=localStorage.getItem(e);switch(n){case"null":return null;case"undefined":return;default:return n}}set(e,n){localStorage.setItem(e,n)}};const F=new class{constructor(){this.init()}register(e){window.service=e,this.init()}init(){const e=window.service;for(const n in e)this[n]=e[n]}};!function(n=!0){const r={getInfo:()=>d,waitPromise(n,r,t){e.ipcRenderer.once(n,((e,n)=>{n.error?t?.(n.error):r(n.value)}))},provided:{properties:{},functions:{},mainEvents:{},rendererEvents:{}}};d.functions.forEach((n=>{r.provided.functions[n]=(...r)=>e.ipcRenderer.sendSync(o.functionCall+n,...r)})),d.rendererEvents.forEach((n=>{r.provided.rendererEvents[n]=r=>{const t=o.rendererEventEmit+n;r instanceof Promise?r.then((n=>e.ipcRenderer.send(t,{value:n}))).catch((n=>e.ipcRenderer.send(t,{error:String(n)}))):e.ipcRenderer.send(t,{value:r})}})),d.mainEvents.forEach((n=>{r.provided.mainEvents[n]=(r,t)=>{const i=(e,n)=>t(n),s=o.mainEventEmit+n;return"on"===r?(e.ipcRenderer.on(s,i),e.ipcRenderer.send(o.mainEventOn+n)):(e.ipcRenderer.once(s,i),e.ipcRenderer.send(o.mainEventOnce+n)),()=>e.ipcRenderer.removeListener(s,i)}})),d.properties.forEach((n=>{r.provided.properties[n]={get:()=>e.ipcRenderer.sendSync(o.propertyGet+n),set(r){e.ipcRenderer.sendSync(o.propertySet+n,r)}}})),n?e.contextBridge.exposeInMainWorld("__provider__",r):window.__provider__=r}(!1),new class{constructor(){this.addIPC(),this.addSystem()}addIPC(){l.register({sendSync:(n,...r)=>e.ipcRenderer.sendSync(n,...r),send(n,...r){e.ipcRenderer.send(n,...r)},on(n,r){e.ipcRenderer.on(n,r)},once(n,r){e.ipcRenderer.once(n,r)},remove(n,r){e.ipcRenderer.removeListener(n,r)},removeAll(n){e.ipcRenderer.removeAllListeners(n)}})}addSystem(){F.register({readFileSync:e=>(0,n.readFileSync)(e).toString(),isDirectory:e=>(0,n.lstatSync)(e).isDirectory(),writeFileSync:n.writeFileSync,readdirSync:n.readdirSync,existsSync:n.existsSync,basename:r.basename,join:r.join})}};const $=a.as(),j=$.paths;new class{constructor(){this.findFromDLC=(e,t)=>{const i=(0,n.readdirSync)(j.dlc);for(let o=0;o<i.length;++o){const s=(0,r.join)(j.dlc,i[o],"classes",t,`${e}.xml`);if((0,n.existsSync)(s))return s}},this.watchFile=(e,r)=>{(0,n.watchFile)(e,{persistent:!1},r)},x.register({findFromDLC:this.findFromDLC,watchFile:this.watchFile},b.editor)}};const D=require("os"),{paths:O,config:T}=$,{dlc:L,mods:W}=T;new class{constructor(){this.removeDir=e=>{(0,n.rmSync)(e,{recursive:!0})},this.findMods=async()=>{const e=(0,D.userInfo)().homedir||(0,D.homedir)()||process.env.HOME||"",t=[];if(!(0,n.existsSync)(e))return[];const i=(0,r.join)(e,"Documents/My Games/SnowRunner/base/Mods/.modio/mods");if(!(0,n.existsSync)(i))return[];(0,n.readdirSync)(i,{withFileTypes:!0}).forEach((e=>{if(e.isFile())return;const o=(0,r.join)(i,e.name);(0,n.readdirSync)(o,{withFileTypes:!0}).forEach((e=>{if(e.isDirectory())return;const i=(0,r.join)(o,e.name),s=(0,r.join)(O.modsTemp,e.name);if(".pak"===(0,r.extname)(e.name)&&($.unpack(i,s,!0),(0,n.existsSync)((0,r.join)(s,"classes")))){const s=(0,r.join)(o,"modio.json");let c=(0,r.basename)(e.name,".pak");(0,n.existsSync)(s)&&(c=JSON.parse((0,n.readFileSync)(s).toString()).name),t.push({name:c,path:i})}}))}));for(const e in W.items){const n=W.items[e].path;let r=!1;for(const e in t)t[e].path===n&&(r=!0);r||t.push(W.items[e])}return t},this.getModPak=()=>{const e=$.getInitial();if(!e)return;const t=(0,r.basename)(e),i=(0,r.basename)(e,".pak");return $.unpack(e,(0,r.join)(O.modsTemp,i),!0),(0,n.existsSync)((0,r.join)(O.modsTemp,i,"classes"))?{path:e,name:t}:void 0},this.getList=(e,n)=>{if(n===N.dlc){const n=[];return L.forEach((t=>{const i=`${t.path}/classes`;let o=[];e===m.trucks?o=$.findInDir((0,r.join)(i,"trucks")):e===m.trailers&&(o=$.findInDir((0,r.join)(i,"trucks/trailers"))),n.push({dlcName:t.name,items:o,path:"",name:""})})),n}if(n===N.mods){const n=[];for(const t in W.items){const i=W.items[t];let o=[];(e===m.trucks||e===m.trailers)&&(o=$.findInDir((0,r.join)(O.modsTemp,t,"classes/trucks"),!1,".xml",!0)),n.push({id:t,name:i.name,path:"",items:o})}return n}return e===m.trucks?$.findInDir((0,r.join)(O.classes,"trucks")):e===m.trailers?$.findInDir((0,r.join)(O.classes,"trucks/trailers")):[]},x.register({findMods:this.findMods,getList:this.getList,getModPak:this.getModPak,removeDir:this.removeDir},b.lists)}}})();