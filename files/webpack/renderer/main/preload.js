(()=>{"use strict";const e=require("electron");window.ipc={sendSync:(n,...i)=>e.ipcRenderer.sendSync(n,...i),send:(n,...i)=>e.ipcRenderer.send(n,...i),on:(n,i)=>e.ipcRenderer.on(n,i),removeAll:n=>e.ipcRenderer.removeAllListeners(n)};const n=require("fs"),i=require("path");window.service={readFileSync:e=>(0,n.readFileSync)(e).toString(),isDirectory:e=>(0,n.lstatSync)(e).isDirectory(),writeFileSync:n.writeFileSync,readdirSync:n.readdirSync,existsSync:n.existsSync,basename:i.basename,join:i.join};const{sendSync:t}=window.ipc,s=t("getInfo");function r(e,n){window.ipcErrorHandler?window.ipcErrorHandler(e.message,n):console.error(`Error on ${n}.\n${e}`.replace("Error: ",""))}const o=new Proxy({},{get(e,n){if(s.properties.includes(n)){const e=`property_${n}_get`,i=t(e);return i.error?(r(i.error,e),null):i.value}if(s.functions.includes(n))return(...e)=>{const i=`function_${n}_call`,s=t(i,...e);return s.error?(r(s.error,i),null):s.value}},set(e,n,i){if(s.properties.includes(n)){const e=`property_${n}_set`,s=t(e,i);return!s.error||(r(s.error,e),!1)}return!1}}),{paths:c}=o;window.editorPreload={findFromDLC:function(e,t){const s=(0,n.readdirSync)(c.dlc);for(let r=0;r<s.length;++r){const o=(0,i.join)(c.dlc,s[r],"classes",t,`${e}.xml`);if((0,n.existsSync)(o))return o}},watchFile:function(e,i){return(0,n.watchFile)(e,{persistent:!1},i)}};const a=require("os");var d,l,u,m,p,f,y,w,S,h,g,v,x,j,k,b;!function(e){e.dev="dev",e.prod="prod"}(d||(d={})),function(e){e.trucks="trucks",e.trailers="trailers"}(l||(l={})),function(e){e[e.sync=0]="sync",e[e.async=1]="async"}(u||(u={})),function(e){e[e.file=0]="file",e[e.dir=1]="dir"}(m||(m={})),function(e){e[e.open=0]="open",e[e.save=1]="save"}(p||(p={})),function(e){e.engines="engines",e.gearboxes="gearboxes",e.suspensions="suspensions",e.wheels="wheels",e.winches="winches",e.truck="truck"}(f||(f={})),function(e){e.main="main",e.dlc="dlc",e.mods="mods",e.favorites="favorites"}(y||(y={})),function(e){e.text="text",e.number="number",e.select="select",e.coordinates="coordinates",e.file="file"}(w||(w={})),function(e){e.RU="RU",e.EN="EN",e.DE="DE",e.CH="CH"}(S||(S={})),function(e){e.static="static",e.computed="computed",e.tagName="tagName"}(h||(h={})),function(e){e.integer="int",e.float="float"}(g||(g={})),function(e){e.editor="editor",e.lists="lists"}(v||(v={})),function(e){e.input="input",e.group="group"}(x||(x={})),function(e){e.mods="mods",e.dlc="dlc",e.main="main",e.favorites="favorites"}(j||(j={})),function(e){e.multiply="multiply",e.single="single"}(k||(k={})),function(e){e[e.Main=0]="Main",e[e.Settings=1]="Settings",e[e.Update=2]="Update",e[e.WhatsNew=3]="WhatsNew",e[e.Loading=4]="Loading",e[e.Setup=5]="Setup",e[e.Help=6]="Help"}(b||(b={}));const E=(...e)=>(0,i.resolve)(__dirname,...e);function _(e,t,s=".xml",r){let o=[];return(0,n.existsSync)(e)?((0,n.readdirSync)(e).forEach((c=>{const a=(0,i.join)(e,c),d=(0,n.lstatSync)(a);if(t){if(!d.isDirectory())return;o.push({name:c,path:a})}d.isDirectory()&&r?o=[...o,..._(a,!1,s,!0)]:c.indexOf(s)>=0&&o.push({name:c.replace(s,""),path:a})})),o):[]}E("../../"),E("../../../updateRoot"),E("config.json"),E("game_texts.json"),E("backups"),E("favicon.ico"),E("backups/initial.pak"),E("winrar"),E("mainTemp"),E("modsTemp"),E("mainTemp/[strings]"),E("../../../../unins000.exe"),E("mainTemp/[media]/classes"),E("mainTemp/[media]/_dlc");const{sendSync:F}=window.ipc,T=new Proxy({},{get(e,n){const i=F("property_config_get").value[n];return Array.isArray(i)||"object"!=typeof i||null===i?i:new Proxy(i,{get:(e,n)=>i[n],set:(e,t,s)=>(i[t]=s,T[n]=i,!0)})},set:(e,n,i)=>(e[n]=i,!F("property_config_set",{key:n,value:i}).error)}),D=window.ipc,{unpack:R,getInitial:H,paths:N}=o,{dlc:M,mods:$}=T;window.listPreload={findMods:async function(){const e=(0,a.userInfo)().homedir||(0,a.homedir)()||process.env.HOME,t=[];if(!(0,n.existsSync)(e))return[];const s=(0,i.join)(e,"Documents/My Games/SnowRunner/base/Mods/.modio/mods");if(!(0,n.existsSync)(s))return[];(0,n.readdirSync)(s,{withFileTypes:!0}).forEach((e=>{if(e.isFile())return;const r=(0,i.join)(s,e.name);(0,n.readdirSync)(r,{withFileTypes:!0}).forEach((e=>{if(e.isDirectory())return;const s=(0,i.join)(r,e.name),o=(0,i.join)(N.modsTemp,e.name);if(".pak"===(0,i.extname)(e.name)&&(R(s,o,!0),(0,n.existsSync)((0,i.join)(o,"classes")))){const o=(0,i.join)(r,"modio.json");let c=(0,i.basename)(e.name,".pak");(0,n.existsSync)(o)&&(c=JSON.parse((0,n.readFileSync)(o).toString()).name),t.push({name:c,path:s})}}))}));for(const e in $.items){const n=$.items[e].path;let i=!1;for(const e in t)t[e].path===n&&(i=!0);i||t.push($.items[e])}return t},getList:function(e,n){if(n===j.dlc){const n=[];return M.forEach((t=>{const s=`${t.path}/classes`;let r=[];e===l.trucks?r=_((0,i.join)(s,"trucks")):e===l.trailers&&(r=_((0,i.join)(s,"trucks/trailers"))),n.push({dlcName:t.name,items:r})})),n}if(n===j.mods){const n=[];for(const t in $.items){const s=$.items[t];let r=[];(e===l.trucks||e===l.trailers)&&(r=_((0,i.join)(N.modsTemp,t,"classes/trucks"),!1,".xml",!0)),n.push({id:t,name:s.name,items:r})}return n}return e===l.trucks?_((0,i.join)(N.classes,"trucks")):e===l.trailers?_((0,i.join)(N.classes,"trucks/trailers")):void 0},getModPak:function(){const e=H();if(!e)return;const t=(0,i.basename)(e),s=(0,i.basename)(e,".pak");return R(e,(0,i.join)(N.modsTemp,s),!0),(0,n.existsSync)((0,i.join)(N.modsTemp,s,"classes"))?{id:s,path:e,name:t}:void 0},removeDir:function(e){(0,n.rmSync)(e,{recursive:!0})}};const P=new Set;let L=!1;D.on("window-resize",(()=>P.forEach((e=>e())))),window.onResize=e=>{L||(D.send("enable-list-resize"),L=!0),P.add(e)},window.removeResizeHandler=e=>{P.delete(e)}})();