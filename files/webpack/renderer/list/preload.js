(()=>{"use strict";const e=require("path"),n=require("fs"),t=require("os"),s=require("electron");window.provider=new class{constructor(){this.config=new Proxy({},{get:(e,n)=>{const t=s.ipcRenderer.sendSync("property_config_get").value[n];return Array.isArray(t)||"object"!=typeof t?t:new Proxy(t,{get:(e,n)=>t[n],set:(e,s,o)=>(t[s]=o,this.config[n]=t,!0)})},set:(e,n,t)=>(e[n]=t,!s.ipcRenderer.sendSync("property_config_set",{key:n,value:t}).error)}),this.local={pop(e){const n=localStorage.getItem(e);return localStorage.removeItem(e),"null"===n?null:"undefined"!==n?n:void 0},get(e){const n=localStorage.getItem(String(e));return"null"===n?null:"undefined"!==n?n:void 0},set(e,n){localStorage.setItem(String(e),n)}},this.ipcRenderer=s.ipcRenderer,this.paths=s.ipcRenderer.sendSync("property_paths_get").value,this.texts=s.ipcRenderer.sendSync("property_texts_get").value,window.onload=()=>{document.title=document.title.replace("{--VERSION--}",`v${this.config.version}`),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"KeyS"===e.code){const e=document.querySelector("#save-params");e&&e.click()}else if("Escape"===e.code){const e=s.ipcRenderer.sendSync("get-windows-state");e.categories?s.app.quit():e.list?s.ipcRenderer.sendSync("function_openCategories_call"):e.editor?s.ipcRenderer.sendSync("function_openList_call"):window.close()}else e.ctrlKey&&"KeyQ"===e.code&&s.ipcRenderer.sendSync("function_quit_call")}))}}};const o=(...n)=>(0,e.resolve)(__dirname,...n),i=(o("../../"),o("config.json"),o("ingame_texts.json"),o("backups"),o("favicon.ico"),o("backups/initial.pak"),o("winrar"),o("mainTemp"),o("modsTemp"),o("mainTemp/[strings]"),o("mainTemp/[media]/_dlc"),o("mainTemp/[media]/classes"),o("../../../../unins000.exe"),(t,s,o=".xml",r)=>{if(!(0,n.existsSync)(t))return[];let c=[];const a=(0,n.readdirSync)(t);for(let l=0;l<a.length;l++){const d=(0,e.join)(t,a[l]),p=(0,n.lstatSync)(d);if(s){if(!p.isDirectory())continue;c.push({name:a[l],path:d})}p.isDirectory()&&r?c=[...c,...i(d,!1,o,!0)]:a[l].indexOf(o)>=0&&c.push({name:a[l].replace(o,""),path:d})}return c}),{config:r,texts:c}=window.provider,a=(c[r.lang],{});var l,d,p,u,m,f,y,g,h,S,v,w;Object.defineProperty(a,"MAIN",{get:()=>("#main",document.querySelector("#main"))}),function(e){e.engines="engines",e.gearboxes="gearboxes",e.suspensions="suspensions",e.wheels="wheels",e.winches="winches"}(l||(l={})),function(e){e.multiply="multiply",e.single="single"}(d||(d={})),function(e){e.text="text",e.number="number",e.coordinates="coordinates",e.file="file"}(p||(p={})),function(e){e.integer="int",e.float="float"}(u||(u={})),function(e){e.static="static",e.computed="computed",e.tagName="tagName"}(m||(m={})),function(e){e.input="input",e.group="group"}(f||(f={})),function(e){e[e.openSettings=1]="openSettings",e[e.openWhatsNew=2]="openWhatsNew",e[e.resetConfig=3]="resetConfig",e[e.devTools=4]="devTools",e[e.reload=5]="reload",e[e.quitApp=6]="quitApp",e[e.showFolder=7]="showFolder",e[e.separator=8]="separator",e[e.saveBackup=9]="saveBackup",e[e.recoverFromBackup=10]="recoverFromBackup",e[e.joinEPF=11]="joinEPF",e[e.seeEPF=12]="seeEPF",e[e.openURL=13]="openURL",e[e.uninstall=14]="uninstall",e[e.importConfig=15]="importConfig",e[e.exportConfig=16]="exportConfig"}(y||(y={})),function(e){e[e.open=0]="open",e[e.save=1]="save"}(g||(g={})),function(e){e[e.file=0]="file",e[e.dir=1]="dir"}(h||(h={})),function(e){e[e.sync=0]="sync",e[e.async=1]="async"}(S||(S={})),function(e){e.dev="dev",e.prod="prod"}(v||(v={})),function(e){e.RU="RU",e.EN="EN",e.DE="DE"}(w||(w={}));const{ipcRenderer:_}=window.provider,x=_.sendSync("getInfo"),k=e=>{_.sendSync("function_alertSync_call",`${e}`.replace("Error: ",""))},j=new Proxy({},{get:(e,n)=>{if(x.properties.includes(n)){const e=_.sendSync(`property_${n}_get`);return e.error?(k(e.error),null):e.value}if(x.functions.includes(n))return new Proxy((()=>{}),{apply:(e,t,s)=>{const o=_.sendSync(`function_${n}_call`,...s);return o.error?(k(o.error),null):o.value}})},set:(e,n,t)=>{if(x.properties.includes(n)){const e=_.sendSync(`property_${n}_set`,t);return!e.error||(k(e.error),!1)}return!1}});var R,b;!function(e){e.mods="mods",e.dlc="dlc",e.main="main",e.favorites="favorites"}(R||(R={})),function(e){e.trucks="trucks",e.trailers="trailers"}(b||(b={}));const{config:T,paths:E}=window.provider,{unpack:F,openInitialDialog:P}=j;window.listPreload=new class{constructor(){this.exists=t=>(0,n.existsSync)((0,e.join)(__dirname,t)),this.removeDir=e=>{(0,n.rmSync)(e,{recursive:!0})},this.findMods=()=>{const s=(0,t.userInfo)().homedir||(0,t.homedir)()||process.env.HOME;if(!(0,n.existsSync)(s))return[];const o=(0,e.join)(s,"Documents/My Games/SnowRunner/base/Mods/.modio/mods");if(!(0,n.existsSync)(o))return[];const i=[];for(const t of(0,n.readdirSync)(o,{withFileTypes:!0})){if(t.isFile())continue;const s=(0,e.join)(o,t.name);for(const t of(0,n.readdirSync)(s,{withFileTypes:!0})){if(t.isDirectory())continue;const o=(0,e.join)(s,t.name);if(".pak"===(0,e.extname)(t.name)&&(F(o,(0,e.join)(E.modsTemp,t.name),!0),(0,n.existsSync)((0,e.join)(E.modsTemp,t.name,"classes")))){const r=(0,e.join)(s,"modio.json");let c=(0,e.basename)(t.name,".pak");(0,n.existsSync)(r)&&(c=JSON.parse((0,n.readFileSync)(r).toString()).name),i.push({name:c,path:o})}}}for(const e in T.mods.items){const n=T.mods.items[e].path;let t=!1;for(const e in i)i[e].path===n&&(t=!0);t||i.push(T.mods.items[e])}return i},this.getModPak=()=>{const t=P();if(!t)return;const s=(0,e.basename)(t,".pak"),o=(0,e.basename)(t);return F(t,(0,e.join)(E.modsTemp,s),!0),(0,n.existsSync)((0,e.join)(E.modsTemp,s,"classes"))?{id:s,path:t,name:o}:void 0},this.getList=(n,t)=>{if(t===R.dlc){const t=[];for(const s of T.dlc){const o=`${s.path}\\classes`;let r=[];n===b.trucks?r=i((0,e.join)(o,"trucks")):n===b.trailers&&(r=i((0,e.join)(o,"trucks","trailers"))),t.push({dlcName:s.name,items:r})}return t}if(t===R.mods){const t=[];for(const s in T.mods.items){let o=[];const r=T.mods.items[s];(n===b.trucks||n===b.trailers)&&(o=i((0,e.join)(E.modsTemp,s,"classes","trucks"),!1,".xml",!0)),t.push({id:s,name:r.name,items:o})}return t}return n===b.trucks?i((0,e.join)(E.classes,"trucks")):n===b.trailers?i((0,e.join)(E.classes,"trucks","trailers")):void 0},this.join=e.join,this.basename=e.basename}}})();