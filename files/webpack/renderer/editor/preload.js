(()=>{"use strict";const e=require("fs"),n=require("path"),t=require("electron");window.provider=new class{constructor(){this.config=new Proxy({},{get:(e,n)=>{const s=t.ipcRenderer.sendSync("property_config_get").value[n];return Array.isArray(s)||"object"!=typeof s?s:new Proxy(s,{get:(e,n)=>s[n],set:(e,t,r)=>(s[t]=r,this.config[n]=s,!0)})},set:(e,n,s)=>(e[n]=s,!t.ipcRenderer.sendSync("property_config_set",{key:n,value:s}).error)}),this.local={pop(e){const n=localStorage.getItem(e);return localStorage.removeItem(e),"null"===n?null:"undefined"!==n?n:void 0},get(e){const n=localStorage.getItem(String(e));return"null"===n?null:"undefined"!==n?n:void 0},set(e,n){localStorage.setItem(String(e),n)}},this.ipcRenderer=t.ipcRenderer,this.paths=t.ipcRenderer.sendSync("property_paths_get").value,this.texts=t.ipcRenderer.sendSync("property_texts_get").value,window.onload=()=>{document.title=document.title.replace("{--VERSION--}",`v${this.config.version}`),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"KeyS"===e.code){const e=document.querySelector("#save-params");e&&e.click()}else if("Escape"===e.code){const e=t.ipcRenderer.sendSync("get-windows-state");e.categories?t.app.quit():e.list?t.ipcRenderer.sendSync("function_openCategories_call"):e.editor?t.ipcRenderer.sendSync("function_openList_call"):window.close()}else e.ctrlKey&&"KeyQ"===e.code&&t.ipcRenderer.sendSync("function_quit_call")}))}}};const s=(...e)=>(0,n.resolve)(__dirname,...e),r=(s("../../"),s("config.json"),s("ingame_texts.json"),s("backups"),s("favicon.ico"),s("backups/initial.pak"),s("winrar"),s("mainTemp"),s("modsTemp"),s("mainTemp/[strings]"),s("mainTemp/[media]/_dlc"),s("mainTemp/[media]/classes"),s("../../../../unins000.exe"),(t,s,i=".xml",o)=>{if(!(0,e.existsSync)(t))return[];let c=[];const a=(0,e.readdirSync)(t);for(let d=0;d<a.length;d++){const l=(0,n.join)(t,a[d]),p=(0,e.lstatSync)(l);if(s){if(!p.isDirectory())continue;c.push({name:a[d],path:l})}p.isDirectory()&&o?c=[...c,...r(l,!1,i,!0)]:a[d].indexOf(i)>=0&&c.push({name:a[d].replace(i,""),path:l})}return c}),{paths:i}=window.provider;window.editorPreload=new class{constructor(){this.findFromDLC=(t,s)=>{for(const r of(0,e.readdirSync)(i.dlc)){const o=(0,n.join)(i.dlc,r,"classes",s,`${t}.xml`);if((0,e.existsSync)(o))return o}},this.getAddons=(t,s,o)=>{const c=[],a=(0,n.join)(i.classes,`trucks/${t}_tuning`);(0,e.existsSync)(a)&&c.push(...(0,e.readdirSync)(a,{withFileTypes:!0}).map((e=>e.isDirectory()?null:{name:e.name,path:(0,n.join)(a,e.name)})));const d=(0,n.join)(i.classes,"trucks/addons");(0,e.existsSync)(d)&&c.push(...(0,e.readdirSync)(d).map((e=>({name:e,path:(0,n.join)(d,e)}))));for(const t of(0,e.readdirSync)(i.dlc)){const s=(0,n.join)(i.dlc,t,"classes/trucks");if((0,e.existsSync)(s)){const t=(0,n.join)(s,"addons");(0,e.existsSync)(t)&&c.push(...(0,e.readdirSync)(t).map((e=>({name:e,path:(0,n.join)(t,e)}))));for(const t of(0,e.readdirSync)(s,{withFileTypes:!0}))t.isDirectory()&&t.name.endsWith("_tuning")&&c.push(...(0,e.readdirSync)((0,n.join)(s,t.name)).map((e=>({name:e,path:(0,n.join)(s,t.name,e)}))))}}s&&c.push(...r((0,n.join)(i.modsTemp,s,"classes"),!1,".xml",!0).filter((n=>{const t=new DOMParser;if(!(0,e.existsSync)(n.path))return!1;const s=`<root>${(0,e.readFileSync)(n.path).toString()}</root>`;return!!t.parseFromString(s,"text/xml").querySelector("TruckAddon")})));const l=[];for(const n of c)if(o){const t=new DOMParser,s=`<root>${(0,e.readFileSync)(n.path).toString()}</root>`;o(t.parseFromString(s,"text/xml"))&&l.push(n)}else l.push(n);return l},this.saveFile=e.writeFileSync,this.join=n.join,this.basename=n.basename,this.existsSync=e.existsSync,this.readFile=e.readFileSync}}})();