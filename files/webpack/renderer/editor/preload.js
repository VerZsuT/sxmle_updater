(()=>{"use strict";const e=require("fs"),n=require("path"),t=require("electron");function r(){return t.ipcRenderer.sendSync("property_config_get").value}window.provider=new class{constructor(){this.config=new Proxy({},{get:(e,n)=>{const t=r()[n];return Array.isArray(t)||"object"!=typeof t||null===t?t:new Proxy(t,{get:(e,n)=>t[n],set:(e,r,s)=>(t[r]=s,this.config[n]=t,!0)})},set:(e,n,r)=>(e[n]=r,!t.ipcRenderer.sendSync("property_config_set",{key:n,value:r}).error)}),this.local={pop(e){const n=localStorage.getItem(e);return localStorage.removeItem(e),"null"===n?null:"undefined"!==n?n:void 0},get(e){const n=localStorage.getItem(String(e));return"null"===n?null:"undefined"!==n?n:void 0},set(e,n){localStorage.setItem(String(e),n)}},this.ipcRenderer=t.ipcRenderer,this.paths=t.ipcRenderer.sendSync("property_paths_get").value,this.texts=t.ipcRenderer.sendSync("property_texts_get").value,window.onload=()=>{document.title=document.title.replace("{--VERSION--}",`v${this.config.version}`),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"KeyS"===e.code){const e=document.querySelector("#save");e&&e.click()}else e.ctrlKey&&"KeyQ"===e.code?t.ipcRenderer.sendSync("function_quit_call"):"KeyI"===e.code&&e.ctrlKey&&e.shiftKey&&"dev"===r().buildType&&t.ipcRenderer.sendSync("function_toggleDevTools_call")}))}}};const s=(...e)=>(0,n.resolve)(__dirname,...e),i=(s("../../"),s("config.json"),s("ingame_texts.json"),s("backups"),s("favicon.ico"),s("backups/initial.pak"),s("winrar"),s("mainTemp"),s("modsTemp"),s("mainTemp/[strings]"),s("mainTemp/[media]/_dlc"),s("mainTemp/[media]/classes"),s("../../../../unins000.exe"),(t,r,s=".xml",o)=>{if(!(0,e.existsSync)(t))return[];let c=[];const a=(0,e.readdirSync)(t);for(let d=0;d<a.length;d++){const l=(0,n.join)(t,a[d]),p=(0,e.lstatSync)(l);if(r){if(!p.isDirectory())continue;c.push({name:a[d],path:l})}p.isDirectory()&&o?c=[...c,...i(l,!1,s,!0)]:a[d].indexOf(s)>=0&&c.push({name:a[d].replace(s,""),path:l})}return c}),{paths:o}=window.provider;window.editorPreload=new class{constructor(){this.findFromDLC=(t,r)=>{for(const s of(0,e.readdirSync)(o.dlc)){const i=(0,n.join)(o.dlc,s,"classes",r,`${t}.xml`);if((0,e.existsSync)(i))return i}},this.getAddons=(t,r,s)=>{const c=[],a=(0,n.join)(o.classes,`trucks/${t}_tuning`);(0,e.existsSync)(a)&&c.push(...(0,e.readdirSync)(a,{withFileTypes:!0}).map((e=>e.isDirectory()?null:{name:e.name,path:(0,n.join)(a,e.name)})));const d=(0,n.join)(o.classes,"trucks/addons");(0,e.existsSync)(d)&&c.push(...(0,e.readdirSync)(d).map((e=>({name:e,path:(0,n.join)(d,e)}))));for(const t of(0,e.readdirSync)(o.dlc)){const r=(0,n.join)(o.dlc,t,"classes/trucks");if((0,e.existsSync)(r)){const t=(0,n.join)(r,"addons");(0,e.existsSync)(t)&&c.push(...(0,e.readdirSync)(t).map((e=>({name:e,path:(0,n.join)(t,e)}))));for(const t of(0,e.readdirSync)(r,{withFileTypes:!0}))t.isDirectory()&&t.name.endsWith("_tuning")&&c.push(...(0,e.readdirSync)((0,n.join)(r,t.name)).map((e=>({name:e,path:(0,n.join)(r,t.name,e)}))))}}r&&c.push(...i((0,n.join)(o.modsTemp,r,"classes"),!1,".xml",!0).filter((n=>{const t=new DOMParser;if(!(0,e.existsSync)(n.path))return!1;const r=`<root>${(0,e.readFileSync)(n.path).toString()}</root>`;return!!t.parseFromString(r,"text/xml").querySelector("TruckAddon")})));const l=[];for(const n of c)if(s){const t=new DOMParser,r=`<root>${(0,e.readFileSync)(n.path).toString()}</root>`;s(t.parseFromString(r,"text/xml"))&&l.push(n)}else l.push(n);return l},this.saveFile=e.writeFileSync,this.join=n.join,this.basename=n.basename,this.existsSync=e.existsSync,this.readFile=e.readFileSync}}})();